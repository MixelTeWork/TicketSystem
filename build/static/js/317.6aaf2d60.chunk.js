"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[317],{6253:function(e,n,t){t.r(n),t.d(n,{default:function(){return In}});var r=t(7689),s=t(4165),i=t(1413),a=t(5861),c=t(1933),u=t(3144),o=t(5671),l=t(136),d=t(516),f=function(e){(0,l.Z)(t,e);var n=(0,d.Z)(t);function t(){return(0,o.Z)(this,t),n.apply(this,arguments)}return(0,u.Z)(t)}((0,t(8737).Z)(Error));function v(e,n){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:void 0===n?null:JSON.stringify(n)})}function h(){return(0,c.useQuery)("user",x)}function x(){return p.apply(this,arguments)}function p(){return(p=(0,a.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,401!=n.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",role:"",name:"",operations:[]});case 8:if(n.ok){e.next=10;break}throw new f(t.msg);case 10:return(r=t).auth=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return m.apply(this,arguments)}function m(){return(m=(0,a.Z)((0,s.Z)().mark((function e(){var n,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/users");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,n.ok){e.next=8;break}throw new f(t.msg);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/user/change_password",n);case 2:if((t=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,t.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/user/change_name",n);case 2:if((t=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,t.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,n){var t,r;return!(null===(t=e.data)||void 0===t||!t.auth||null===(r=e.data)||void 0===r||!r.operations.includes(n))}function Z(e){var n,t,r=h();return!(null===(n=r.data)||void 0===n||!n.auth||null===(t=r.data)||void 0===t||!t.operations.includes(e))}var w=t(5086),N=t(2791);function S(){var e=(0,r.TH)().pathname;return(0,N.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var A={root:"styles_root__4DGhY"},I=t(184);function C(){var e=(0,r.s0)();return(0,I.jsx)("div",{className:A.root,children:(0,I.jsx)("button",{onClick:function(){return e(-1)},children:"\u041d\u0430\u0437\u0430\u0434"})})}function Q(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.filter((function(e){return!!e})).join(" ")}var D=t(9439),E=t(1087),F={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",menu:"styles_menu__WWgPh",menuVisible:"styles_menuVisible__mMGZn"},M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";function L(e){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/auth",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return(i=r).auth=!0,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return U.apply(this,arguments)}function U(){return(U=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/logout");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function O(e){var n=e.color,t=e.zIndex;return(0,I.jsx)("div",{className:P.root,children:(0,I.jsxs)("div",{className:P.spinner,style:{"--color":n,zIndex:t},children:[(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{})]})})}function B(e){var n,t=e.backLink,s=(0,N.useState)(!1),i=(0,D.Z)(s,2),a=i[0],u=i[1],o=(0,r.TH)(),l=(0,r.s0)(),d=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:T,onSuccess:function(){e.invalidateQueries("user")}})}(),f=h();return(0,I.jsxs)("div",{className:F.root,children:[(0,I.jsxs)("span",{className:F.block,children:[(0,I.jsx)(E.rU,{to:"/",className:F.home,children:(0,I.jsx)("img",{src:M,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),t&&(0,I.jsx)(E.rU,{to:t,children:(0,I.jsx)("button",{className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})}),"/"!=o.pathname&&!t&&(0,I.jsx)("button",{onClick:function(){return l(t||-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,I.jsxs)("span",{className:F.block,children:[(0,I.jsx)("button",{onClick:function(){return u((function(e){return!e}))},className:"button button_light",children:(0,I.jsx)("span",{children:null===(n=f.data)||void 0===n?void 0:n.name})}),(0,I.jsxs)("div",{className:Q(F.menu,a&&F.menuVisible),children:[(0,I.jsx)("button",{onClick:function(){return l("/profile")},className:"button button_light",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,I.jsx)("button",{onClick:function(){return d.mutate()},disabled:"idle"!=d.status,className:"button button_light",children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"idle"!=d.status&&(0,I.jsx)(O,{})]})}var V={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function z(e){var n=e.children,t=e.className,r=e.backLink,s=e.centered,i=void 0!==s&&s,a=e.centeredPage,c=void 0!==a&&a,u=e.height100,o=void 0!==u&&u,l=e.gap,d=void 0===l?0:l,f=e.header;return void 0===f&&(f=(0,I.jsx)(B,{backLink:r})),(0,I.jsxs)("div",{className:V.root,style:{maxHeight:o?"100dvh":""},children:[f||(0,I.jsx)("div",{}),(0,I.jsx)("div",{className:Q(V.body,t,i&&V.body_centered,c&&V.body_centeredPage),style:{gap:d,maxHeight:o?"100%":""},children:n})]})}function q(){return(0,I.jsx)(z,{centered:!0,header:(0,I.jsx)(C,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function W(){return(0,I.jsx)(z,{centered:!0,header:(0,I.jsx)(C,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var Y={form:"styles_form__n7Rcu"},J=t(3433);function G(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,N.useEffect)((function(){var t=document.title,r="object"!=typeof e?[e]:e;return document.title=[n].concat((0,J.Z)(r)).filter((function(e){return!!e})).join(" | "),function(){document.title=t}}),[e,n])}var K={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function H(e){var n=e.className,t=e.style,r=e.onSubmit,s=e.children;return(0,I.jsx)("form",{className:Q(K.form,n),style:t,onSubmit:function(e){e.preventDefault(),r()},children:s})}function X(e){var n=e.label,t=e.className,r=e.style,s=e.children;return(0,I.jsxs)("label",{className:Q(K.field,t),style:r,children:[(0,I.jsx)("span",{children:n}),s]})}function $(){G("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,N.useState)(""),n=(0,D.Z)(e,2),t=n[0],r=n[1],s=(0,N.useRef)(null),i=(0,N.useRef)(null),a=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:L,onSuccess:function(e){n.setQueryData("user",(function(){return e}))},onError:function(n){null===e||void 0===e||e(n instanceof f?n.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(r);return(0,I.jsxs)(z,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,I.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),t&&(0,I.jsx)("h3",{children:t}),a.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{className:Y.form,onSubmit:function(){var e,n,t=(null===(e=s.current)||void 0===e?void 0:e.value)||"",r=(null===(n=i.current)||void 0===n?void 0:n.value)||"";a.mutate({login:t,password:r})},children:[(0,I.jsx)(X,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:s,type:"text",name:"login",required:!0})}),(0,I.jsx)(X,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:i,type:"password",name:"password",required:!0})}),(0,I.jsx)("button",{type:"submit",disabled:"loading"==a.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function ee(){var e=h();return(0,I.jsxs)(z,{centered:!0,gap:"1em",children:[k(e,"page_events")&&(0,I.jsx)(E.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),k(e,"page_staff")&&(0,I.jsx)(E.rU,{to:"/staff",className:"button button_large",children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),k(e,"page_debug")&&(0,I.jsx)(E.rU,{to:"/debug",className:"button button_large",children:"</>"}),k(e,"page_users")&&(0,I.jsx)(E.rU,{to:"/users",className:"button button_large",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"})]})}var ne={scanner:"styles_scanner__+xzXT",scannerRect:"styles_scannerRect__zwl3N",scannerVideo:"styles_scannerVideo__ZCceC",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO",alreadyScanned:"styles_alreadyScanned__OI-PM",alreadyScanned_visible:"styles_alreadyScanned_visible__keU3C"},te={root:"styles_root__QdJnV"},re=t(1096);function se(e){var n=e.active,t=void 0===n||n,r=e.className,s=e.onScan,i=e.onCameraError,a=(0,N.useState)(),c=(0,D.Z)(a,2),u=c[0],o=c[1],l=(0,N.useRef)(null);return(0,N.useEffect)((function(){if(l.current){var e=new re.Z(l.current,(function(e){return s(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return o((function(n){return null===n||void 0===n||n.stop(),null===n||void 0===n||n.destroy(),e})),e.start().catch((function(){return i()})),function(){e.stop(),e.destroy()}}}),[l,s]),(0,N.useEffect)((function(){u&&(t?u.start().catch((function(){return i()})):u.pause(!1))}),[t,u]),(0,I.jsx)("video",{className:Q(te.root,r),ref:l})}function ie(e,n){return"".concat(e).padStart(n,"0")}function ae(e,n,t,r){var s="".concat(e);return"1"==s.at(-1)&&"1"!=s.at(-2)?n:["2","3","4"].includes(s.at(-1)||"")&&"1"!=s.at(-2)?t:r}function ce(e){return e?"".concat(ie(e.getDate(),2),".").concat(ie(e.getMonth()+1,2),".").concat(e.getFullYear()):""}function ue(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(ie(e.getHours(),2),":").concat(ie(e.getMinutes(),2));return n?t+":".concat(ie(e.getSeconds(),2)):t}function oe(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",t=new Date,r=e.getTime()-t.getTime(),s=Math.floor(Math.abs(r)/1e3),i=Math.floor(s/31104e3);s-=60*i*60*24*30*12;var a=Math.floor(s/2592e3);s-=60*a*60*24*30;var c=Math.floor(s/86400);s-=60*c*60*24;var u=Math.floor(s/3600)%24;s-=60*u*60;var o=Math.floor(s/60)%60,l=(s-=60*o)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=i?[i,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=a?[a,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=c?[c,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==n?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=u?[u,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=o?[o,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),f=(0,D.Z)(d,2),v=f[0],h=f[1];if("string"==typeof v)return v;var x="".concat(ae.apply(void 0,[v].concat((0,J.Z)(h))));return Math.abs(v)>1&&(x=Math.abs(v)+" "+x),r>0?x="\u0427\u0435\u0440\u0435\u0437 "+x:x+=" \u043d\u0430\u0437\u0430\u0434",x}var le={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function de(e){var n=e.event,t=e.onInputBtn;return(0,I.jsxs)("div",{className:le.root,children:[(0,I.jsx)("div",{className:le.top,children:(0,I.jsx)("button",{onClick:t,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,I.jsxs)("div",{className:le.bottom,children:[(0,I.jsx)("span",{children:n.name}),(0,I.jsx)("span",{children:"|"}),(0,I.jsx)("span",{children:ce(n.date)})]})]})}function fe(e){return fetch(e,{method:"DELETE"})}function ve(){return he.apply(this,arguments)}function he(){return(he=(0,a.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,n.ok){e.next=8;break}throw new f(t.msg);case 8:return r=t,e.abrupt("return",r.map(_e));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return pe.apply(this,arguments)}(e)}))}function pe(){return(pe=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",_e(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return me.apply(this,arguments)}(e)}),{retry:3})}function me(){return(me=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/scanner_event/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}return e.abrupt("return",NaN);case 8:return e.abrupt("return",_e(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){var n=e;return n.date=new Date(e.date),n}function be(e){return ye.apply(this,arguments)}function ye(){return(ye=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/event",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",_e(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(n){return function(e,n){return ke.apply(this,arguments)}(e,n)},onSuccess:function(e){var r;t.setQueryData(["event","".concat(e.id)],(function(){return e})),"success"==(null===(r=t.getQueryState("events"))||void 0===r?void 0:r.status)&&t.setQueryData("events",(function(n){return n?[].concat((0,J.Z)(n.filter((function(n){return n.id!=e.id}))),[e]):[e]})),null===n||void 0===n||n()}});return r}function ke(){return(ke=(0,a.Z)((0,s.Z)().mark((function e(n,t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/event/"+n,t);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new f(i.msg);case 8:return e.abrupt("return",_e(i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return we.apply(this,arguments)}(e)},onSuccess:function(){var r;t.removeQueries(["event","".concat(e)],{exact:!0}),"success"==(null===(r=t.getQueryState("events"))||void 0===r?void 0:r.status)&&t.setQueryData("events",(function(n){return n?n.filter((function(n){return n.id!=e})):[]})),null===n||void 0===n||n()}});return r}function we(){return(we=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe("/api/event/"+n);case 2:if((t=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,t.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function Se(e){var n=e.children,t=e.open,r=void 0!==t&&t,s=e.close,i=e.title,a=void 0===i?"":i;return(0,I.jsx)("div",{className:Q(Ne.root,r&&Ne.open),children:(0,I.jsxs)("div",{className:Ne.popup,children:[(a||s)&&(0,I.jsxs)("div",{className:Ne.header,children:[(0,I.jsx)("h3",{children:a}),s&&(0,I.jsx)("button",{className:Ne.close,onClick:s,children:"\u2716"})]}),(0,I.jsx)("div",{className:Ne.body,children:n})]})})}function Ae(e){return(0,c.useQuery)(["tickets",e],(function(){return function(e){return Ie.apply(this,arguments)}(e)}))}function Ie(){return(Ie=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r.map(Ce));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e){var n=e;return e.scannedDate&&(n.scannedDate=new Date(e.scannedDate)),e.createdDate&&(n.createdDate=new Date(e.createdDate)),n}function Qe(e){return De.apply(this,arguments)}function De(){return(De=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/ticket",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",Ce(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/check_ticket",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return a=r,(i=r).ticket&&(a.ticket=Ce(i.ticket)),i.event&&(a.event=_e(i.event)),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e){var n=(0,N.useState)((function(){var n=new Audio(e);return n.preload="auto",n})),t=(0,D.Z)(n,1)[0];return[function(){t.currentTime=0,t.play()}]}var Le=t.p+"static/media/beep.38f199e084efe5461ffd.mp3",Re=t.p+"static/media/beepError.7eccfa35a3dd6b6ea311.mp3";function Te(e,n){return"".concat(ie(e,3),"-").concat(n.getFullYear().toString().at(-1)).concat(ie(n.getMonth()+1,2)).concat(ie(n.getDate(),2),"-")}function Ue(){G("\u0421\u043a\u0430\u043d\u0435\u0440");var e,n=(0,r.UO)(),t=(0,N.useState)(null),s=(0,D.Z)(t,2),i=s[0],a=s[1],u=(0,N.useState)(null),o=(0,D.Z)(u,2),l=o[0],d=o[1],v=(0,N.useState)(null),h=(0,D.Z)(v,2),x=h[0],p=h[1],j=(0,N.useState)(null),m=(0,D.Z)(j,2),_=m[0],b=m[1],y=(0,N.useState)(!0),g=(0,D.Z)(y,2),k=g[0],Z=g[1],w=(0,N.useState)(!1),S=(0,D.Z)(w,2),A=S[0],C=S[1],E=(0,N.useState)(!1),F=(0,D.Z)(E,2),M=F[0],L=F[1],R=(0,N.useState)(!1),T=(0,D.Z)(R,2),U=T[0],P=T[1],B=(0,N.useRef)(null),V=je(n.eventId),q=Me(Le),W=(0,D.Z)(q,1)[0],Y=Me(Re),J=(0,D.Z)(Y,1)[0],K=(0,N.useCallback)((function(e){return a(e)}),[]),H=(0,N.useCallback)((function(){C(!0),B.current&&V.data&&"number"!=typeof V.data&&(setTimeout((function(){B.current&&B.current.focus()}),50),B.current.value=Te(V.data.id,V.data.date))}),[B,V.data]),X=(0,N.useCallback)((function(){return C(!1)}),[]),$=function(e,n){var t=(0,c.useMutation)({mutationFn:Ee,onSuccess:function(n){null===e||void 0===e||e(n)},onError:function(e){null===n||void 0===n||n(e instanceof f?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),t.reset()}});return t}((function(e){b(e),e.success||J()}),(function(e){b(null),p(e)}));return(0,N.useEffect)((function(){if(i&&V.data&&"idle"==$.status&&"number"!=typeof V.data){if(W(),l==i&&!x)return a(null),void L(!0);a(null),L(!1),d(i),p(null),b(null),$.mutate({code:i,eventId:V.data.id})}}),[i,V.data,$.status]),(0,N.useEffect)((function(){if($.isSuccess){var e=setTimeout((function(){a(null),$.reset()}),1e3);return function(){return clearTimeout(e)}}}),[$.isSuccess]),(0,N.useEffect)((function(){if(M){var e=setTimeout((function(){return L(!1)}),500);return function(){return clearTimeout(e)}}}),[M]),(0,I.jsxs)(I.Fragment,{children:[V.isLoading&&(0,I.jsx)(O,{}),V.error&&(0,I.jsx)(z,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof V.data&&(0,I.jsxs)(z,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,I.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof V.data&&V.data&&(0,I.jsxs)(z,{height100:!0,header:(0,I.jsx)(de,{event:V.data,onInputBtn:H}),children:[(0,I.jsx)("div",{className:Q(ne.scanner,!$.isIdle&&ne.scanner_scanned),children:(0,I.jsx)("div",{className:ne.scannerRect,children:(0,I.jsx)(se,{onScan:K,onCameraError:function(){return P(!0)},className:ne.scannerVideo})})}),(0,I.jsxs)("div",{className:ne.scanResult,children:[(0,I.jsx)("div",{className:Q(ne.alreadyScanned,M&&ne.alreadyScanned_visible),children:"\u0422\u043e\u0442 \u0436\u0435 \u0431\u0438\u043b\u0435\u0442"}),l&&(0,I.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",l]}),x&&(0,I.jsx)("div",{children:x}),(null===_||void 0===_?void 0:_.success)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:Q(ne.success,ne.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,I.jsxs)("div",{className:ne.result_desc,children:[(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",_.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",_.ticket.promocode]})]})]}),"notExist"==(null===_||void 0===_?void 0:_.errorCode)&&(0,I.jsx)("div",{className:Q(ne.error,ne.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===_||void 0===_?void 0:_.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:Q(ne.error,ne.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,I.jsxs)("div",{className:ne.result_desc,children:[(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",_.event.name]}),(0,I.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",ce(_.event.date)," (",oe(_.event.date,"day"),")"]})]}),(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]})]})]}),"scanned"==(null===_||void 0===_?void 0:_.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:Q(ne.error,ne.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,I.jsxs)("div",{className:ne.result_desc,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,I.jsxs)("span",{children:[ue(_.ticket.scannedDate,!0)," "]}),(0,I.jsxs)("span",{className:Q((e=_.ticket.scannedDate,((new Date).getTime()-e.getTime())/1e3>30&&ne.error)),children:["(",oe(_.ticket.scannedDate),")"]})]}),(0,I.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",_.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",_.ticket.promocode]})]})]})]}),(0,I.jsxs)(Se,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:A,close:X,children:[(0,I.jsx)("input",{type:"text",ref:B}),(0,I.jsx)("button",{disabled:"idle"!=$.status,onClick:function(){var e;B.current&&a(null===(e=B.current)||void 0===e?void 0:e.value),X()},children:"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c"})]}),(0,I.jsxs)(Se,{open:U,children:[(0,I.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,I.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,I.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]}),(0,I.jsxs)(Se,{title:"\u0421\u043a\u0430\u043d\u0435\u0440 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",open:k,close:function(){return Z(!1)},children:[(0,I.jsx)("h2",{children:V.data.name}),(0,I.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u0430 \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443 \u043d\u0430 QR \u043a\u043e\u0434 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u043b\u0441\u044f \u0432 \u043c\u0438\u0433\u0430\u044e\u0449\u0443\u044e \u0440\u0430\u043c\u043a\u0443."}),(0,I.jsxs)("p",{children:[(0,I.jsx)("strong",{children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0437\u0432\u0443\u043a"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u043b\u044b\u0448\u0430\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u043b \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438."]})]})]})]})}var Pe={space_between:"styles_space_between__AD+M6"};function Oe(e,n){return e.isError?(n||Be)(e.error instanceof f?e.error.message:"\u041e\u0448\u0438\u0431\u043a\u0430"):null}function Be(e){return(0,I.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function Ve(e){var n=e.open,t=e.close,r=(0,N.useRef)(null),s=(0,N.useRef)(null),i=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:be,onSuccess:function(t){var r;n.setQueryData(["event","".concat(t.id)],(function(){return t})),"success"==(null===(r=n.getQueryState("events"))||void 0===r?void 0:r.status)&&n.setQueryData("events",(function(e){return e?[].concat((0,J.Z)(e),[t]):[t]})),null===e||void 0===e||e()}})}(t);return(0,N.useEffect)((function(){!n&&r.current&&s.current&&(r.current.value="",s.current.value="")}),[n,r,s]),(0,I.jsxs)(Se,{open:n,close:t,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Oe(i),(0,I.jsxs)(H,{onSubmit:function(){var e,n,t=null===(e=r.current)||void 0===e?void 0:e.value,a=null===(n=s.current)||void 0===n?void 0:n.value;t&&a&&i.mutate({date:a,name:t})},children:[(0,I.jsx)(X,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:r,type:"text",required:!0})}),(0,I.jsx)(X,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:s,type:"datetime-local",required:!0})}),(0,I.jsx)("button",{type:"submit",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),i.isLoading&&(0,I.jsx)(O,{})]})}function ze(){var e,n;G("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var t=(0,N.useState)(!1),r=(0,D.Z)(t,2),s=r[0],i=r[1],a=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",ve,{onSuccess:function(n){n.forEach((function(n){return e.setQueryData(["event","".concat(n.id)],n)}))}})}();return(0,I.jsxs)(z,{backLink:"/",centeredPage:!0,gap:"1rem",children:[(0,I.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),a.isLoading&&(0,I.jsx)(O,{}),Oe(a),null===(e=a.data)||void 0===e||null===(n=e.sort((function(e,n){return e.date<n.date?1:-1})))||void 0===n?void 0:n.map((function(e){return(0,I.jsxs)(E.rU,{to:"/events/".concat(e.id),className:Q("button button_large",Pe.space_between),children:[(0,I.jsx)("span",{children:e.name}),(0,I.jsx)("span",{children:ce(e.date)})]},e.id)})),Z("add_event")&&(0,I.jsxs)("div",{className:Pe.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(Ve,{open:s,close:function(){return i(!1)}})]})}function qe(){return We.apply(this,arguments)}function We(){return(We=(0,a.Z)((0,s.Z)().mark((function e(){var n,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/staff");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,n.ok){e.next=8;break}throw new f(t.msg);case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(e){return Je.apply(this,arguments)}function Je(){return(Je=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/staff",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:if(!r.exist){e.next=10;break}throw new f(r.msg);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return Ke.apply(this,arguments)}(e)},onSuccess:function(){var r;"success"==(null===(r=t.getQueryState("staff"))||void 0===r?void 0:r.status)&&t.setQueryData("staff",(function(n){return n?n.filter((function(n){return n.id!=e})):[]})),null===n||void 0===n||n()}});return r}function Ke(){return(Ke=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe("/api/staff/"+n);case 2:if((t=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,t.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return Xe.apply(this,arguments)}(e)},onSuccess:function(r){var s;"success"==(null===(s=t.getQueryState("staff"))||void 0===s?void 0:s.status)&&t.setQueryData("staff",(function(n){return n?n.map((function(n){return n.id!=e?n:r})):[]})),null===n||void 0===n||n(r)}});return r}function Xe(){return(Xe=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/staff/reset_password/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $e={user:"styles_user__JQBf0",title:"styles_title__OlEMb",space_between:"styles_space_between__Z0Ibu",toggle:"styles_toggle__wBqj6",toggleInp:"styles_toggleInp__Tox8V",userInfo:"styles_userInfo__Pveb6"};function en(e){var n=e.open,t=e.close,r=(0,N.useState)(null),s=(0,D.Z)(r,2),i=s[0],a=s[1],u=(0,N.useRef)(null),o=(0,N.useRef)(null),l=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Ye,onSuccess:function(t){var r;"success"==(null===(r=n.getQueryState("staff"))||void 0===r?void 0:r.status)&&n.setQueryData("staff",(function(e){return e?[].concat((0,J.Z)(e),[t]):[t]})),null===e||void 0===e||e(t)}})}((function(e){a(e),null===t||void 0===t||t()}));return(0,N.useEffect)((function(){!n&&u.current&&o.current&&(l.reset(),u.current.value="",o.current.value="")}),[n,u,o]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Se,{open:n,close:t,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[Oe(l),(0,I.jsxs)(H,{onSubmit:function(){var e,n,t=null===(e=u.current)||void 0===e?void 0:e.value,r=null===(n=o.current)||void 0===n?void 0:n.value;t&&r&&l.mutate({name:t,login:r})},children:[(0,I.jsx)(X,{label:"\u0418\u043c\u044f",children:(0,I.jsx)("input",{ref:u,type:"text",required:!0})}),(0,I.jsx)(X,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:o,placeholder:"\u0410\u043d\u0433\u043b. \u0431\u0443\u043a\u0432\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 _",type:"text",required:!0,onInput:function(e){o.current&&(o.current.value=o.current.value.replaceAll(/[^a-z_\d]/g,""))}})}),(0,I.jsx)("button",{type:"submit",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),l.isLoading&&(0,I.jsx)(O,{})]}),(0,I.jsxs)(Se,{open:!!i,close:function(){return a(null)},title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",null===i||void 0===i?void 0:i.login]}),(0,I.jsxs)("div",{children:["\u041f\u0430\u0440\u043e\u043b\u044c: ",null===i||void 0===i?void 0:i.password]}),(0,I.jsx)("h4",{style:{marginTop:8},children:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e"})]})]})}function nn(e){var n=e.title,t=e.mutationFn,r=e.itemId,s=e.onSuccess,i=e.open,a=e.close,c=t(r,(function(e){null===a||void 0===a||a(),null===s||void 0===s||s(e)}));return(0,N.useEffect)((function(){i||c.reset()}),[i]),(0,I.jsxs)(Se,{open:i,close:a,title:n,children:[Oe(c),c.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){c.mutate()},children:[(0,I.jsx)("h1",{children:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"}),(0,I.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function tn(){var e,n;G("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438");var t=(0,N.useState)(!1),r=(0,D.Z)(t,2),s=r[0],i=r[1],a=(0,N.useState)(-1),u=(0,D.Z)(a,2),o=u[0],l=u[1],d=(0,N.useState)(-1),f=(0,D.Z)(d,2),v=f[0],h=f[1],x=(0,c.useQuery)("staff",qe);return(0,I.jsxs)(z,{centeredPage:!0,gap:8,children:[(0,I.jsx)("h1",{children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),0==(null===(e=x.data)||void 0===e?void 0:e.length)&&(0,I.jsx)("h2",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"}),null===(n=x.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsxs)("div",{className:$e.user,children:[(0,I.jsx)("input",{type:"checkbox",className:$e.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:$e.title,htmlFor:"user".concat(e.id),children:[(0,I.jsx)("div",{children:e.name}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.role}),(0,I.jsx)("div",{className:$e.toggle})]})]}),(0,I.jsxs)("div",{className:$e.userInfo,children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",e.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041f\u0430\u0440\u043e\u043b\u044c: "}),e.password||(0,I.jsx)("button",{className:"button button_light button_small",onClick:function(){return h(e.id)},children:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})]}),(0,I.jsxs)("div",{className:$e.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return l(e.id)},children:"\u0423\u0432\u043e\u043b\u0438\u0442\u044c"})]})]})]},e.id)})),Z("add_staff")&&(0,I.jsxs)("div",{className:$e.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(en,{open:s,close:function(){return i(!1)}}),(0,I.jsx)(nn,{itemId:o,title:"\u0423\u0432\u043e\u043b\u044c\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:Ge,open:o>=0,close:function(){return l(-1)}}),(0,I.jsx)(nn,{itemId:v,title:"\u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:He,open:v>=0,close:function(){return h(-1)}})]})}var rn={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89"};function sn(e){return(0,c.useQuery)(["ticket_types",e],(function(){return function(e){return an.apply(this,arguments)}(e)}))}function an(){return(an=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_types/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(n){return function(e,n){return un.apply(this,arguments)}(e,n)},onSuccess:function(r,s){s.some((function(e){return"delete"==e.action||"update"==e.action}))?t.invalidateQueries(["tickets","".concat(e)],{exact:!0}):t.setQueryData(["ticket_types","".concat(e)],(function(){return r})),null===n||void 0===n||n(r)}});return r}function un(){return(un=(0,a.Z)((0,s.Z)().mark((function e(n,t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/ticket_types/"+n,t);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new f(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e){var n,t,r,s=e.open,i=e.eventId,a=e.close,u=e.setTicet,o=(0,N.useRef)(null),l=(0,N.useRef)(null),d=(0,N.useRef)(null),f=(0,N.useRef)(null),v=(0,N.useRef)(null),h=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Qe,onSuccess:function(t){var r;"success"==(null===(r=n.getQueryState(["tickets","".concat(t.eventId)]))||void 0===r?void 0:r.status)&&n.setQueryData(["tickets","".concat(t.eventId)],(function(e){return e?[].concat((0,J.Z)(e),[t]):[t]})),null===e||void 0===e||e(t)}})}((function(e){u(e),null===a||void 0===a||a()})),x=sn(i);return(0,N.useEffect)((function(){!s&&l.current&&d.current&&f.current&&(l.current.value="",d.current.value="",f.current.value="")}),[s,l,d,f]),(0,I.jsxs)(Se,{open:s,close:a,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[Oe(h),x.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){var e,n,t,r,s,a=null===(e=o.current)||void 0===e?void 0:e.value,c=null===(n=l.current)||void 0===n?void 0:n.value,u=(null===(t=d.current)||void 0===t?void 0:t.value)||"",x=(null===(r=f.current)||void 0===r?void 0:r.value)||"",p=(null===(s=v.current)||void 0===s?void 0:s.value)||"";a&&c&&h.mutate({eventId:parseInt("".concat(i),10),typeId:parseInt(a,10),personName:c,personLink:u,promocode:x,code:p})},children:[(0,I.jsxs)(X,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("select",{ref:o,disabled:0==(null===(n=x.data)||void 0===n?void 0:n.length),required:!0,children:null===(t=x.data)||void 0===t?void 0:t.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(r=x.data)||void 0===r?void 0:r.length)&&(0,I.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,I.jsx)(X,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,I.jsx)("input",{ref:l,type:"text",required:!0})}),(0,I.jsx)(X,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,I.jsx)("input",{ref:d,type:"text"})}),(0,I.jsx)(X,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,I.jsx)("input",{ref:f,type:"text"})}),(0,I.jsx)("button",{type:"submit",disabled:!x.data||0==x.data.length,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),h.isLoading&&(0,I.jsx)(O,{})]})}var ln={root:"styles_root__Lo44K",visible:"styles_visible__icoL+",center:"styles_center__w1Z-q"},dn=t(741),fn=t(5498),vn=t.n(fn);function hn(e){var n=e.event,t=e.ticket,r=e.setTicket,s=(0,N.useState)(null),i=(0,D.Z)(s,2),a=i[0],c=i[1],u=(0,N.useState)(""),o=(0,D.Z)(u,2),l=o[0],d=o[1],f=(0,N.useRef)(null);return(0,N.useEffect)((function(){t&&(c(null),d(""),dn.toDataURL(t.code,{errorCorrectionLevel:"H",scale:8},(function(e,n){return d(n)})))}),[t]),(0,N.useEffect)((function(){if(l&&f.current){var e=setTimeout((function(){l&&f.current&&vn()(f.current).then((function(e){return c(e)}))}),10);return function(){return clearTimeout(e)}}}),[l,f]),(0,I.jsxs)(Se,{open:!!t,close:function(){return r(null)},title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsxs)("div",{ref:f,className:Q(ln.root,!a&&ln.visible),children:[(0,I.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442"}),(0,I.jsx)("div",{className:ln.center,style:{marginTop:"1rem"},children:(0,I.jsx)("img",{src:l,alt:null===t||void 0===t?void 0:t.code})}),(0,I.jsx)("div",{className:ln.center,style:{marginBottom:"1rem"},children:null===t||void 0===t?void 0:t.code}),(0,I.jsxs)("div",{children:[(0,I.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",null===n||void 0===n?void 0:n.name]}),(0,I.jsxs)("div",{children:["\u0414\u0430\u0442\u0430: ",ce(null===n||void 0===n?void 0:n.date)]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",null===t||void 0===t?void 0:t.type]}),(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",null===t||void 0===t?void 0:t.personName]})]})]}),a&&(0,I.jsx)("div",{ref:function(e){e&&(e.innerHTML="",e.appendChild(a))}}),a&&(0,I.jsx)("div",{className:ln.center,children:"\u042d\u0442\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430, \u043c\u043e\u0436\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})}function xn(e){var n,t,r=e.eventId,s=e.open,i=e.close,a=(0,N.useState)(0),c=(0,D.Z)(a,2)[1],u=(0,N.useState)(new Map),o=(0,D.Z)(u,2),l=o[0],d=o[1],f=(0,N.useState)([]),v=(0,D.Z)(f,2),h=v[0],x=v[1],p=sn(r),j=cn(r,i);return(0,N.useEffect)((function(){d(new Map),x([]),c(0)}),[s]),(0,I.jsxs)(Se,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0438\u0434\u043e\u0432 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",children:[Oe(j),p.isLoading&&(0,I.jsx)(O,{}),j.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){(l.size>0||h.length>0)&&j.mutate([].concat((0,J.Z)(h.filter((function(e){return"add"==e.action}))),(0,J.Z)(Array.from(l.values()))))},children:[null===(n=p.data)||void 0===n||null===(t=n.filter((function(e){var n;return"delete"!=(null===(n=l.get(e.id))||void 0===n?void 0:n.action)})))||void 0===t?void 0:t.map((function(e){var n;return(0,I.jsxs)(X,{children:[(0,I.jsx)("input",{type:"text",required:!0,value:(null===(n=l.get(e.id))||void 0===n?void 0:n.name)||e.name,onChange:function(n){l.set(e.id,{id:e.id,name:n.target.value,action:"update"}),c((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",onClick:function(){l.set(e.id,{id:e.id,name:"",action:"delete"}),c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},e.id)})),h.filter((function(e){return"add"==e.action})).map((function(e,n){return(0,I.jsxs)(X,{children:[(0,I.jsx)("input",{type:"text",required:!0,onChange:function(e){h[n].name=e.target.value,c((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",onClick:function(){h[n].action="delete",c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},"new"+n)})),(0,I.jsx)("button",{onClick:function(){h.push({name:"",action:"add"}),c((function(e){return e+1}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function pn(e){var n,t,r=e.eventId,s=e.open,i=e.close,a=(0,N.useRef)(null),c=(0,N.useRef)(null),u=ge(r,i),o=xe(r);return(0,I.jsxs)(Se,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Oe(u),o.isLoading&&(0,I.jsx)(O,{}),u.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){var e,n,t=null===(e=a.current)||void 0===e?void 0:e.value,r=null===(n=c.current)||void 0===n?void 0:n.value;t&&r&&u.mutate({date:r,name:t})},children:[(0,I.jsx)(X,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:a,type:"text",required:!0,defaultValue:null===(n=o.data)||void 0===n?void 0:n.name})}),(0,I.jsx)(X,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:c,type:"datetime-local",required:!0,defaultValue:null===(t=o.data)||void 0===t?void 0:t.date.toISOString().slice(0,-5)})}),(0,I.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function jn(){var e,n,t=(0,N.useState)(!1),s=(0,D.Z)(t,2),i=s[0],a=s[1],c=(0,N.useState)(!1),u=(0,D.Z)(c,2),o=u[0],l=u[1],d=(0,N.useState)(!1),v=(0,D.Z)(d,2),h=v[0],x=v[1],p=(0,N.useState)(!1),j=(0,D.Z)(p,2),m=j[0],_=j[1],b=(0,N.useState)(null),y=(0,D.Z)(b,2),g=y[0],k=y[1],w=(0,r.s0)(),S=(0,r.UO)().eventId,A=xe(S),C=sn(S),Q=Z("add_ticket"),F=Z("change_ticket_types"),M=Z("change_event"),L=Z("delete_event");G((null===(e=A.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,N.useEffect)((function(){A.error instanceof f&&A.error.message.includes("not found")&&w("/not_found",{replace:!0})}),[A.error,w]);var R="/events";return(0,I.jsxs)(I.Fragment,{children:[A.isLoading&&(0,I.jsx)(z,{backLink:R,children:(0,I.jsx)(O,{})}),Oe(A,(function(e){return(0,I.jsx)(z,{backLink:R,centered:!0,children:e})})),A.data&&(0,I.jsxs)(z,{backLink:R,centeredPage:!0,gap:"1rem",children:[(0,I.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",A.data.name]}),(0,I.jsxs)("div",{className:rn.card,children:[(0,I.jsxs)("div",{className:rn.card__header,children:[(0,I.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),M&&(0,I.jsx)("button",{className:"button",onClick:function(){return x(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(pn,{eventId:S,open:h,close:function(){return x(!1)}})]}),(0,I.jsxs)("div",{className:rn.card__body,children:[(0,I.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",A.data.name]}),(0,I.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",ce(A.data.date)]})]})]}),(0,I.jsxs)("div",{className:rn.card,children:[(0,I.jsxs)("div",{className:rn.card__header,children:[(0,I.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),F&&(0,I.jsx)("button",{className:"button",onClick:function(){return _(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(xn,{eventId:S,open:m,close:function(){return _(!1)}})]}),(0,I.jsxs)("div",{className:rn.card__body,children:[C.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Oe(C,(function(e){return(0,I.jsx)("div",{children:e})})),null===(n=C.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("div",{children:e.name},e.id)}))]})]}),(0,I.jsx)(E.rU,{to:"/scanner/".concat(S),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),Q&&(0,I.jsx)("button",{className:"button",onClick:function(){return a(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,I.jsx)(on,{eventId:S,open:i,close:function(){return a(!1)},setTicet:k}),(0,I.jsx)(hn,{ticket:g,event:A.data,setTicket:k}),(0,I.jsx)(E.rU,{to:"/events/".concat(S,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,I.jsx)("div",{className:rn.gap}),(0,I.jsx)("div",{className:rn.right,children:L&&(0,I.jsx)("button",{className:"button",onClick:function(){return l(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,I.jsx)(nn,{title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",onSuccess:function(){return w("/events")},mutationFn:Ze,itemId:S,open:o,close:function(){return l(!1)}})]})]})}var mn={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX"};function _n(){var e,n,t=(0,N.useState)(!1),s=(0,D.Z)(t,2),i=s[0],a=s[1],c=(0,N.useState)(null),u=(0,D.Z)(c,2),o=u[0],l=u[1],d=(0,r.s0)(),v=(0,r.UO)().eventId,h=xe(v),x=Ae(v),p=Z("add_ticket");G([null===(e=h.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,N.useEffect)((function(){h.error instanceof f&&h.error.message.includes("not found")&&d("/not_found",{replace:!0})}),[h.error,d]);var j="/events/".concat(v);return(0,I.jsxs)(I.Fragment,{children:[(h.isLoading||x.isLoading)&&(0,I.jsx)(z,{backLink:j,children:(0,I.jsx)(O,{})}),Oe(h),Oe(x),h.data&&x.isSuccess&&(0,I.jsxs)(z,{backLink:j,centeredPage:!0,gap:"1rem",children:[(0,I.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",h.data.name]}),(0,I.jsxs)("div",{className:mn.right,children:[(0,I.jsx)(E.rU,{target:"_blank",to:"/events/".concat(v,"/print_tickets"),className:"button",children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),p&&(0,I.jsx)("button",{className:"button",onClick:function(){return a(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)(on,{eventId:v,open:i,close:function(){return a(!1)},setTicet:l})]}),(0,I.jsxs)("table",{children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:"11em"},children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsxs)("th",{children:[(0,I.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,I.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]}),(0,I.jsx)("th",{children:"\u0411\u0438\u043b\u0435\u0442"})]})}),(0,I.jsx)("tbody",{children:null===(n=x.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personLink?(0,I.jsx)("a",{href:e.personLink,children:e.personName}):e.personName}),(0,I.jsx)("td",{style:{color:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?"red":""},children:e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:mn.center,children:e.scanned?"\u2713":"\u2716"}),(0,I.jsx)("td",{className:mn.center,children:(0,I.jsx)("button",{onClick:function(){return l(e)},children:"\u0411\u0438\u043b\u0435\u0442"})})]},e.id)}))})]}),(0,I.jsx)(hn,{ticket:o,event:h.data,setTicket:l})]})]})}var bn={root:"styles_root__QCWgG",table:"styles_table__Klrj7",center:"styles_center__pcMYz",mark:"styles_mark__4aU1o"};function yn(){var e,n=(0,r.UO)().eventId,t=xe(n),s=Ae(n);G([null===(e=t.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]);var a=(0,N.useMemo)((function(){if(!s.data||!t.data)return[!1,""];var e=Te(t.data.id,t.data.date);return[s.data.every((function(n){return n.code.startsWith(e)})),e]}),[s.data,t.data]),c=(0,D.Z)(a,2),u=c[0],o=c[1];return(0,N.useEffect)((function(){if(t.isSuccess&&s.isSuccess){var e=setTimeout((function(){return window.print()}),1e3);return function(){return clearTimeout(e)}}}),[t.isSuccess,s.isSuccess]),(0,I.jsxs)(I.Fragment,{children:[(t.isLoading||s.isLoading)&&(0,I.jsx)(O,{}),Oe(t),Oe(s),t.isSuccess&&s.isSuccess&&(0,I.jsx)("div",{className:bn.root,children:(0,I.jsxs)("table",{className:bn.table,children:[(0,I.jsxs)("thead",{children:[(0,I.jsx)("tr",{children:(0,I.jsxs)("th",{colSpan:5,children:[(0,I.jsx)("span",{children:t.data.name}),u&&(0,I.jsx)("span",{style:{marginLeft:"1rem"},children:"|"}),u&&(0,I.jsxs)("span",{style:{marginLeft:"1rem"},children:["\u0412\u0441\u0435 \u043a\u043e\u0434\u044b \u0434\u043e\u0436\u043d\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 ",o]})]})}),(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsxs)("th",{children:[(0,I.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,I.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]})]})]}),(0,I.jsx)("tbody",{children:s.data.map((function(e){return u?(0,i.Z)((0,i.Z)({},e),{},{code:e.code.slice(o.length),sortV:e.code.slice(e.code.lastIndexOf("-"))}):(0,i.Z)((0,i.Z)({},e),{},{sortV:e.code})})).sort((function(e,n){return e.sortV>n.sortV?1:-1})).map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personName}),(0,I.jsx)("td",{children:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?e.type.slice(8):e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:bn.center,children:(0,I.jsx)("span",{className:bn.mark,children:e.scanned&&"\u2713"})})]},e.id)}))})]})})]})}function gn(){var e=(0,N.useState)(""),n=(0,D.Z)(e,2),t=n[0],r=n[1],i=(0,N.useState)(""),c=(0,D.Z)(i,2),u=c[0],o=c[1],l=(0,N.useRef)(null),d=(0,N.useRef)(null);return(0,I.jsxs)(z,{centered:!0,gap:"1rem",children:[(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,s.Z)().mark((function e(){var n,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_errors");case 4:return n=e.sent,e.next=7,n.text();case 7:t=e.sent,r(t),setTimeout((function(){var e,n,t,r;return null===(e=l.current)||void 0===e||null===(n=e.parentElement)||void 0===n?void 0:n.scrollTo(0,null===(t=l.current)||void 0===t||null===(r=t.parentElement)||void 0===r?void 0:r.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"log errors"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,s.Z)().mark((function e(){var n,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log");case 4:return n=e.sent,e.next=7,n.text();case 7:t=e.sent,o(t),setTimeout((function(){var e,n,t,r;return null===(e=d.current)||void 0===e||null===(n=e.parentElement)||void 0===n?void 0:n.scrollTo(0,null===(t=d.current)||void 0===t||null===(r=t.parentElement)||void 0===r?void 0:r.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),o(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"log"}),(0,I.jsx)(Se,{title:"logErrors",open:""!=t,close:function(){return r("")},children:(0,I.jsx)("pre",{ref:l,children:t})}),(0,I.jsx)(Se,{title:"log",open:""!=u,close:function(){return o("")},children:(0,I.jsx)("pre",{ref:d,children:u})})]})}var kn={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function Zn(){var e;G("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");var n=(0,c.useQuery)("users",j);return(0,I.jsx)(z,{centeredPage:!0,gap:8,children:null===(e=n.data)||void 0===e?void 0:e.map((function(e){var t;return(0,I.jsxs)("div",{className:kn.user,children:[(0,I.jsx)("input",{type:"checkbox",className:kn.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:kn.title,htmlFor:"user".concat(e.id),children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:e.login}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:e.name}),null!=e.bossId&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{style:{color:"#990099"},children:null===(t=n.data.find((function(n){return n.id==e.bossId})))||void 0===t?void 0:t.login})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.role}),(0,I.jsx)("div",{className:kn.toggle})]})]}),(0,I.jsxs)("div",{className:kn.userInfo,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Operations"}),(0,I.jsx)("div",{className:kn.operations,children:e.operations.map((function(e,n){return(0,I.jsx)("div",{children:wn(e)},n)}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Access"}),(0,I.jsx)("div",{className:kn.operations,children:e.access.map((function(e,n){return(0,I.jsx)("div",{children:e},n)}))})]})]})]},e.id)}))})}function wn(e){var n={page:"#990099",add:"#008000",change:"#006fb3",delete:"#b30000"};for(var t in n)if(e.startsWith(t))return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{style:{color:n[t]},children:t}),(0,I.jsx)("span",{children:e.slice(t.length)})]});return(0,I.jsx)("span",{children:e})}var Nn={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z"};function Sn(e){var n,t=e.open,r=e.close,s=(0,N.useState)(""),i=(0,D.Z)(s,2),a=i[0],u=i[1],o=(0,N.useRef)(null),l=(0,N.useRef)(null),d=(n=r,(0,c.useMutation)({mutationFn:_,onSuccess:n}));return(0,N.useEffect)((function(){!t&&o.current&&l.current&&(d.reset(),u(""),o.current.value="",l.current.value="")}),[t,o,l]),(0,I.jsxs)(Se,{open:t,close:r,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f",children:[Oe(d),d.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){var e,n,t=null===(e=o.current)||void 0===e?void 0:e.value,r=null===(n=l.current)||void 0===n?void 0:n.value;return!t||t.length<=4?u("\u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):t!=r?u("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):void d.mutate({password:t})},children:[(0,I.jsx)(X,{label:"\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:o,type:"password",required:!0})}),(0,I.jsx)(X,{label:"\u0415\u0449\u0451 \u0440\u0430\u0437",children:(0,I.jsx)("input",{ref:l,type:"password",required:!0})}),""!=a&&(0,I.jsx)("h4",{style:{color:"tomato"},children:a}),(0,I.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function An(){var e,n,t,r=h(),s=(0,N.useRef)(null),a=(0,N.useState)(!1),u=(0,D.Z)(a,2),o=u[0],l=u[1],d=(0,N.useState)(!1),f=(0,D.Z)(d,2),v=f[0],x=f[1],p=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:y,onSuccess:function(t){var r;"success"==(null===(r=n.getQueryState("user"))||void 0===r?void 0:r.status)&&n.setQueryData("user",(function(e){return(0,i.Z)((0,i.Z)({},e),{},{name:t.name})})),null===e||void 0===e||e()}})}();return(0,I.jsxs)(z,{centered:!0,gap:"1rem",children:[(0,I.jsxs)("div",{className:Nn.root,children:[Oe(p),p.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,I.jsx)("div",{children:(0,I.jsx)("input",{type:"text",ref:s,defaultValue:null===(e=r.data)||void 0===e?void 0:e.name,disabled:!o,className:Nn.input})}),(0,I.jsxs)("div",{children:[!o&&(0,I.jsx)("button",{onClick:function(){return l(!0)},className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),o&&(0,I.jsx)("button",{onClick:function(){var e;l(!1),s.current&&(s.current.value=(null===(e=r.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),o&&(0,I.jsx)("button",{onClick:function(){l(!1),s.current&&p.mutate({name:s.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u041b\u043e\u0433\u0438\u043d"}),null===(n=r.data)||void 0===n?void 0:n.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0420\u043e\u043b\u044c"}),null===(t=r.data)||void 0===t?void 0:t.role]}),(0,I.jsx)("div",{children:(0,I.jsx)("button",{className:"button",onClick:function(){return x(!0)},children:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})})]}),(0,I.jsx)(Sn,{open:v,close:function(){return x(!1)}})]})}function In(){var e,n=h();function t(e,t,s){var i;return(0,I.jsx)(r.AW,{path:t,element:null!==(i=n.data)&&void 0!==i&&i.auth?null==e||k(n,e)?s:(0,I.jsx)(W,{}):(0,I.jsx)(r.Fg,{to:"/auth"})})}return(0,I.jsxs)("div",{className:"root",children:[(0,I.jsx)(S,{}),n.isLoading&&(0,I.jsx)(w.Z,{}),Oe(n),n.isSuccess&&(0,I.jsxs)(r.Z5,{children:[(0,I.jsx)(r.AW,{path:"/auth",element:null!==(e=n.data)&&void 0!==e&&e.auth?(0,I.jsx)(r.Fg,{to:"/"}):(0,I.jsx)($,{})}),(0,I.jsx)(r.AW,{path:"/scanner/:eventId",element:(0,I.jsx)(Ue,{})}),t(null,"/",(0,I.jsx)(ee,{})),t(null,"/profile",(0,I.jsx)(An,{})),t("page_events","/events",(0,I.jsx)(ze,{})),t("page_events","/events/:eventId",(0,I.jsx)(jn,{})),t("page_events","/events/:eventId/tickets",(0,I.jsx)(_n,{})),t("page_events","/events/:eventId/print_tickets",(0,I.jsx)(yn,{})),t("page_staff","/staff",(0,I.jsx)(tn,{})),t("page_debug","/debug",(0,I.jsx)(gn,{})),t("page_users","/users",(0,I.jsx)(Zn,{})),t(null,"*",(0,I.jsx)(q,{}))]})]})}}}]);
//# sourceMappingURL=317.6aaf2d60.chunk.js.map