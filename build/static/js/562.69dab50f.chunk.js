"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[562],{886:function(e,t,n){n.r(t),n.d(t,{default:function(){return Jt}});var s=n(7689),r=n(1413),i=n(4165),a=n(5861),c=n(1933),o=n(3144),u=n(5671),l=n(136),d=n(516),h=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n)}((0,n(8737).Z)(Error));function v(e,t,n){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,i.Z)().mark((function e(t,n,s){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n,{method:t,headers:{"Content-Type":"application/json"},body:void 0===s?null:JSON.stringify(s)});case 2:if((r=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,r.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t){return v("POST",e,t)}function p(e,t){return v("DELETE",e,t)}function m(e,t,n){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)((0,i.Z)().mark((function e(t,n,s){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t,n,s);case 2:return r=e.sent,e.next=5,r.json();case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return m("GET",e,t)}function y(e,t){return m("POST",e,t)}function b(e,t){return _.apply(this,arguments)}function _(){return(_=(0,a.Z)((0,i.Z)().mark((function e(t,n){var s,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:n});case 2:return s=e.sent,e.next=5,s.json();case 5:if(r=e.sent,s.ok){e.next=8;break}throw new h(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(0,c.useQuery)("user",(0,a.Z)((0,i.Z)().mark((function e(){var t,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,401!=t.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",roles:[],name:"",operations:[]});case 8:if(t.ok){e.next=10;break}throw new h(n.msg);case 10:return(s=n).auth=!0,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)}))))}function k(e,t){var n,s;return!(null===(n=e.data)||void 0===n||!n.auth||null===(s=e.data)||void 0===s||!s.operations.includes(t))}function Z(e){var t,n,s=w();return!(null===(t=s.data)||void 0===t||!t.auth||null===(n=s.data)||void 0===n||!n.operations.includes(e))}var N=n(5086),S=n(2791);function C(){var e=(0,s.TH)().pathname;return(0,S.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var I=n(184);function A(e,t,n){if(!e.isError)return null;var s=e.error instanceof h?e.error.message:"\u041e\u0448\u0438\u0431\u043a\u0430";return(t||L)(n?n(s):s)}function L(e){return(0,I.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}var M=n(9439);function F(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return!!e})).join(" ")}var E={root:"styles_root__hzHjz",visible:"styles_visible__6aD-n",close:"styles_close__3L8iW",message:"styles_message__oF8zk"};var Q="";function R(){var e=(0,S.useState)(""),t=(0,M.Z)(e,2),n=t[0],s=t[1];return(0,S.useEffect)((function(){var e=setInterval((function(){var e=function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}("MESSAGE_TO_FRONTEND");e!=Q&&s(Q=e||"")}),1e3);return function(){clearInterval(e)}}),[s]),(0,I.jsxs)("div",{className:F(E.root,""!=n&&E.visible),children:[(0,I.jsx)("button",{className:E.close,onClick:function(){return s("")}}),(0,I.jsx)("div",{className:E.message,children:T(n)})]})}function T(e){return'"'==e.at(0)&&(e=e.slice(1)),'"'==e.at(-1)&&(e=e.slice(0,-1)),e}var D={root:"styles_root__4DGhY"};function z(){var e=(0,s.s0)();return(0,I.jsx)("div",{className:D.root,children:(0,I.jsx)("button",{onClick:function(){return e(-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}var O=n(1087),U={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",menu:"styles_menu__WWgPh",menuVisible:"styles_menuVisible__mMGZn"},P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";var q={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function W(e){var t=e.color,n=e.zIndex;return(0,I.jsx)("div",{className:q.root,children:(0,I.jsxs)("div",{className:q.spinner,style:{"--color":t,zIndex:n},children:[(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{})]})})}function V(e){var t,n=e.backLink,r=(0,S.useState)(!1),i=(0,M.Z)(r,2),a=i[0],o=i[1],u=(0,s.TH)(),l=(0,s.s0)(),d=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){return x("/api/logout")},onSuccess:function(){e.setQueryData("user",(function(e){return{auth:!1,id:-1,login:"",roles:[],name:"",operations:[]}}))}})}(),h=w();return(0,I.jsxs)("div",{className:U.root,children:[(0,I.jsxs)("span",{className:U.block,children:[(0,I.jsx)(O.rU,{to:"/",className:U.home,children:(0,I.jsx)("img",{src:P,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),n&&(0,I.jsx)(O.rU,{to:n,children:(0,I.jsx)("button",{className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})}),"/"!=u.pathname&&!n&&(0,I.jsx)("button",{onClick:function(){return l(n||-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,I.jsxs)("span",{className:U.block,children:[(0,I.jsx)("button",{onClick:function(){return o((function(e){return!e}))},className:"button button_light",children:(0,I.jsx)("span",{children:null===(t=h.data)||void 0===t?void 0:t.name})}),(0,I.jsxs)("div",{className:F(U.menu,a&&U.menuVisible),children:[(0,I.jsx)("button",{onClick:function(){return l("/profile")},className:"button button_light",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,I.jsx)("button",{onClick:function(){return d.mutate()},disabled:"idle"!=d.status,className:"button button_light",children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"idle"!=d.status&&(0,I.jsx)(W,{})]})}var B={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredH:"styles_body_centeredH__1xVSd",body_centeredPage:"styles_body_centeredPage__R-EzO"};function H(e){var t=e.children,n=e.className,s=e.backLink,r=e.centeredH,i=void 0!==r&&r,a=e.centered,c=void 0!==a&&a,o=e.centeredPage,u=void 0!==o&&o,l=e.height100,d=void 0!==l&&l,h=e.gap,v=void 0===h?0:h,f=e.padding,x=e.header;return void 0===x&&(x=(0,I.jsx)(V,{backLink:s})),(0,I.jsxs)("div",{className:B.root,style:{maxHeight:d?"100dvh":""},children:[x||(0,I.jsx)("div",{}),(0,I.jsx)("div",{className:F(B.body,n,c&&B.body_centered,i&&B.body_centeredH,u&&B.body_centeredPage),style:{gap:v,maxHeight:d?"100%":"",padding:f},children:t})]})}function J(){return(0,I.jsx)(H,{centered:!0,header:(0,I.jsx)(z,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function Y(){return(0,I.jsx)(H,{centered:!0,header:(0,I.jsx)(z,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var G={form:"styles_form__n7Rcu"},K=n(3433);function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,S.useEffect)((function(){var n=document.title,s="object"!=typeof e?[e]:e;return document.title=[t].concat((0,K.Z)(s)).filter((function(e){return!!e})).join(" | "),function(){document.title=n}}),[e,t])}var $={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function ee(e){var t=e.className,n=e.style,s=e.onSubmit,r=e.children;return(0,I.jsx)("form",{className:F($.form,t),style:n,onSubmit:function(e){e.preventDefault(),s()},children:r})}function te(e){var t=e.label,n=e.className,s=e.style,r=e.children;return(0,I.jsxs)("label",{className:F($.field,n),style:s,children:[(0,I.jsx)("span",{children:t}),r]})}function ne(){X("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,S.useState)(""),t=(0,M.Z)(e,2),n=t[0],s=t[1],r=(0,S.useRef)(null),o=(0,S.useRef)(null),u=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/auth",t);case 2:return(n=e.sent).auth=!0,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(e){t.setQueryData("user",(function(){return e}))},onError:function(t){null===e||void 0===e||e(t instanceof h?t.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(s);return(0,I.jsxs)(H,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,I.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),n&&(0,I.jsx)("h3",{children:n}),u.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{className:G.form,onSubmit:function(){var e,t,n=(null===(e=r.current)||void 0===e?void 0:e.value)||"",s=(null===(t=o.current)||void 0===t?void 0:t.value)||"";u.mutate({login:n,password:s})},children:[(0,I.jsx)(te,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:r,type:"text",name:"login",required:!0})}),(0,I.jsx)(te,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:o,type:"password",name:"password",required:!0})}),(0,I.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==u.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function se(){var e=w();return(0,I.jsxs)(H,{centered:!0,gap:"1em",children:[k(e,"page_events")&&(0,I.jsx)(O.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),k(e,"page_staff")&&(0,I.jsx)(O.rU,{to:"/staff",className:"button button_large",children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),k(e,"page_fonts")&&(0,I.jsx)(O.rU,{to:"/fonts",className:"button button_large",children:"\u0428\u0440\u0438\u0444\u0442\u044b"}),k(e,"page_managers")&&(0,I.jsx)(O.rU,{to:"/managers",className:"button button_large",children:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u044b"}),k(e,"page_debug")&&(0,I.jsx)(O.rU,{to:"/d",className:"button button_large",children:"</>"})]})}var re={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function ie(e){var t=e.children,n=e.open,s=void 0!==n&&n,r=e.close,i=e.title,a=void 0===i?"":i;return(0,I.jsx)("div",{className:F(re.root,s&&re.open),children:(0,I.jsxs)("div",{className:re.popup,children:[(a||r)&&(0,I.jsxs)("div",{className:re.header,children:[(0,I.jsx)("h3",{children:a}),r&&(0,I.jsx)("button",{className:re.close,onClick:r,children:"\u2716"})]}),(0,I.jsx)("div",{className:re.body,children:t})]})})}function ae(){var e=(0,S.useState)(""),t=(0,M.Z)(e,2),n=t[0],s=t[1],r=(0,S.useState)(""),c=(0,M.Z)(r,2),o=c[0],u=c[1],l=(0,S.useState)(""),d=(0,M.Z)(l,2),h=d[0],v=d[1],f=(0,S.useRef)(null),x=(0,S.useRef)(null),p=(0,S.useRef)(null);return(0,I.jsxs)(H,{centered:!0,gap:"1rem",children:[Z("page_debug_users")&&(0,I.jsx)(O.rU,{to:"/d/users",className:"button",children:"Users"}),Z("page_debug_events")&&(0,I.jsx)(O.rU,{to:"/d/events",className:"button",children:"Events"}),(0,I.jsx)(O.rU,{to:"/d/log",className:"button",children:"Log"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_errors");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,s(n),setTimeout((function(){var e,t,n,s;return null===(e=f.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=f.current)||void 0===n||null===(s=n.parentElement)||void 0===s?void 0:s.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),s(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log errors"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_info");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,v(n),setTimeout((function(){var e,t,n,s;return null===(e=p.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=p.current)||void 0===n||null===(s=n.parentElement)||void 0===s?void 0:s.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),v(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log requests"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_frontend");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,u(n),setTimeout((function(){var e,t,n,s;return null===(e=x.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=x.current)||void 0===n||null===(s=n.parentElement)||void 0===s?void 0:s.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),u(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log frontend"}),(0,I.jsx)(ie,{title:"logErrors",open:""!=n,close:function(){return s("")},children:(0,I.jsx)("pre",{ref:f,children:n})}),(0,I.jsx)(ie,{title:"logFrontend",open:""!=o,close:function(){return u("")},children:(0,I.jsx)("pre",{ref:x,children:o})}),(0,I.jsx)(ie,{title:"log",open:""!=h,close:function(){return v("")},children:(0,I.jsx)("pre",{ref:p,children:h})})]})}var ce={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89",line:"styles_line__4myXW",ticketTypes:"styles_ticketTypes__FIDHq"};function oe(e){return e instanceof Array?e.map((function(e){return"".concat(e)})):"".concat(e)}function ue(e,t){t=oe(t),e.invalidateQueries(t,{exact:!0})}function le(e,t,n){var s;t=oe(t),"success"==(null===(s=e.getQueryState(t))||void 0===s?void 0:s.status)&&e.setQueryData(t,(function(e){return e?[].concat((0,K.Z)(e),[n]):[n]}))}function de(e,t,n){var s;t=oe(t),"success"==(null===(s=e.getQueryState(t))||void 0===s?void 0:s.status)&&e.setQueryData(t,(function(e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id==n.id?n:e})))||[]}))}function he(e,t,n){var s;t=oe(t),"success"==(null===(s=e.getQueryState(t))||void 0===s?void 0:s.status)&&e.setQueryData(t,(function(e){return e?e.filter((function(e){return e.id!=n})):[]}))}function ve(e){var t=e;return t.date=new Date(e.date),t}function fe(e){return(0,c.useQuery)(["event","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){var n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/events/"+e);case 2:return n=t.sent,t.abrupt("return",ve(n));case 4:case"end":return t.stop()}}),t)}))))}function xe(e,t){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p("/api/events/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){ue(n,["event",e]),he(n,"events",e),null===t||void 0===t||t()}})}function pe(e,t){return"".concat(e).padStart(t,"0")}function me(e,t,n,s){var r="".concat(e);return"1"==r.at(-1)&&"1"!=r.at(-2)?t:["2","3","4"].includes(r.at(-1)||"")&&"1"!=r.at(-2)?n:s}function je(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return"";var s=[pe(e.getDate(),2),pe(e.getMonth()+1,2)];return n&&s.push("".concat(e.getFullYear())),t&&s.reverse(),s.join(".")}function ge(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="".concat(pe(e.getHours(),2),":").concat(pe(e.getMinutes(),2));return t?n+":".concat(pe(e.getSeconds(),2)):n}function ye(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return je(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+ge(e,t)}function be(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",n=new Date,s=e.getTime()-n.getTime(),r=Math.floor(Math.abs(s)/1e3),i=Math.floor(r/31104e3);r-=60*i*60*24*30*12;var a=Math.floor(r/2592e3);r-=60*a*60*24*30;var c=Math.floor(r/86400);r-=60*c*60*24;var o=Math.floor(r/3600)%24;r-=60*o*60;var u=Math.floor(r/60)%60,l=(r-=60*u)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=i?[i,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=a?[a,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=c?[c,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==t?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=o?[o,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=u?[u,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),h=(0,M.Z)(d,2),v=h[0],f=h[1];if("string"==typeof v)return v;var x="".concat(me.apply(void 0,[v].concat((0,K.Z)(f))));return Math.abs(v)>1&&(x=Math.abs(v)+" "+x),s>0?x="\u0427\u0435\u0440\u0435\u0437 "+x:x+=" \u043d\u0430\u0437\u0430\u0434",x}function _e(e){var t=(0,c.useQueryClient)();return(0,c.useQuery)(["ticket_types",e],(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/events/".concat(e,"/ticket_types"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),{onSuccess:function(e){return e.forEach((function(e){return t.setQueryData(["ticket_type","".concat(e.id)],e)}))}})}function we(e){return(0,c.useQuery)(["ticket_type","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/ticket_types/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),{enabled:e>=0})}function ke(e){var t=e;return e.scannedDate&&(t.scannedDate=new Date(e.scannedDate)),e.createdDate&&(t.createdDate=new Date(e.createdDate)),t}function Ze(e){return(0,c.useQuery)(["tickets","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){var n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/events/".concat(e,"/tickets"));case 2:return n=t.sent,t.abrupt("return",n.map(ke));case 4:case"end":return t.stop()}}),t)}))))}function Ne(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("/api/tickets/"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(s,r){he(n,["tickets",e],r),null===t||void 0===t||t()}});return s}function Se(e){var t,n,s,r=e.open,o=e.eventId,u=e.close,l=e.setTicet,d=(0,S.useState)(-1),h=(0,M.Z)(d,2),v=h[0],f=h[1],x=(0,S.useState)(""),p=(0,M.Z)(x,2),m=p[0],j=p[1],g=(0,S.useState)(""),b=(0,M.Z)(g,2),_=b[0],w=b[1],k=(0,S.useState)(""),Z=(0,M.Z)(k,2),N=Z[0],C=Z[1],L=(0,S.useState)(""),F=(0,M.Z)(L,2),E=F[0],Q=F[1],R=(0,S.useState)(!0),T=(0,M.Z)(R,2),D=T[0],z=T[1],O=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/tickets",t);case 2:return n=e.sent,e.abrupt("return",ke(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){le(t,["tickets",n.eventId],n),null===e||void 0===e||e(n)}});return n}((function(e){l(e),null===u||void 0===u||u()})),U=_e(o);return(0,S.useEffect)((function(){var e,t;r||(z(!0),f((null===(e=U.data)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.id)||-1),j(""),w(""),C(""),Q(""),O.reset())}),[r,U.data]),(0,I.jsxs)(ie,{open:r,close:u,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[A(O),U.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){v>=0&&m&&O.mutate({eventId:parseInt("".concat(o),10),typeId:v,personName:m,personLink:_,promocode:N,code:D?"":E})},children:[(0,I.jsxs)(te,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("select",{value:v,onChange:function(e){var t,n;return f((null===(t=U.data)||void 0===t||null===(n=t[e.target.selectedIndex])||void 0===n?void 0:n.id)||-1)},disabled:0==(null===(t=U.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=U.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(s=U.data)||void 0===s?void 0:s.length)&&(0,I.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,I.jsx)(te,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,I.jsx)("input",{value:m,onChange:function(e){return j(e.target.value)},type:"text",required:!0})}),(0,I.jsx)(te,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,I.jsx)("input",{value:_,onChange:function(e){return w(e.target.value)},type:"text"})}),(0,I.jsx)(te,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,I.jsx)("input",{value:N,onChange:function(e){return C(e.target.value)},type:"text"})}),(0,I.jsxs)("label",{children:[(0,I.jsx)("input",{type:"checkbox",checked:D,onChange:function(e){return z(e.target.checked)}}),(0,I.jsx)("span",{style:{color:D?"darkgreen":"darkred"},children:"\u0410\u0432\u0442\u043e-\u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430"})]}),!D&&(0,I.jsxs)(te,{label:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430 (\u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434)",children:[(0,I.jsx)("div",{style:{color:"darkred",fontSize:"0.9rem"},children:"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438!"}),(0,I.jsx)("input",{value:E,onChange:function(e){return Q(e.target.value)},type:"text"})]}),(0,I.jsx)("button",{type:"submit",className:"button button_small",disabled:!U.data||0==U.data.length,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),O.isLoading&&(0,I.jsx)(W,{})]})}var Ce=n(7762),Ie={root:"styles_root__+QOp3",canvas:"styles_canvas__wzjs3",inspector:"styles_inspector__TrPRu",inspector_open:"styles_inspector_open__h5KZj",fields:"styles_fields__fz+aE",colorInput:"styles_colorInput__8Ty5B",fontInput:"styles_fontInput__zF4OQ",panel:"styles_panel__yLWcU",br:"styles_br__7BTyB",footer:"styles_footer__ADD9E"};function Ae(e,t,n){return Le.apply(this,arguments)}function Le(){return(Le=(0,a.Z)((0,i.Z)().mark((function e(t,n,s){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n=new FileReader;n.addEventListener("loadend",(function(t){e({result:n.result,error:n.error})})),n.readAsDataURL(t)}));case 2:if(!(r=e.sent).error){e.next=6;break}return console.error(r.error),e.abrupt("return",null);case 6:return e.abrupt("return",{data:r.result,name:n,accessEventId:s});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=n(741);function Fe(e,t,n){return new FontFace(e,'url("/api/fonts/'.concat(t,'")  format("').concat(Ee[n],'")'))}var Ee={otf:"opentype",ttf:"truetype",woff:"woff",woff2:"woff2"},Qe=function(){function e(t){var n=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,u.Z)(this,e),this.fontTypes=t,this.viewMode=r,this.editor=null,this.img=null,this.imgQr=new Image,this.qrLast=0,this.imgFile=null,this.data={width:0,height:0,objects:[]},this.canvas=null,this.ctx=null,this.loadingImg=!1,this.loadingFont=!1,this.loadingFonts=[],this.ticket=null,this.fonts=[],this.listenerResize=function(){return n.draw()},this.listenerKeydown=function(e){var t;"Delete"==e.key&&null!==(t=n.editor)&&void 0!==t&&t.deleteSelectedObj()&&n.draw()},this.listenerMouseDown=function(e){var t;null!==(t=n.editor)&&void 0!==t&&t.mouseDown(e.offsetX,e.offsetY,e.button)&&n.draw()},this.listenerMouseMove=function(e){var t;null!==(t=n.editor)&&void 0!==t&&t.mouseMove(e.offsetX,e.offsetY)&&n.draw()},this.listenerMouseUp=function(e){var t;null!==(t=n.editor)&&void 0!==t&&t.mouseUp(e.offsetX,e.offsetY,e.button)&&n.draw()},this.listenerContextMenu=function(e){e.preventDefault()},this.listenerWheel=function(e){var t;e.preventDefault(),null!==(t=n.editor)&&void 0!==t&&t.wheel(e.offsetX,e.offsetY,e.deltaY)&&n.draw()},this.inspectorSet=function(){},this.inspectorInput=function(e,t){var s;null===(s=n.editor)||void 0===s||s.inspectorInput(e,t),"f"==e&&n.loadFonts(),n.draw()},s&&!r&&(window.addEventListener("resize",this.listenerResize),window.addEventListener("keydown",this.listenerKeydown))}return(0,o.Z)(e,[{key:"loading",get:function(){return this.loadingImg||this.loadingFont}},{key:"setData",value:function(e,t){this.img=null,this.imgFile=null,null!=e&&this.loadImage(e),this.data=t||this.createNewData(),this.data.objects.forEach((function(e){return void 0==e.f?e.f=-1:{}})),this.data.objects.find((function(e){return"code"==e.type}))||this.data.objects.push({type:"code",x:0,y:0,w:0,h:0,c:"#000000",f:-1}),this.editor=null,this.reRenderQR(),this.loadFonts(),this.draw()}},{key:"setViewTicket",value:function(e){var t;this.ticket=e,null===(t=this.editor)||void 0===t||t.setViewTicket(e),this.reRenderQR(),this.draw()}},{key:"setNewImage",value:function(e){var t=this;this.imgFile=e;var n=new Image;this.img=n,this.img.addEventListener("load",(function(){URL.revokeObjectURL(s),t.loadingImg=!1,t.editor=null,t.draw()}));var s=URL.createObjectURL(e);this.loadingImg=!0,this.img.src=s}},{key:"setImage",value:function(e){this.imgFile=null,this.img=null,null!=e&&this.loadImage(e)}},{key:"setCanvas",value:function(e){this.removeCanvasListeners(),this.canvas=e,this.ctx=e.getContext("2d"),this.draw(),this.viewMode||(e.addEventListener("mousedown",this.listenerMouseDown),e.addEventListener("mousemove",this.listenerMouseMove),e.addEventListener("mouseup",this.listenerMouseUp),e.addEventListener("wheel",this.listenerWheel),e.addEventListener("contextmenu",this.listenerContextMenu))}},{key:"setInspector",value:function(e){this.inspectorSet=e}},{key:"reset",value:function(){this.editor=null,this.img=null,this.imgQr=new Image,this.imgFile=null,this.data={width:0,height:0,objects:[]},this.loadingImg=!1,this.loadingFont=!1,this.ticket=null,this.inspectorSet(null),this.draw()}},{key:"getData",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.data,!this.imgFile){e.next=7;break}return e.next=4,Ae(this.imgFile,t,n);case 4:e.t1=e.sent,e.next=8;break;case 7:e.t1=null;case 8:return e.t2=e.t1,e.abrupt("return",{pattern:e.t0,img:e.t2});case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){window.removeEventListener("resize",this.listenerResize),window.removeEventListener("keydown",this.listenerKeydown),this.removeCanvasListeners(),this.inspectorSet(null)}},{key:"drawObject",value:function(e){var t;null===(t=this.editor)||void 0===t||t.drawObject(e),this.draw()}},{key:"resetZoom",value:function(){this.editor&&(this.editor.resetZoom(),this.draw())}},{key:"fitZoom",value:function(){this.editor&&(this.editor.fitToView(),this.draw())}},{key:"removeCanvasListeners",value:function(){this.canvas&&(this.canvas.removeEventListener("mousedown",this.listenerMouseDown),this.canvas.removeEventListener("mousemove",this.listenerMouseMove),this.canvas.removeEventListener("mouseup",this.listenerMouseUp),this.canvas.removeEventListener("wheel",this.listenerWheel),this.canvas.removeEventListener("contextmenu",this.listenerContextMenu))}},{key:"loadImage",value:function(e){var t=this,n=new Image;this.img=n,this.img.addEventListener("load",(function(){t.loadingImg=!1,t.editor=null,t.draw()})),this.loadingImg=!0,this.img.src="/api/img/".concat(e)}},{key:"loadFonts",value:function(){var e=this;if(this.loadingFont=!0,this.fontTypes){for(var t=this.data.objects.map((function(e){return e.f})),n=this.fonts.length-1;n>=0;n--){var s=this.fonts[n];t.includes(s.id)||(document.fonts.delete(s.font),this.fonts.splice(n,1))}var r,i=this.fonts.map((function(e){return e.id})),a=(0,Ce.Z)(this.data.objects);try{var c=function(){var t=r.value;if(t.f<0||i.includes(t.f))return 1;var n=Fe("font_".concat(t.f),t.f,e.fontTypes[t.f]);e.fonts.push({id:t.f,font:n}),e.loadingFonts.push(n),document.fonts.add(n),n.load().then((function(){e.loadingFonts.splice(e.loadingFonts.indexOf(n),1),e.loadingFont=0!=e.loadingFonts.length,e.loadingFont||e.draw()}))};for(a.s();!(r=a.n()).done;)c()}catch(o){a.e(o)}finally{a.f()}this.loadingFont=0!=this.loadingFonts.length}}},{key:"reRenderQR",value:function(){var t,n,s=this,r=(null===(t=this.data.objects.find((function(e){return"qr"==e.type})))||void 0===t?void 0:t.c)||"#000000",i=++this.qrLast;e.renderQRCode((null===(n=this.ticket)||void 0===n?void 0:n.code)||"23-31224-34-07-4321",r,(function(e){i==s.qrLast&&(s.imgQr=e,s.editor&&(s.editor.setQr(e),s.draw()))}))}},{key:"setCursor",value:function(e){this.canvas&&(this.canvas.style.cursor=e)}},{key:"draw",value:function(){if(this.canvas){var e=this.canvas.parentElement;if(e){var t=e.clientWidth,n=e.clientHeight;if(this.viewMode&&this.img&&!this.loading&&(t=this.data.width,n=this.data.height),this.canvas.width=t,this.canvas.style.width="".concat(t,"px"),this.canvas.height=n,this.canvas.style.height="".concat(n,"px"),this.ctx)if(this.ctx.fillStyle="#00000033",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.img&&!this.loading)this.editor||(this.editor=new Re(this.img,this.data,this.reRenderQR.bind(this),this.setCursor.bind(this),this.inspectorSet,this.imgQr,this.viewMode),this.editor.setCanvasSize({w:t,h:n}),this.editor.fitToView()),this.editor.setCanvasSize({w:t,h:n}),this.ctx.imageSmoothingEnabled=!1,this.ticket&&this.editor.setViewTicket(this.ticket),this.editor.draw(this.ctx);else{this.ctx.fillStyle="black";var s=this.loading?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430":this.viewMode?"\u042d\u0442\u043e\u0442 \u0442\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u043e\u0432\n\u043d\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443";this.drawTextAtCenter(s,32)}}}}},{key:"drawTextAtCenter",value:function(e,t){if(this.ctx&&this.canvas){var n=this.canvas.width,s=this.canvas.height;this.ctx.textAlign="center",this.ctx.font="".concat(t,"px Arial");for(var r=e.split("\n"),i=-r.length*t*.8/2,a=r.length*t*.8,c=0;c<r.length;c++)this.ctx.fillText(r[c],n/2,s/2+i+a*c)}}},{key:"createNewData",value:function(){return{height:0,width:0,objects:[{type:"qr",x:0,y:0,w:0,h:0,c:"#000000",f:-1},{type:"code",x:0,y:0,w:0,h:0,c:"#000000",f:-1},{type:"name",x:0,y:0,w:0,h:0,c:"#000000",f:-1},{type:"promo",x:0,y:0,w:0,h:0,c:"#000000",f:-1}]}}}],[{key:"renderQRCode",value:function(e,t,n){Me.toDataURL(e,{errorCorrectionLevel:"H",scale:10,margin:2,color:{light:"#ffffff00",dark:t}},(function(e,t){e&&console.error(e);var s=new Image;s.addEventListener("load",(function(){n(s)})),s.src=t}))}}]),e}(),Re=function(){function e(t,n,s,r,i,a,c){var o=this;(0,u.Z)(this,e),this.img=t,this.data=n,this.reRenderQR=s,this.setCursor=r,this.setInspector=i,this.imgqr=a,this.viewMode=c,this.transform={x:0,y:0,s:1},this.moving={sx:0,sy:0,vx:0,vy:0,vw:0,vh:0,mode:null},this.drawing={sx:0,sy:0,ex:0,ey:0,active:!1,type:null},this.resizing={dir:[0,0],keepAspect:!1,aspect:1},this.canvasSize={w:0,h:0},this.selected=-1,this.selectionBorder=16,this.ticket=null,this.inspectorInput=function(e,t){if(!(o.selected<0)){var n=o.data.objects[o.selected];if(["x","y","w","h","f"].includes(e)){var s=e,r=t;n[s]=Math.max(r,0),"qr"==n.type&&("w"==s&&(n.h=n.w),"h"==s&&(n.w=n.h))}else"c"==e&&(n[e]=t,"qr"==n.type&&o.reRenderQR())}},n.width=t.width,n.height=t.height}return(0,o.Z)(e,[{key:"fitToView",value:function(){var e=this.viewMode?0:100;this.transform.s=Math.min((this.canvasSize.w-e)/this.img.width,(this.canvasSize.h-e)/this.img.height),this.transform.x=(this.canvasSize.w-this.img.width*this.transform.s)/2,this.transform.y=(this.canvasSize.h-this.img.height*this.transform.s)/2,this.restrictView()}},{key:"setCanvasSize",value:function(e){this.canvasSize=e}},{key:"setQr",value:function(e){this.imgqr=e}},{key:"setViewTicket",value:function(e){this.ticket=e}},{key:"draw",value:function(e){var t,n,s,r,i,a;e.save(),e.translate(this.transform.x,this.transform.y),e.scale(this.transform.s,this.transform.s),e.fillStyle="black",e.fillRect(0,0,this.img.width,this.img.height),e.drawImage(this.img,0,0);for(var c={name:null!==(t=null===(n=this.ticket)||void 0===n?void 0:n.personName)&&void 0!==t?t:"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432\u0438\u0447 \u592a\u9633",promo:null!==(s=null===(r=this.ticket)||void 0===r?void 0:r.promocode)&&void 0!==s?s:"\u041d\u0435\u0443\u0442\u043e\u043c\u0438\u043c\u044b\u0439",code:null!==(i=null===(a=this.ticket)||void 0===a?void 0:a.code)&&void 0!==i?i:"23-31224-34-07-4321"},o=0;o<this.data.objects.length;o++){var u=this.data.objects[o];if(e.fillStyle=u.c,"qr"==u.type)this.imgqr.complete&&0!=this.imgqr.naturalHeight?e.drawImage.apply(e,[this.imgqr].concat((0,K.Z)(Oe(u)))):e.fillRect.apply(e,(0,K.Z)(Oe(u)));else if("name"==u.type||"promo"==u.type||"code"==u.type){var l="font_".concat(u.f,", Arial");e.font="".concat(u.h,"px ").concat(l),e.fillText(c[u.type],u.x,u.y+.8*u.h,u.w)}else e.fillRect.apply(e,(0,K.Z)(Oe(u)));this.selected==o&&(e.strokeStyle="orange",e.lineWidth=4/this.transform.s,e.strokeRect.apply(e,(0,K.Z)(Oe(u))))}if(this.drawing.active){e.strokeStyle="white",e.lineWidth=4/this.transform.s;var d=this.drawing.ex-this.drawing.sx,h=this.drawing.ey-this.drawing.sy;"qr"==this.drawing.type&&(h=d),e.strokeRect(this.drawing.sx,this.drawing.sy,d,h),e.strokeStyle="black",e.lineWidth=2/this.transform.s,e.strokeRect(this.drawing.sx,this.drawing.sy,d,h)}e.restore()}},{key:"drawObject",value:function(e){this.drawing.type=e,this.selected=-1,this.setInspector(null)}},{key:"deleteSelectedObj",value:function(){if(this.selected<0)return!1;var e=this.data.objects[this.selected];return e.x=0,e.y=0,e.w=0,e.h=0,this.selected=-1,this.setInspector(null),!0}},{key:"resetZoom",value:function(){this.transform.s=1,this.restrictView()}},{key:"mouseDown",value:function(e,t,n){if(this.moving.sx=e,this.moving.sy=t,2==n)return this.moving.vx=this.transform.x,this.moving.vy=this.transform.y,this.moving.mode="view",void this.setCursor("move");if(0==n){if(this.drawing.type){var s=this.pointToWorld(e,t),r=(0,M.Z)(s,2);return this.drawing.sx=r[0],this.drawing.sy=r[1],void(this.drawing.active=!0)}for(var i=0;i<this.data.objects.length;i++){var a=this.data.objects[i],c=this.pointToWorld(e,t),o=(0,M.Z)(c,2),u=o[0],l=o[1],d=!1;if(this.selected==i&&(this.resizing.dir=De(u,l,a,this.selectionBorder/this.transform.s),d=0!=this.resizing.dir[0]||0!=this.resizing.dir[1],this.resizing.aspect=a.h/a.w,this.resizing.keepAspect="qr"==a.type),Te(u,l,a)||d)return this.selected=i,this.setInspector(a),this.moving.vx=a.x,this.moving.vy=a.y,this.moving.vw=a.w,this.moving.vh=a.h,this.moving.mode=d?"resize":"obj",this.setCursor(d?ze(this.resizing.dir):"move"),!0}var h=this.selected>=0;return this.selected=-1,this.setInspector(null),h}}},{key:"mouseMove",value:function(e,t){if("view"==this.moving.mode)return this.transform.x=this.moving.vx+(e-this.moving.sx),this.transform.y=this.moving.vy+(t-this.moving.sy),this.restrictView(),!0;if("obj"==this.moving.mode&&this.selected>=0){var n=this.data.objects[this.selected];return n.x=this.moving.vx+(e-this.moving.sx)/this.transform.s,n.y=this.moving.vy+(t-this.moving.sy)/this.transform.s,n.x=Math.round(n.x),n.y=Math.round(n.y),this.setInspector(n),!0}if("resize"==this.moving.mode&&this.selected>=0){var s=this.data.objects[this.selected],r=(e-this.moving.sx)/this.transform.s,i=(t-this.moving.sy)/this.transform.s,a=(0,M.Z)(this.resizing.dir,2),c=a[0],o=a[1];return this.resizing.keepAspect?(c>0&&(s.w=this.moving.vw+r,s.h=s.w*this.resizing.aspect,o<0&&(s.y=this.moving.vy-(s.h-this.moving.vh)),0==o&&(s.y=this.moving.vy-(s.h-this.moving.vh)/2)),c<0&&(s.x=this.moving.vx+r,s.w=this.moving.vw-r,s.h=s.w*this.resizing.aspect,o<0&&(s.y=this.moving.vy-(s.h-this.moving.vh)),0==o&&(s.y=this.moving.vy-(s.h-this.moving.vh)/2)),0==c&&(o>0&&(s.h=this.moving.vh+i),o<0&&(s.y=this.moving.vy+i,s.h=this.moving.vh-i),s.w=s.h/this.resizing.aspect,s.x=this.moving.vx-(s.w-this.moving.vw)/2)):(c>0&&(s.w=this.moving.vw+r),c<0&&(s.x=this.moving.vx+r,s.w=this.moving.vw-r),o>0&&(s.h=this.moving.vh+i),o<0&&(s.y=this.moving.vy+i,s.h=this.moving.vh-i)),s.w=Math.max(s.w,5),s.h=Math.max(s.h,5),s.x=Math.round(s.x),s.y=Math.round(s.y),s.w=Math.round(s.w),s.h=Math.round(s.h),this.setInspector(s),!0}if(this.drawing.active){var u=this.pointToWorld(e,t),l=(0,M.Z)(u,2);return this.drawing.ex=l[0],this.drawing.ey=l[1],!0}if(this.selected>=0){var d=this.pointToWorld(e,t),h=(0,M.Z)(d,2),v=De(h[0],h[1],this.data.objects[this.selected],this.selectionBorder/this.transform.s);0!=v[0]||0!=v[1]?this.setCursor(ze(v)):this.setCursor("default")}}},{key:"mouseUp",value:function(e,t,n){var s=this;if(this.moving.mode=null,this.setCursor("default"),this.drawing.active){var r=this.pointToWorld(e,t),i=(0,M.Z)(r,2);this.drawing.ex=i[0],this.drawing.ey=i[1];var a=this.data.objects.find((function(e){return e.type==s.drawing.type}));return a?(a.x=this.drawing.sx,a.y=this.drawing.sy,a.w=this.drawing.ex-this.drawing.sx,a.h=this.drawing.ey-this.drawing.sy,a.w<0&&(a.x+=a.w,a.w*=-1),a.h<0&&(a.y+=a.h,a.h*=-1),a.x=Math.round(a.x),a.y=Math.round(a.y),a.w=Math.round(a.w),a.h=Math.round(a.h),this.drawing.active=!1,this.drawing.type=null,"qr"==a.type&&(a.h=a.w),!0):(console.error("Ticket editor: drawing obj not found"),!1)}}},{key:"wheel",value:function(e,t,n){var s=(e-this.transform.x)/this.transform.s,r=(t-this.transform.y)/this.transform.s;n>0?this.transform.s/=1.1:this.transform.s*=1.1;return this.transform.s=Math.max(this.transform.s,Math.min((this.canvasSize.w-200)/this.img.width,(this.canvasSize.h-200)/this.img.height)),this.transform.x=e-s*this.transform.s,this.transform.y=t-r*this.transform.s,this.restrictView(),!0}},{key:"restrictView",value:function(){var e=100,t=this.img.width*this.transform.s,n=this.img.height*this.transform.s;t>this.canvasSize.w?this.transform.x=Math.min(Math.max(this.transform.x,-t+this.canvasSize.w-e),e):this.transform.x=Math.min(Math.max(this.transform.x,-t+e),this.canvasSize.w-e),n>this.canvasSize.h?this.transform.y=Math.min(Math.max(this.transform.y,-n+this.canvasSize.h-e),e):this.transform.y=Math.min(Math.max(this.transform.y,-n+e),this.canvasSize.h-e)}},{key:"pointToWorld",value:function(e,t){return[(e-this.transform.x)/this.transform.s,(t-this.transform.y)/this.transform.s]}},{key:"pointToScreen",value:function(e,t){return[e*this.transform.s+this.transform.x,t*this.transform.s+this.transform.y]}}]),e}();function Te(e,t,n){return e>n.x&&e<n.x+n.w&&t>n.y&&t<n.y+n.h}function De(e,t,n,s){var r=[0,0];return Te(e,t,{x:n.x-s,y:n.y-s,w:n.w+2*s,h:n.h+2*s})?(Math.abs(e-n.x)<=s&&(r[0]=-1),Math.abs(e-(n.x+n.w))<=s&&(r[0]=1),Math.abs(t-n.y)<=s&&(r[1]=-1),Math.abs(t-(n.y+n.h))<=s&&(r[1]=1),r):r}function ze(e){var t=(0,M.Z)(e,2),n=t[0],s=t[1];return 0==n?0==s?"default":"n-resize":n>0?0==s?"e-resize":s>0?"nw-resize":"ne-resize":n<0?0==s?"e-resize":s>0?"ne-resize":"nw-resize":"default"}function Oe(e){return[e.x,e.y,e.w,e.h]}function Ue(e){var t=e.editor,n=e.fonts,s=(0,S.useState)(0),r=(0,M.Z)(s,2)[1],i=(0,S.useState)(null),a=(0,M.Z)(i,2),c=a[0],o=a[1],u=function(){return r((function(e){return e+1}))};return t.setInspector((function(e){o(e),u()})),(0,I.jsxs)("div",{className:F(Ie.inspector,c&&Ie.inspector_open),children:[(0,I.jsx)("h2",{children:{qr:"QR \u043a\u043e\u0434",code:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",name:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",promo:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434","":""}[(null===c||void 0===c?void 0:c.type)||""]}),(0,I.jsxs)("div",{className:Ie.fields,children:[(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"X:"}),(0,I.jsx)("input",{type:"number",value:(null===c||void 0===c?void 0:c.x)||0,onInput:function(e){t.inspectorInput("x",e.target.valueAsNumber),u()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"Y:"}),(0,I.jsx)("input",{type:"number",value:(null===c||void 0===c?void 0:c.y)||0,onInput:function(e){t.inspectorInput("y",e.target.valueAsNumber),u()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"\u0428\u0438\u0440\u0438\u043d\u0430:"}),(0,I.jsx)("input",{type:"number",value:(null===c||void 0===c?void 0:c.w)||0,onInput:function(e){t.inspectorInput("w",e.target.valueAsNumber),u()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"\u0412\u044b\u0441\u043e\u0442\u0430:"}),(0,I.jsx)("input",{type:"number",value:(null===c||void 0===c?void 0:c.h)||0,onInput:function(e){t.inspectorInput("h",e.target.valueAsNumber),u()}})]})]}),(0,I.jsxs)("label",{className:Ie.colorInput,children:[(0,I.jsx)("span",{children:"\u0426\u0432\u0435\u0442:"}),(0,I.jsx)("input",{type:"color",value:(null===c||void 0===c?void 0:c.c)||"#000000",onInput:function(e){t.inspectorInput("c",e.target.value),u()}})]}),"qr"!=(null===c||void 0===c?void 0:c.type)&&(0,I.jsxs)("label",{className:Ie.fontInput,children:[(0,I.jsx)("span",{children:"\u0428\u0440\u0438\u0444\u0442:"}),(0,I.jsxs)("select",{value:(null===c||void 0===c?void 0:c.f)||-1,onChange:function(e){t.inspectorInput("f",parseInt(e.target.value)||-1),u()},children:[(0,I.jsx)("option",{value:-1,children:"Arial"}),n.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]})]})}function Pe(){return(0,c.useQuery)("fonts",(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/fonts");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))))}function qe(e){var t,n=e.typeId,s=e.eventId,r=e.open,o=e.close,u=We(),l=function(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y("/api/ticket_types/"+e,n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(s){n.setQueryData(["ticket_type","".concat(e)],s),de(n,["ticket_types",e],s),null===t||void 0===t||t(s)}});return s}(n,o),d=we(n),h=Pe(),v=(0,S.useRef)(null),f=(0,S.useState)(!1),x=(0,M.Z)(f,2),p=x[0],m=x[1],j=(0,S.useState)(!1),g=(0,M.Z)(j,2),b=g[0],_=g[1],w=null==(null===(t=d.data)||void 0===t?void 0:t.imageId);return(0,S.useEffect)((function(){r||(l.reset(),m(!1),_(!1),u.reset())}),[r,u]),(0,S.useEffect)((function(){var e;r&&d.data&&(u.setData(d.data.imageId,JSON.parse(JSON.stringify(d.data.pattern))),m(!(null!==(e=d.data)&&void 0!==e&&e.imageId)))}),[d.data,r,u]),(0,S.useEffect)((function(){v.current&&u.setCanvas(v.current)}),[v,u]),(0,I.jsxs)(ie,{open:r,close:o,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[A(d),A(h),A(l),d.isLoading&&(0,I.jsx)(W,{}),h.isLoading&&(0,I.jsx)(W,{}),l.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)("div",{className:Ie.root,children:[(0,I.jsxs)("div",{className:Ie.canvas,children:[(0,I.jsx)("canvas",{ref:v}),(0,I.jsx)(Ue,{editor:u,fonts:h.data||[]})]}),(0,I.jsxs)("div",{className:Ie.panel,children:[(0,I.jsx)("span",{children:"\u041d\u0430\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b:"}),(0,I.jsx)("button",{className:"button",onClick:function(){return u.drawObject("qr")},children:"QR \u043a\u043e\u0434"}),(0,I.jsx)("button",{className:"button",onClick:function(){return u.drawObject("code")},children:"\u041a\u043e\u0434"}),(0,I.jsx)("button",{className:"button",onClick:function(){return u.drawObject("name")},children:"\u0418\u043c\u044f \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f"}),(0,I.jsx)("button",{className:"button",onClick:function(){return u.drawObject("promo")},children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsx)("span",{className:Ie.br}),(0,I.jsx)("button",{className:"button icon",onClick:function(){return u.fitZoom()},children:"fit_screen"}),(0,I.jsx)("button",{className:"button",onClick:function(){return u.resetZoom()},children:"1:1"})]}),(0,I.jsxs)("div",{className:Ie.footer,children:[(0,I.jsx)("div",{children:p?(0,I.jsxs)(I.Fragment,{children:[!w&&(0,I.jsx)("button",{className:"button",onClick:function(){return m(!1)},children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,I.jsx)("label",{children:(0,I.jsx)("input",{type:"file",onChange:function(e){e.target.files&&e.target.files[0]&&(u.setNewImage(e.target.files[0]),m(!1),_(!0))},accept:"image/png, image/jpeg, image/gif"})})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("button",{className:"button",onClick:function(){return m(!0)},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"}),b&&!w&&(0,I.jsx)("button",{className:"button",onClick:function(){var e;_(!1),u.setImage((null===(e=d.data)||void 0===e?void 0:e.imageId)||null)},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438"})]})}),(0,I.jsxs)("div",{children:[(0,I.jsx)("button",{className:"button",onClick:function(){return null===o||void 0===o?void 0:o()},children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getData("ticket_".concat(n),s);case 2:t=e.sent,l.mutate(t);case 4:case"end":return e.stop()}}),e)}))),children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]})]})]})}function We(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,S.useState)(0),n=(0,M.Z)(t,2),s=(n[0],n[1]),r=Pe(),i=null;if(r.data){i={};var a,c=(0,Ce.Z)(r.data||[]);try{for(c.s();!(a=c.n()).done;){var o=a.value;i[o.id]=o.type}}catch(l){c.e(l)}finally{c.f()}}var u=(0,S.useRef)(new Qe(i,!1,e));return(0,S.useEffect)((function(){return u.current=new Qe(i,!0,e),s((function(e){return e+1})),function(){return u.current.destroy()}}),[e,r.data]),u.current}function Ve(e){var t=e.ticket,n=We(!0),s=we((null===t||void 0===t?void 0:t.typeId)||-1),r=(0,S.useRef)(null);return(0,S.useEffect)((function(){t||n.reset()}),[t,n]),(0,S.useEffect)((function(){t&&s.data&&(n.setData(s.data.imageId,JSON.parse(JSON.stringify(s.data.pattern))),n.setViewTicket(t))}),[s.data,t,n]),(0,S.useEffect)((function(){r.current&&n.setCanvas(r.current)}),[r,n]),(0,I.jsxs)("div",{style:{minWidth:400,minHeight:300},children:[s.isLoading&&(0,I.jsx)(W,{}),A(s),(0,I.jsx)("canvas",{ref:r,onClick:function(){var e;r.current&&t&&null!==(e=s.data)&&void 0!==e&&e.imageId&&function(e,t){var n=document.createElement("a");n.setAttribute("download",t),e.toBlob((function(e){if(e){var t=URL.createObjectURL(e);n.setAttribute("href",t),n.click(),URL.revokeObjectURL(t)}}))}(r.current,"ticket_".concat(t.code,".png"))}})]})}var Be={root:"styles_root__Lo44K",visible:"styles_visible__icoL+",center:"styles_center__w1Z-q"},He=n(5498),Je=n.n(He);function Ye(e){var t=e.event,n=e.ticket,s=e.close,r=(0,S.useState)(null),i=(0,M.Z)(r,2),a=i[0],c=i[1],o=(0,S.useState)(""),u=(0,M.Z)(o,2),l=u[0],d=u[1],h=(0,S.useRef)(null);return(0,S.useEffect)((function(){n&&(c(null),d(""),Me.toDataURL(n.code,{errorCorrectionLevel:"H",scale:8},(function(e,t){return d(t)})))}),[n]),(0,S.useEffect)((function(){if(n&&l&&h.current){var e=setTimeout((function(){l&&h.current&&Je()(h.current).then((function(e){return c(e)}))}),10);return function(){return clearTimeout(e)}}}),[n,l,h]),(0,I.jsxs)(ie,{open:!!n,close:s,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsxs)("div",{ref:h,className:F(Be.root,!a&&Be.visible),children:[(0,I.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442"}),(0,I.jsx)("div",{className:Be.center,style:{marginTop:"1rem"},children:(0,I.jsx)("img",{src:l,alt:null===n||void 0===n?void 0:n.code})}),(0,I.jsx)("div",{className:Be.center,style:{marginBottom:"1rem"},children:null===n||void 0===n?void 0:n.code}),(0,I.jsxs)("div",{children:[(0,I.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",null===t||void 0===t?void 0:t.name]}),(0,I.jsxs)("div",{children:["\u0414\u0430\u0442\u0430: ",je(null===t||void 0===t?void 0:t.date)]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",null===n||void 0===n?void 0:n.type]}),(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",null===n||void 0===n?void 0:n.personName]})]})]}),a&&(0,I.jsx)("div",{ref:function(e){e&&(e.innerHTML="",e.appendChild(a))}}),a&&(0,I.jsx)("div",{className:Be.center,children:"\u042d\u0442\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430, \u043c\u043e\u0436\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})}function Ge(e){var t=e.ticket,n=e.event,s=e.close,r=(0,S.useState)(null),i=(0,M.Z)(r,2),a=i[0],c=i[1],o=we((null===t||void 0===t?void 0:t.typeId)||-1);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(ie,{open:!!t&&!a,close:s,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("small",{children:"(\u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u043b\u0438\u043a\u0443 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443)"}),(0,I.jsx)(Ve,{ticket:t}),o.data&&!o.data.imageId&&(0,I.jsx)("div",{style:{textAlign:"center"},children:(0,I.jsx)("button",{className:"button",onClick:function(){return c(t)},children:"\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c qr \u043a\u043e\u0434"})})]}),(0,I.jsx)(Ye,{ticket:a,event:n,close:function(){c(null),s()}})]})}function Ke(e){var t,n,s=e.eventId,r=e.open,o=e.close,u=(0,S.useState)(0),l=(0,M.Z)(u,2)[1],d=(0,S.useState)(new Map),h=(0,M.Z)(d,2),v=h[0],f=h[1],x=(0,S.useState)([]),p=(0,M.Z)(x,2),m=p[0],j=p[1],g=_e(s),b=function(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y("/api/events/".concat(e,"/ticket_types"),n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(s,r){r.some((function(e){return"delete"==e.action||"update"==e.action}))&&ue(n,["tickets",e]),n.setQueryData(["ticket_types","".concat(e)],s),s.forEach((function(e){return n.setQueryData(["ticket_type","".concat(e.id)],e)})),null===t||void 0===t||t(s)}});return s}(s,o);return(0,S.useEffect)((function(){f(new Map),j([]),l(0),r||b.reset()}),[r]),(0,I.jsxs)(ie,{open:r,close:o,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0438\u0434\u043e\u0432 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",children:[A(b),g.isLoading&&(0,I.jsx)(W,{}),b.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){(v.size>0||m.length>0)&&b.mutate([].concat((0,K.Z)(m.filter((function(e){return"add"==e.action}))),(0,K.Z)(Array.from(v.values()))))},children:[null===(t=g.data)||void 0===t||null===(n=t.filter((function(e){var t;return"delete"!=(null===(t=v.get(e.id))||void 0===t?void 0:t.action)})))||void 0===n?void 0:n.map((function(e){var t;return(0,I.jsxs)(te,{children:[(0,I.jsx)("input",{type:"text",required:!0,value:(null===(t=v.get(e.id))||void 0===t?void 0:t.name)||e.name,onChange:function(t){v.set(e.id,{id:e.id,name:t.target.value,action:"update"}),l((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){v.set(e.id,{id:e.id,name:"",action:"delete"}),l((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},e.id)})),m.filter((function(e){return"add"==e.action})).map((function(e,t){return(0,I.jsxs)(te,{children:[(0,I.jsx)("input",{type:"text",required:!0,onChange:function(e){m[t].name=e.target.value,l((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){m[t].action="delete",l((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},"new"+t)})),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){m.push({name:"",action:"add"}),l((function(e){return e+1}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Xe(e){var t,n,s=e.eventId,r=e.open,o=e.close,u=(0,S.useRef)(null),l=(0,S.useRef)(null),d=function(e,t){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y("/api/events/"+e,n);case 2:return s=t.sent,t.abrupt("return",ve(s));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(e){n.setQueryData(["event","".concat(e.id)],e),de(n,"events",e),null===t||void 0===t||t()}})}(s,o),h=fe(s);return(0,S.useEffect)((function(){r||d.reset()}),[r]),(0,I.jsxs)(ie,{open:r,close:o,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[A(d),h.isLoading&&(0,I.jsx)(W,{}),d.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n=null===(e=u.current)||void 0===e?void 0:e.value,s=null===(t=l.current)||void 0===t?void 0:t.value;n&&s&&d.mutate({date:s,name:n})},children:[(0,I.jsx)(te,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:u,type:"text",required:!0,defaultValue:null===(t=h.data)||void 0===t?void 0:t.name})}),(0,I.jsx)(te,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:l,type:"datetime-local",required:!0,defaultValue:null===(n=h.data)||void 0===n?void 0:n.date.toISOString().slice(0,-5)})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function $e(e){var t=e.title,n=e.mutationFn,s=e.mutatateParams,r=e.itemId,i=e.onSuccess,a=e.open,c=e.close,o=n(r,(function(e){null===c||void 0===c||c(),null===i||void 0===i||i(e)}));return(0,S.useEffect)((function(){a||o.reset()}),[a]),(0,I.jsxs)(ie,{open:a,close:c,title:t,children:[A(o),o.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){o.mutate(s)},children:[(0,I.jsx)("h1",{children:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function et(){return(0,c.useQuery)("staff",(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/staff");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))))}function tt(e){return(0,c.useQuery)(["staff","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/events/".concat(e,"/staff"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))))}function nt(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p("/api/staff/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){he(n,"events",e),null===t||void 0===t||t()}});return s}function st(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y("/api/staff/".concat(e,"/reset_password"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),onSuccess:function(e){de(n,"staff",e),null===t||void 0===t||t(e)}});return s}function rt(e){var t,n,s,r=e.eventId,o=e.open,u=e.close,l=tt(r),d=et(),h=(0,S.useState)([]),v=(0,M.Z)(h,2),f=v[0],x=v[1],p=(0,S.useState)(-1),m=(0,M.Z)(p,2),j=m[0],g=m[1],b=function(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y("/api/events/".concat(e,"/staff"),n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onSuccess:function(s){n.setQueryData(["staff","".concat(e)],s),null===t||void 0===t||t()}});return s}(r,u);return(0,S.useEffect)((function(){l.isSuccess&&x(l.data.map((function(e){return e.id})))}),[l.isSuccess,l.data]),(0,S.useEffect)((function(){o&&l.isSuccess&&x(l.data.map((function(e){return e.id}))),o&&g(-1),o||b.reset()}),[o,l.isSuccess,l.data]),(0,I.jsxs)(ie,{open:o,close:u,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a\u043b\u0435\u0440\u043a\u043e\u0432",children:[A(l),A(d),A(b),l.isLoading&&(0,I.jsx)(W,{}),d.isLoading&&(0,I.jsx)(W,{}),b.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){b.mutate(f)},children:[f.map((function(e){var t,n=null===(t=d.data)||void 0===t?void 0:t.find((function(t){return t.id==e}));return(0,I.jsxs)(te,{children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:null===n||void 0===n?void 0:n.name}),(0,I.jsxs)("span",{style:{marginLeft:"1em",color:"gray"},children:["(",null===n||void 0===n?void 0:n.login,")"]})]}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){x((function(t){return t.filter((function(t){return t!=e}))}))},children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"})]},e)})),(0,I.jsxs)("select",{onChange:function(e){return g(parseInt(e.target.value))},children:[(0,I.jsx)("option",{value:"-1",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043b\u0435\u0440\u043a\u0430"}),null===(t=d.data)||void 0===t?void 0:t.filter((function(e){return!f.includes(e.id)})).map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),(0,I.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(n=d.data)||void 0===n?void 0:n.filter((function(e){return!f.includes(e.id)})).length),onClick:function(){j>=0&&(x((function(e){return[].concat((0,K.Z)(e),[j])})),g(-1))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"}),(0,I.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(s=d.data)||void 0===s?void 0:s.filter((function(e){return!f.includes(e.id)})).length),onClick:function(){x((function(e){var t;return(null===(t=d.data)||void 0===t?void 0:t.map((function(e){return e.id})))||e}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0441\u0435\u0445"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function it(e){var t=e.code,n=e.setCode,s=e.title,r=(0,S.useState)(""),i=(0,M.Z)(r,2),a=i[0],c=i[1];return(0,S.useEffect)((function(){t&&(c(""),Me.toDataURL(t,{errorCorrectionLevel:"H",scale:10},(function(e,t){return c(t)})))}),[t]),(0,I.jsx)(ie,{open:!!t,close:function(){return n("")},title:s,children:(0,I.jsx)("img",{src:a,alt:t,style:{width:"100%"}})})}function at(){var e,t,n,r=(0,S.useState)(!1),o=(0,M.Z)(r,2),u=o[0],l=o[1],d=(0,S.useState)(!1),v=(0,M.Z)(d,2),f=v[0],x=v[1],p=(0,S.useState)(!1),m=(0,M.Z)(p,2),j=m[0],y=m[1],b=(0,S.useState)(!1),_=(0,M.Z)(b,2),w=_[0],k=_[1],N=(0,S.useState)(-1),C=(0,M.Z)(N,2),L=C[0],F=C[1],E=(0,S.useState)(!1),Q=(0,M.Z)(E,2),R=Q[0],T=Q[1],D=(0,S.useState)(null),z=(0,M.Z)(D,2),U=z[0],P=z[1],q=(0,S.useState)(""),V=(0,M.Z)(q,2),B=V[0],J=V[1],Y=(0,s.s0)(),G=(0,s.UO)().eventId,K=fe(G),$=_e(G),ee=tt(G),te=function(e){return(0,c.useQuery)(["ticket_stats","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("/api/events/".concat(e,"/tickets_stats"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))))}(G),ne=Z("add_ticket"),se=Z("change_ticket_types"),re=Z("change_event"),ie=Z("get_staff_event"),ae=Z("change_staff_event"),oe=Z("delete_event");X((null===(e=K.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,S.useEffect)((function(){K.error instanceof h&&K.error.message.includes("not found")&&Y("/not_found",{replace:!0})}),[K.error,Y]);var ue="/events",le=(te.data||[]).reduce((function(e,t){return e.count+=t.count,e.scanned+=t.scanned,e.authOnPltf+=t.authOnPltf,e}),{count:0,scanned:0,authOnPltf:0});return(0,I.jsxs)(I.Fragment,{children:[K.isLoading&&(0,I.jsx)(H,{backLink:ue,children:(0,I.jsx)(W,{})}),A(K,(function(e){return(0,I.jsx)(H,{backLink:ue,centered:!0,children:e})})),K.data&&(0,I.jsxs)(H,{backLink:ue,centeredPage:!0,gap:"1rem",children:[(0,I.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",K.data.name]}),(0,I.jsxs)("div",{className:ce.card,children:[(0,I.jsxs)("div",{className:ce.card__header,children:[(0,I.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),re&&(0,I.jsx)("button",{className:"button",onClick:function(){return y(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(Xe,{eventId:G,open:j,close:function(){return y(!1)}})]}),(0,I.jsxs)("div",{className:ce.card__body,children:[(0,I.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",K.data.name]}),(0,I.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",je(K.data.date)]})]})]}),(0,I.jsxs)("div",{className:ce.line,children:[(0,I.jsx)(O.rU,{to:"/scanner/".concat(G),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,I.jsx)("button",{className:"button",onClick:function(){return J(new URL("/scanner/".concat(G),window.location.href).href)},children:"Qr \u043a\u043e\u0434 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,I.jsx)(it,{title:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440",code:B,setCode:J})]}),ne&&(0,I.jsx)("button",{className:"button",onClick:function(){return l(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,I.jsx)(Se,{eventId:G,open:u,close:function(){return l(!1)},setTicet:P}),(0,I.jsx)(Ge,{ticket:U,event:K.data,close:function(){return P(null)}}),(0,I.jsx)(O.rU,{to:"/events/".concat(G,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,I.jsxs)("div",{className:ce.card,children:[(0,I.jsxs)("div",{className:ce.card__header,children:[(0,I.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),se&&(0,I.jsx)("button",{className:"button",onClick:function(){return k(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(Ke,{eventId:G,open:w,close:function(){return k(!1)}}),(0,I.jsx)(qe,{typeId:L,eventId:parseInt(G),open:L>=0,close:function(){return F(-1)}})]}),(0,I.jsxs)("div",{className:ce.card__body,children:[$.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A($,(function(e){return(0,I.jsx)("div",{children:e})})),(0,I.jsxs)("div",{className:ce.ticketTypes,children:[null===(t=$.data)||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)(S.Fragment,{children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("button",{className:"button button_small icon",style:{marginRight:"0.5em",color:e.pattern?"green":""},onClick:function(){return F(e.id)},children:"edit_square"}),(0,I.jsx)("span",{children:e.name})]}),function(t){if(!te.data)return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{})]});var n=null===(t=te.data)||void 0===t?void 0:t.find((function(t){return t.typeId==e.id})),s=(null===n||void 0===n?void 0:n.count)||0;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{className:"icon",children:"group"}),(0,I.jsx)("span",{children:s}),(0,I.jsxs)("span",{children:[" (",ct(s||0,le.count),"%)"]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{className:"icon",children:"login"}),(0,I.jsx)("span",{children:(null===n||void 0===n?void 0:n.scanned)||0}),(0,I.jsxs)("span",{children:[" (",ct((null===n||void 0===n?void 0:n.scanned)||0,s),"%)"]})]}),(0,I.jsx)("div",{children:le.authOnPltf>0&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{className:"icon",children:"stadia_controller"}),(0,I.jsx)("span",{children:(null===n||void 0===n?void 0:n.authOnPltf)||0}),(0,I.jsxs)("span",{children:[" (",ct((null===n||void 0===n?void 0:n.authOnPltf)||0,s),"%)"]})]})})]})}()]},e.id)})),te.data&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{fontWeight:"bold"},children:(0,I.jsx)("span",{children:"\u0412\u0441\u0435\u0433\u043e"})}),(0,I.jsxs)("div",{style:{fontWeight:"bold"},children:[(0,I.jsx)("span",{className:"icon",children:"group"}),(0,I.jsx)("span",{children:le.count})]}),(0,I.jsxs)("div",{style:{fontWeight:"bold"},children:[(0,I.jsx)("span",{className:"icon",children:"login"}),(0,I.jsx)("span",{children:le.scanned}),(0,I.jsxs)("span",{children:[" (",ct(le.scanned,le.count),"%)"]})]}),(0,I.jsx)("div",{style:{fontWeight:"bold"},children:le.authOnPltf>0&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{className:"icon",children:"stadia_controller"}),(0,I.jsx)("span",{children:le.authOnPltf}),(0,I.jsxs)("span",{children:[" (",ct(le.authOnPltf,le.count),"%)"]})]})})]})]}),te.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A(te,(function(e){return(0,I.jsx)("div",{children:e})}))]})]}),ie&&(0,I.jsxs)("div",{className:ce.card,children:[(0,I.jsxs)("div",{className:ce.card__header,children:[(0,I.jsx)("h2",{children:"\u041a\u043b\u0435\u0440\u043a\u0438"}),ae&&(0,I.jsx)("button",{className:"button",onClick:function(){return T(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(rt,{eventId:G,open:R,close:function(){return T(!1)}})]}),(0,I.jsxs)("div",{className:ce.card__body,children:[ee.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A(ee,(function(e){return(0,I.jsx)("div",{children:e})})),null===(n=ee.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("div",{children:e.name},e.id)}))]})]}),(0,I.jsx)("div",{className:ce.gap}),(0,I.jsx)("div",{className:ce.right,children:oe&&(0,I.jsx)("button",{className:"button",onClick:function(){return x(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,I.jsx)($e,{title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",onSuccess:function(){return Y("/events")},mutationFn:xe,itemId:G,open:f,close:function(){return x(!1)}})]})]})}function ct(e,t){return 0==t?0:Math.floor(e/t*100)}var ot={event:"styles_event__AM1vG",title:"styles_title__Vipq0",activeMark:"styles_activeMark__zBB4P",toggle:"styles_toggle__1O26V",toggleInp:"styles_toggleInp__s3up7",eventInfo:"styles_eventInfo__GuWN-",access:"styles_access__1bK7b"};function ut(){var e;X("\u0421\u043e\u0431\u044b\u0442\u0438\u044f");var t=w(),n=(0,c.useQuery)("events_full",(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/events_full");case 2:return t=e.sent,e.abrupt("return",t.map(ve));case 4:case"end":return e.stop()}}),e)})))),s=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("/api/events/".concat(t,"/add_access"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(){ue(e,"events"),ue(e,"events_full")}})}();return(0,I.jsxs)(H,{centeredPage:!0,gap:8,children:[n.isLoading&&(0,I.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),!n.isLoading&&n.isFetching&&(0,I.jsx)("h3",{children:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435"}),s.isLoading&&(0,I.jsx)(W,{}),A(n),A(s),null===(e=n.data)||void 0===e?void 0:e.map((function(e){return(0,I.jsxs)("div",{className:ot.event,children:[(0,I.jsx)("input",{type:"checkbox",className:ot.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:ot.title,htmlFor:"user".concat(e.id),children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{style:{color:"blue"},children:e.id}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:je(e.date)}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:e.name})]}),(0,I.jsxs)("div",{children:[e.deleted&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,I.jsx)("div",{children:"|"})]}),(0,I.jsx)("div",{className:ot.activeMark,style:{backgroundColor:e.active?"green":"tomato"},title:"active"}),(0,I.jsx)("div",{className:ot.toggle})]})]}),(0,I.jsxs)("div",{className:ot.eventInfo,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Access"}),(0,I.jsx)("div",{className:ot.access,children:e.access.map((function(e,t){return(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:e.login}),(0,I.jsx)("div",{style:{color:"blue"},children:e.id}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:e.name})]},t)}))})]}),!e.access.some((function(e){var n;return e.id==(null===(n=t.data)||void 0===n?void 0:n.id)}))&&(0,I.jsx)("button",{className:"button button_light button_small",style:{alignSelf:"end"},onClick:function(){return s.mutate(e.id)},children:"Get access"})]})]},e.id)}))]})}function lt(e){var t=e.open,n=e.close,s=(0,S.useRef)(null),r=(0,S.useRef)(null),o=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/events",t);case 2:return n=e.sent,e.abrupt("return",ve(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){t.setQueryData(["event","".concat(n.id)],n),le(t,"events",n),null===e||void 0===e||e()}})}(n);return(0,S.useEffect)((function(){!t&&s.current&&r.current&&(s.current.value="",r.current.value="")}),[t,s,r]),(0,S.useEffect)((function(){t||o.reset()}),[t]),(0,I.jsxs)(ie,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[A(o),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n=null===(e=s.current)||void 0===e?void 0:e.value,i=null===(t=r.current)||void 0===t?void 0:t.value;n&&i&&o.mutate({date:i,name:n})},children:[(0,I.jsx)(te,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:s,type:"text",required:!0})}),(0,I.jsx)(te,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:r,type:"datetime-local",required:!0})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),o.isLoading&&(0,I.jsx)(W,{})]})}function dt(){var e,t;X("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var n=(0,S.useState)(!1),s=(0,M.Z)(n,2),r=s[0],o=s[1],u=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/events");case 2:return t=e.sent,e.abrupt("return",t.map(ve));case 4:case"end":return e.stop()}}),e)}))),{onSuccess:function(t){return t.forEach((function(t){return e.setQueryData(["event","".concat(t.id)],t)}))}})}();return(0,I.jsxs)(H,{backLink:"/",centeredPage:!0,gap:"1rem",children:[(0,I.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),u.isLoading&&(0,I.jsx)(W,{}),A(u),null===(e=u.data)||void 0===e||null===(t=e.sort((function(e,t){return e.date<t.date?1:-1})))||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)(O.rU,{to:"/events/".concat(e.id),className:"button button_large space_between",children:[(0,I.jsx)("span",{children:e.name}),(0,I.jsx)("span",{children:je(e.date)})]},e.id)})),Z("add_event")&&(0,I.jsxs)("div",{className:"space_between",children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return o(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(lt,{open:r,close:function(){return o(!1)}})]})}function ht(e){var t=e.open,n=e.close,s=(0,S.useRef)(null),r=(0,S.useRef)(null),o=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).set("name",t.name),n.set("type",t.type),n.set("font",t.file),e.next=6,b("/api/fonts",n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){le(t,"fonts",n),null===e||void 0===e||e()}});return n}(n);return(0,S.useEffect)((function(){!t&&s.current&&r.current&&(s.current.value="",r.current.value="")}),[t,s,r]),(0,S.useEffect)((function(){t||o.reset()}),[t]),(0,I.jsxs)(ie,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0448\u0440\u0438\u0444\u0442\u0430",children:[A(o,void 0,(function(e){return e.includes("already exist")?"\u0428\u0440\u0438\u0444\u0442 \u0441 \u0442\u0430\u043a\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442":e})),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n,i=null===(e=s.current)||void 0===e?void 0:e.value,a=null===(t=r.current)||void 0===t||null===(n=t.files)||void 0===n?void 0:n[0];i&&a&&o.mutate({file:a,name:i,type:a.name.split(".").at(-1)||""})},children:[(0,I.jsx)(te,{label:"\u0424\u0430\u0439\u043b",children:(0,I.jsx)("input",{ref:r,type:"file",accept:".ttf,.otf,.woff,.woff2",required:!0,onChange:function(){var e,t,n=s.current,i=r.current;if(n&&i){var a=((null===(e=i.files)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.name)||"").split("."),c=1==a.length?a:a.slice(0,-1);n.value=c.join(".")}}})}),(0,I.jsx)(te,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:s,type:"text",required:!0})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),o.isLoading&&(0,I.jsx)(W,{})]})}function vt(){var e;X("\u0428\u0440\u0438\u0444\u0442\u044b");var t=(0,S.useState)(!1),n=(0,M.Z)(t,2),s=n[0],r=n[1],i=(0,S.useState)("\u041c\u044b\u0448\u0438 \u0431\u0443\u043b\u043e\u0447\u043a\u0438 \u0436\u0435\u0432\u0430\u043b\u0438!"),a=(0,M.Z)(i,2),c=a[0],o=a[1],u=Pe();return(0,I.jsxs)(H,{centeredPage:!0,gap:12,children:[(0,I.jsx)("h1",{children:"\u0428\u0440\u0438\u0444\u0442\u044b"}),u.isLoading&&(0,I.jsx)(W,{}),A(u),(0,I.jsx)("input",{type:"text",value:c,onInput:function(e){return o(e.target.value)}}),null===(e=u.data)||void 0===e?void 0:e.map((function(e){return(0,I.jsx)(ft,{font:e,text:c},e.id)})),Z("add_font")&&(0,I.jsxs)("div",{className:"space_between",children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return r(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(ht,{open:s,close:function(){return r(!1)}})]})}function ft(e){var t=e.font,n=e.text,s=function(e){var t="".concat(e.id,"_").concat(e.name);return(0,S.useEffect)((function(){var n=Fe(t,e.id,e.type);return document.fonts.add(n),function(){document.fonts.delete(n)}}),[]),'"'.concat(t,'"')}(t);return(0,I.jsxs)("div",{className:"space_between",style:{fontFamily:s,fontSize:"1.2rem",gap:"0 1rem",flexWrap:"wrap"},children:[(0,I.jsx)("span",{children:t.name}),(0,I.jsx)("span",{children:n})]})}function xt(e){var t=e;return t.date=new Date(e.date),t}var pt={btns:"styles_btns__aRipu",table:"styles_table__QLr-h",changesCell:"styles_changesCell__0wQDJ",changes:"styles_changes__EyS9f"};function mt(){var e,t,n;X("Log");var s=function(){var e=(0,c.useQueryClient)();return function(){e.removeQueries("log"),e.invalidateQueries("logLen")}}(),r=(0,S.useState)(0),o=(0,M.Z)(r,2),u=o[0],l=o[1],d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(0,c.useQueryClient)(),n=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/debug/log?p=".concat(t));case 2:return e.abrupt("return",e.sent.map(xt));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return t.prefetchQuery(["log",e-1],(function(){return n(e-1)})),t.prefetchQuery(["log",e+1],(function(){return n(e+1)})),(0,c.useQuery)(["log",e],(function(){return n(e)}))}(u),h=null!==(e=null===(t=(0,c.useQuery)("logLen",(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/debug/log_len");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).data)||void 0===t?void 0:t.len)&&void 0!==e?e:0;return(0,I.jsxs)(H,{centeredPage:!0,children:[A(d),(0,I.jsxs)("div",{className:pt.btns,children:[(0,I.jsx)("button",{disabled:d.isFetching,className:"button button_small",onClick:function(){s(),l(0),d.refetch()},children:"Update"}),(0,I.jsx)("button",{disabled:d.isFetching,className:"button button_small",onClick:function(){return l(0)},children:"<<"}),(0,I.jsx)("button",{disabled:d.isFetching,className:"button button_small",onClick:function(){return l((function(e){return Math.max(e-1,0)}))},children:"<"}),(0,I.jsxs)("span",{children:[u+1,"/",h]}),(0,I.jsx)("button",{disabled:d.isFetching,className:"button button_small",onClick:function(){return l((function(e){return Math.min(e+1,h-1)}))},children:">"}),(0,I.jsx)("button",{disabled:d.isFetching,className:"button button_small",onClick:function(){return l(h-1)},children:">>"})]}),d.isFetching&&(0,I.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),(0,I.jsxs)("table",{className:pt.table,children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{minWidth:"9.5em"},children:"Date"}),(0,I.jsx)("th",{style:{minWidth:"4em"},children:"Action"}),(0,I.jsx)("th",{style:{minWidth:"9.5em"},children:"Table[id]"}),(0,I.jsx)("th",{children:"User[id]"}),(0,I.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,I.jsx)("tbody",{children:null===(n=d.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:ye(e.date,!0,!0)}),(0,I.jsx)("td",{children:jt(e.actionCode)}),(0,I.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,I.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,I.jsx)("td",{className:pt.changesCell,children:(0,I.jsxs)("div",{className:pt.changes,children:[(0,I.jsx)("input",{type:"checkbox",className:pt.toggleInp,id:"item".concat(e.id)}),(0,I.jsx)("div",{children:e.changes.map((function(e){return(0,I.jsxs)("div",{children:[e[0],": ",JSON.stringify(e[1])," ","->"," ",JSON.stringify(e[2])]},e[0])}))}),e.changes.length>0&&(0,I.jsx)("label",{className:"button button_small",htmlFor:"item".concat(e.id),children:e.changes.length})]})})]},e.id)}))})]})]})}function jt(e){return(0,I.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}var gt={user:"styles_user__vi6jw",login:"styles_login__rRIkN",userTag:"styles_userTag__0uCj4"};function yt(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p("/api/managers/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),onSuccess:function(){he(n,"managers",e),null===t||void 0===t||t()}});return s}function bt(e){var t=e.open,n=e.close,s=(0,S.useState)(null),r=(0,M.Z)(s,2),o=r[0],u=r[1],l=(0,S.useRef)(null),d=(0,S.useRef)(null),h=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/managers",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){le(t,"managers",n),null===e||void 0===e||e(n)}});return n}((function(e){u(e),null===n||void 0===n||n()}));return(0,S.useEffect)((function(){!t&&l.current&&d.current&&(h.reset(),l.current.value="",d.current.value="")}),[t,l,d]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(ie,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u0430",children:[A(h),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n=null===(e=l.current)||void 0===e?void 0:e.value,s=null===(t=d.current)||void 0===t?void 0:t.value;n&&s&&h.mutate({name:n,login:s})},children:[(0,I.jsx)(te,{label:"\u0418\u043c\u044f",children:(0,I.jsx)("input",{ref:l,type:"text",required:!0})}),(0,I.jsx)(te,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:d,placeholder:"\u0410\u043d\u0433\u043b. \u0431\u0443\u043a\u0432\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 _",type:"text",required:!0,onInput:function(e){d.current&&(d.current.value=d.current.value.replaceAll(/[^a-z_\d]/g,""))}})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),h.isLoading&&(0,I.jsx)(W,{})]}),(0,I.jsxs)(ie,{open:!!o,close:function(){return u(null)},title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u0430",children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",null===o||void 0===o?void 0:o.login]}),(0,I.jsxs)("div",{children:["\u041f\u0430\u0440\u043e\u043b\u044c: ",null===o||void 0===o?void 0:o.password]}),(0,I.jsx)("h4",{style:{marginTop:8},children:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e"})]})]})}function _t(){var e,t;X("\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u044b");var n=(0,S.useState)(!1),s=(0,M.Z)(n,2),r=s[0],o=s[1],u=(0,S.useState)(-1),l=(0,M.Z)(u,2),d=l[0],h=l[1],v=w(),f=(0,c.useQuery)("managers",(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/managers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));return(0,I.jsxs)(H,{centeredPage:!0,gap:8,children:[(0,I.jsx)("h1",{children:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u044b"}),f.isLoading&&(0,I.jsx)(W,{}),A(f),0==(null===(e=f.data)||void 0===e?void 0:e.length)&&(0,I.jsx)("h2",{children:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u044b \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442"}),null===(t=f.data)||void 0===t?void 0:t.map((function(e){var t,n;return(0,I.jsxs)("div",{className:gt.user+" space_between",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.name}),(0,I.jsx)("span",{className:gt.login,children:e.login})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.roles.join(", ")}),e.id!=(null===(t=v.data)||void 0===t?void 0:t.id)&&(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return h(e.id)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"}),e.id==(null===(n=v.data)||void 0===n?void 0:n.id)&&(0,I.jsx)("span",{className:gt.userTag,children:"\u0412\u044b"})]})]},e.id)})),Z("add_manager")&&(0,I.jsxs)("div",{className:"space_between",children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return o(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(bt,{open:r,close:function(){return o(!1)}}),(0,I.jsx)($e,{itemId:d,title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0442\u043e\u0440\u0430",mutationFn:yt,open:d>=0,close:function(){return h(-1)}})]})}var wt={root:"styles_root__QCWgG",table:"styles_table__Klrj7",center:"styles_center__pcMYz",mark:"styles_mark__4aU1o"};function kt(e,t){return"".concat(pe(e,3),"-").concat(t.getFullYear().toString().at(-1)).concat(pe(t.getMonth()+1,2)).concat(pe(t.getDate(),2),"-")}function Zt(){var e,t=(0,s.UO)().eventId,n=fe(t),i=Ze(t);X([null===(e=n.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]);var a=(0,S.useMemo)((function(){if(!i.data||!n.data)return[!1,""];var e=kt(n.data.id,n.data.date);return[i.data.every((function(t){return t.code.startsWith(e)})),e]}),[i.data,n.data]),c=(0,M.Z)(a,2),o=c[0],u=c[1];return(0,S.useEffect)((function(){if(n.isSuccess&&i.isSuccess){var e=setTimeout((function(){return window.print()}),1e3);return function(){return clearTimeout(e)}}}),[n.isSuccess,i.isSuccess]),(0,I.jsxs)(I.Fragment,{children:[(n.isLoading||i.isLoading)&&(0,I.jsx)(W,{}),A(n),A(i),n.isSuccess&&i.isSuccess&&(0,I.jsx)("div",{className:wt.root,children:(0,I.jsxs)("table",{className:wt.table,children:[(0,I.jsxs)("thead",{children:[(0,I.jsx)("tr",{children:(0,I.jsxs)("th",{colSpan:5,children:[(0,I.jsx)("span",{children:n.data.name}),o&&(0,I.jsx)("span",{style:{marginLeft:"1rem"},children:"|"}),o&&(0,I.jsxs)("span",{style:{marginLeft:"1rem"},children:["\u0412\u0441\u0435 \u043a\u043e\u0434\u044b \u0434\u043e\u0436\u043d\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 ",u]})]})}),(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:o?"5.4em":"10.4em"},children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsxs)("th",{style:{width:"4em"},children:[(0,I.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,I.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]})]})]}),(0,I.jsx)("tbody",{children:i.data.map((function(e){return o?(0,r.Z)((0,r.Z)({},e),{},{code:e.code.slice(u.length),sortV:e.code.slice(e.code.lastIndexOf("-"))}):(0,r.Z)((0,r.Z)({},e),{},{sortV:e.code})})).sort((function(e,t){return e.sortV>t.sortV?1:-1})).map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personName}),(0,I.jsx)("td",{children:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?e.type.slice(8):e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:wt.center,children:(0,I.jsx)("span",{className:wt.mark,children:e.scanned&&"\u2713"})})]},e.id)}))})]})})]})}var Nt={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z"};function St(e){var t=e.open,n=e.close,s=(0,S.useState)(""),r=(0,M.Z)(s,2),o=r[0],u=r[1],l=(0,S.useRef)(null),d=(0,S.useRef)(null),h=function(e){var t=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("/api/user/change_password",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:e});return t}(n);return(0,S.useEffect)((function(){!t&&l.current&&d.current&&(h.reset(),u(""),l.current.value="",d.current.value="")}),[t,l,d]),(0,I.jsxs)(ie,{open:t,close:n,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f",children:[A(h),h.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n=null===(e=l.current)||void 0===e?void 0:e.value,s=null===(t=d.current)||void 0===t?void 0:t.value;return!n||n.length<=4?u("\u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n!=s?u("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):void h.mutate({password:n})},children:[(0,I.jsx)(te,{label:"\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:l,type:"password",required:!0})}),(0,I.jsx)(te,{label:"\u0415\u0449\u0451 \u0440\u0430\u0437",children:(0,I.jsx)("input",{ref:d,type:"password",required:!0})}),""!=o&&(0,I.jsx)("h4",{style:{color:"tomato"},children:o}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Ct(){var e,t,n,s=w(),o=(0,S.useRef)(null),u=(0,S.useState)(!1),l=(0,M.Z)(u,2),d=l[0],h=l[1],v=(0,S.useState)(!1),f=(0,M.Z)(v,2),p=f[0],m=f[1],j=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("/api/user/change_name",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n,s){var i;"success"==(null===(i=t.getQueryState("user"))||void 0===i?void 0:i.status)&&t.setQueryData("user",(function(e){return(0,r.Z)((0,r.Z)({},e),{},{name:s.name})})),null===e||void 0===e||e()}});return n}();return(0,I.jsxs)(H,{centered:!0,gap:"1rem",children:[(0,I.jsxs)("div",{className:Nt.root,children:[A(j),j.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,I.jsx)("div",{children:(0,I.jsx)("input",{type:"text",ref:o,defaultValue:null===(e=s.data)||void 0===e?void 0:e.name,disabled:!d,className:Nt.input})}),(0,I.jsxs)("div",{children:[!d&&(0,I.jsx)("button",{onClick:function(){return h(!0)},className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),d&&(0,I.jsx)("button",{onClick:function(){var e;h(!1),o.current&&(o.current.value=(null===(e=s.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),d&&(0,I.jsx)("button",{onClick:function(){h(!1),o.current&&j.mutate({name:o.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u041b\u043e\u0433\u0438\u043d"}),null===(t=s.data)||void 0===t?void 0:t.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0420\u043e\u043b\u0438"}),null===(n=s.data)||void 0===n?void 0:n.roles.map((function(e,t){return(0,I.jsx)("div",{children:e},t)}))]}),(0,I.jsx)("div",{children:(0,I.jsx)("button",{className:"button",onClick:function(){return m(!0)},children:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})})]}),(0,I.jsx)(St,{open:p,close:function(){return m(!1)}})]})}var It={scanner:"styles_scanner__+xzXT",scannerRect:"styles_scannerRect__zwl3N",scannerVideo:"styles_scannerVideo__ZCceC",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO",alreadyScanned:"styles_alreadyScanned__OI-PM",alreadyScanned_visible:"styles_alreadyScanned_visible__keU3C"},At={root:"styles_root__QdJnV"},Lt=n(1096);function Mt(e){var t=e.active,n=void 0===t||t,s=e.className,r=e.onScan,i=e.onCameraError,a=(0,S.useState)(),c=(0,M.Z)(a,2),o=c[0],u=c[1],l=(0,S.useRef)(null);return(0,S.useEffect)((function(){if(l.current){var e=new Lt.Z(l.current,(function(e){return r(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return u((function(t){return null===t||void 0===t||t.stop(),null===t||void 0===t||t.destroy(),e})),e.start().catch((function(){return i()})),function(){e.stop(),e.destroy()}}}),[l,r]),(0,S.useEffect)((function(){o&&(n?o.start().catch((function(){return i()})):o.pause(!1))}),[n,o]),(0,I.jsx)("video",{className:F(At.root,s),ref:l})}var Ft={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function Et(e){var t=e.event,n=e.onInputBtn;return(0,I.jsxs)("div",{className:Ft.root,children:[(0,I.jsx)("div",{className:Ft.top,children:(0,I.jsx)("button",{onClick:n,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,I.jsxs)("div",{className:Ft.bottom,children:[(0,I.jsx)("span",{children:t.name}),(0,I.jsx)("span",{children:"|"}),(0,I.jsx)("span",{children:je(t.date)})]})]})}function Qt(e){var t=(0,S.useState)((function(){var t=new Audio(e);return t.preload="auto",t})),n=(0,M.Z)(t,1)[0];return[function(){n.currentTime=0,n.play()}]}var Rt=n.p+"static/media/beep.38f199e084efe5461ffd.mp3",Tt=n.p+"static/media/beepError.7eccfa35a3dd6b6ea311.mp3";function Dt(){X("\u0421\u043a\u0430\u043d\u0435\u0440");var e,t,n=(0,s.UO)(),r=(0,S.useState)(null),o=(0,M.Z)(r,2),u=o[0],l=o[1],d=(0,S.useState)(null),v=(0,M.Z)(d,2),f=v[0],x=v[1],p=(0,S.useState)(null),m=(0,M.Z)(p,2),j=m[0],g=m[1],b=(0,S.useState)(null),_=(0,M.Z)(b,2),w=_[0],k=_[1],Z=(0,S.useState)(!0),N=(0,M.Z)(Z,2),C=N[0],A=N[1],L=(0,S.useState)(!1),E=(0,M.Z)(L,2),Q=E[0],R=E[1],T=(0,S.useState)(!1),D=(0,M.Z)(T,2),z=D[0],O=D[1],U=(0,S.useState)(!1),P=(0,M.Z)(U,2),q=P[0],V=P[1],B=(0,S.useRef)(null),J=(e=n.eventId,(0,c.useQuery)(["event","".concat(e)],(0,a.Z)((0,i.Z)().mark((function t(){var n,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/scanner_events/"+e);case 2:return n=t.sent,t.next=5,n.json();case 5:if(s=t.sent,n.ok){t.next=14;break}if(403!=n.status){t.next=9;break}return t.abrupt("return",NaN);case 9:return t.t0=h,t.next=12,n.json();case 12:throw t.t1=t.sent.msg,new t.t0(t.t1);case 14:return t.abrupt("return",ve(s));case 15:case"end":return t.stop()}}),t)}))),{retry:3})),Y=Qt(Rt),G=(0,M.Z)(Y,1)[0],K=Qt(Tt),$=(0,M.Z)(K,1)[0],ee=(0,S.useCallback)((function(e){return l(e)}),[]),te=(0,S.useCallback)((function(){R(!0),B.current&&J.data&&"number"!=typeof J.data&&(setTimeout((function(){B.current&&B.current.focus()}),50),B.current.value=kt(J.data.id,J.data.date))}),[B,J.data]),ne=(0,S.useCallback)((function(){return R(!1)}),[]),se=function(e,t){var n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/check_ticket",t);case 2:return n=e.sent,s=n,n.ticket&&(s.ticket=ke(n.ticket)),n.event&&(s.event=ve(n.event)),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:e,onError:function(e){null===t||void 0===t||t(e instanceof h?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),n.reset()}});return n}((function(e){k(e),e.success||$()}),(function(e){k(null),g(e)}));return(0,S.useEffect)((function(){if(u&&J.data&&"idle"==se.status&&"number"!=typeof J.data){if(G(),f==u&&!j)return l(null),void O(!0);l(null),O(!1),x(u),g(null),k(null),se.mutate({code:u,eventId:J.data.id})}}),[u,J.data,se.status]),(0,S.useEffect)((function(){if(se.isSuccess){var e=setTimeout((function(){l(null),se.reset()}),1e3);return function(){return clearTimeout(e)}}}),[se.isSuccess]),(0,S.useEffect)((function(){if(z){var e=setTimeout((function(){return O(!1)}),500);return function(){return clearTimeout(e)}}}),[z]),(0,I.jsxs)(I.Fragment,{children:[J.isLoading&&(0,I.jsx)(W,{}),J.error&&(0,I.jsx)(H,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof J.data&&(0,I.jsxs)(H,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,I.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof J.data&&J.data&&(0,I.jsxs)(H,{height100:!0,header:(0,I.jsx)(Et,{event:J.data,onInputBtn:te}),children:[(0,I.jsx)("div",{className:F(It.scanner,!se.isIdle&&It.scanner_scanned),children:(0,I.jsx)("div",{className:It.scannerRect,children:(0,I.jsx)(Mt,{onScan:ee,onCameraError:function(){return V(!0)},className:It.scannerVideo})})}),(0,I.jsxs)("div",{className:It.scanResult,children:[(0,I.jsx)("div",{className:F(It.alreadyScanned,z&&It.alreadyScanned_visible),children:"\u0422\u043e\u0442 \u0436\u0435 \u0431\u0438\u043b\u0435\u0442"}),f&&(0,I.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",f]}),j&&(0,I.jsx)("div",{children:j}),(null===w||void 0===w?void 0:w.success)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:F(It.success,It.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,I.jsxs)("div",{className:It.result_desc,children:[(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",w.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",w.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",w.ticket.promocode]})]})]}),"notExist"==(null===w||void 0===w?void 0:w.errorCode)&&(0,I.jsx)("div",{className:F(It.error,It.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===w||void 0===w?void 0:w.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:F(It.error,It.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,I.jsxs)("div",{className:It.result_desc,children:[(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",w.event.name]}),(0,I.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",je(w.event.date)," (",be(w.event.date,"day"),")"]})]}),(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",w.ticket.personName]})]})]}),"scanned"==(null===w||void 0===w?void 0:w.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:F(It.error,It.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,I.jsxs)("div",{className:It.result_desc,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,I.jsxs)("span",{children:[ge(w.ticket.scannedDate,!0)," "]}),(0,I.jsxs)("span",{className:F((t=w.ticket.scannedDate,((new Date).getTime()-t.getTime())/1e3>30&&It.error)),children:["(",be(w.ticket.scannedDate),")"]})]}),(0,I.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",w.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",w.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",w.ticket.promocode]})]})]})]}),(0,I.jsxs)(ie,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:Q,close:ne,children:[(0,I.jsx)("input",{type:"text",ref:B}),(0,I.jsx)("button",{disabled:"idle"!=se.status,onClick:function(){var e;B.current&&l(null===(e=B.current)||void 0===e?void 0:e.value),ne()},children:"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c"})]}),(0,I.jsxs)(ie,{open:q,children:[(0,I.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,I.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,I.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]}),(0,I.jsxs)(ie,{title:"\u0421\u043a\u0430\u043d\u0435\u0440 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",open:C,close:function(){return A(!1)},children:[(0,I.jsx)("h2",{children:J.data.name}),(0,I.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u0430 \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443 \u043d\u0430 QR \u043a\u043e\u0434 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u043b\u0441\u044f \u0432 \u043c\u0438\u0433\u0430\u044e\u0449\u0443\u044e \u0440\u0430\u043c\u043a\u0443."}),(0,I.jsxs)("p",{children:[(0,I.jsx)("strong",{children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0437\u0432\u0443\u043a"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u043b\u044b\u0448\u0430\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u043b \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438."]})]})]})]})}var zt={user:"styles_user__JQBf0",title:"styles_title__OlEMb",toggle:"styles_toggle__wBqj6",toggleInp:"styles_toggleInp__Tox8V",userInfo:"styles_userInfo__Pveb6"};function Ot(e){var t=e.open,n=e.close,s=(0,S.useState)(null),r=(0,M.Z)(s,2),o=r[0],u=r[1],l=(0,S.useRef)(null),d=(0,S.useRef)(null),h=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/staff",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){le(t,"staff",n),null===e||void 0===e||e(n)}});return n}((function(e){u(e),null===n||void 0===n||n()}));return(0,S.useEffect)((function(){!t&&l.current&&d.current&&(h.reset(),l.current.value="",d.current.value="")}),[t,l,d]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(ie,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[A(h),(0,I.jsxs)(ee,{onSubmit:function(){var e,t,n=null===(e=l.current)||void 0===e?void 0:e.value,s=null===(t=d.current)||void 0===t?void 0:t.value;n&&s&&h.mutate({name:n,login:s})},children:[(0,I.jsx)(te,{label:"\u0418\u043c\u044f",children:(0,I.jsx)("input",{ref:l,type:"text",required:!0})}),(0,I.jsx)(te,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:d,placeholder:"\u0410\u043d\u0433\u043b. \u0431\u0443\u043a\u0432\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 _",type:"text",required:!0,onInput:function(e){d.current&&(d.current.value=d.current.value.replaceAll(/[^a-z_\d]/g,""))}})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),h.isLoading&&(0,I.jsx)(W,{})]}),(0,I.jsxs)(ie,{open:!!o,close:function(){return u(null)},title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",null===o||void 0===o?void 0:o.login]}),(0,I.jsxs)("div",{children:["\u041f\u0430\u0440\u043e\u043b\u044c: ",null===o||void 0===o?void 0:o.password]}),(0,I.jsx)("h4",{style:{marginTop:8},children:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e"})]})]})}function Ut(){var e,t;X("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438");var n=(0,S.useState)(!1),s=(0,M.Z)(n,2),r=s[0],i=s[1],a=(0,S.useState)(-1),c=(0,M.Z)(a,2),o=c[0],u=c[1],l=(0,S.useState)(-1),d=(0,M.Z)(l,2),h=d[0],v=d[1],f=et();return(0,I.jsxs)(H,{centeredPage:!0,gap:8,children:[(0,I.jsx)("h1",{children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),f.isLoading&&(0,I.jsx)(W,{}),A(f),0==(null===(e=f.data)||void 0===e?void 0:e.length)&&(0,I.jsx)("h2",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"}),null===(t=f.data)||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)("div",{className:zt.user,children:[(0,I.jsx)("input",{type:"checkbox",className:zt.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:zt.title,htmlFor:"user".concat(e.id),children:[(0,I.jsx)("div",{children:e.name}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.roles.join(", ")}),(0,I.jsx)("div",{className:zt.toggle})]})]}),(0,I.jsxs)("div",{className:zt.userInfo,children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",e.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041f\u0430\u0440\u043e\u043b\u044c: "}),e.password||(0,I.jsx)("button",{className:"button button_light button_small",onClick:function(){return v(e.id)},children:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})]}),(0,I.jsxs)("div",{className:"space_between",children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return u(e.id)},children:"\u0423\u0432\u043e\u043b\u0438\u0442\u044c"})]})]})]},e.id)})),Z("add_staff")&&(0,I.jsxs)("div",{className:"space_between",children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(Ot,{open:r,close:function(){return i(!1)}}),(0,I.jsx)($e,{itemId:o,title:"\u0423\u0432\u043e\u043b\u044c\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:nt,open:o>=0,close:function(){return u(-1)}}),(0,I.jsx)($e,{itemId:h,title:"\u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:st,open:h>=0,close:function(){return v(-1)}})]})}var Pt={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX",table:"styles_table__46OhS"};function qt(e){var t,n,s,r=e.ticket,o=e.eventId,u=e.close,l=e.setTicket,d=(0,S.useState)(!1),h=(0,M.Z)(d,2),v=h[0],f=h[1],x=(0,S.useState)(-1),p=(0,M.Z)(x,2),m=p[0],j=p[1],g=(0,S.useState)(""),b=(0,M.Z)(g,2),_=b[0],w=b[1],k=(0,S.useState)(""),N=(0,M.Z)(k,2),C=N[0],L=N[1],F=(0,S.useState)(""),E=(0,M.Z)(F,2),Q=E[0],R=E[1],T=function(e){var t=(0,c.useQueryClient)(),n=(0,c.useMutation)({mutationFn:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y("/api/tickets/"+t.ticketId,t.data);case 2:return n=e.sent,e.abrupt("return",ke(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onSuccess:function(n){de(t,["tickets",n.eventId],n),null===e||void 0===e||e(n)}});return n}((function(e){l(e),u()})),D=_e(o),z=Z("delete_ticket"),O=!!r;return(0,S.useEffect)((function(){var e,t;O?(j((null===(e=D.data)||void 0===e||null===(t=e.find((function(e){return e.name==r.type})))||void 0===t?void 0:t.id)||-1),w(r.personName||""),L(r.personLink||""),R(r.promocode||"")):T.reset()}),[O,r,D.data]),(0,I.jsxs)(ie,{open:O,close:u,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[D.isLoading&&(0,I.jsx)(W,{}),A(T),T.isLoading&&(0,I.jsx)(W,{}),(0,I.jsxs)(ee,{onSubmit:function(){r&&m>=0&&_&&T.mutate({ticketId:r.id,data:{typeId:m,personName:_,personLink:C,promocode:Q}})},children:[(0,I.jsxs)(te,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("select",{value:m,onChange:function(e){var t,n;return j((null===(t=D.data)||void 0===t||null===(n=t[e.target.selectedIndex])||void 0===n?void 0:n.id)||-1)},disabled:0==(null===(t=D.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=D.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(s=D.data)||void 0===s?void 0:s.length)&&(0,I.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,I.jsx)(te,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,I.jsx)("input",{value:_,onChange:function(e){return w(e.target.value)},type:"text",required:!0})}),(0,I.jsx)(te,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,I.jsx)("input",{value:C,onChange:function(e){return L(e.target.value)},type:"text"})}),(0,I.jsx)(te,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,I.jsx)("input",{value:Q,onChange:function(e){return R(e.target.value)},type:"text"})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",disabled:T.isLoading||!D.data||0==D.data.length,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]}),z&&(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return f(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,I.jsx)($e,{itemId:o,mutatateParams:(null===r||void 0===r?void 0:r.id)||0,title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",onSuccess:u,mutationFn:Ne,open:v,close:function(){return f(!1)}})]})}function Wt(){var e,t,n,r=(0,S.useState)(!1),i=(0,M.Z)(r,2),a=i[0],c=i[1],o=(0,S.useState)(null),u=(0,M.Z)(o,2),l=u[0],d=u[1],v=(0,S.useState)(null),f=(0,M.Z)(v,2),x=f[0],p=f[1],m=(0,s.s0)(),j=(0,s.UO)().eventId,g=fe(j),y=Ze(j),b=Z("add_ticket"),_=Z("change_ticket");X([null===(e=g.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,S.useEffect)((function(){g.error instanceof h&&g.error.message.includes("not found")&&m("/not_found",{replace:!0})}),[g.error,m]);var w=null===(t=y.data)||void 0===t?void 0:t.some((function(e){return e.authOnPltf})),k="/events/".concat(j);return(0,I.jsxs)(I.Fragment,{children:[(g.isLoading||y.isLoading)&&(0,I.jsx)(H,{backLink:k,children:(0,I.jsx)(W,{})}),A(g),A(y),g.data&&y.isSuccess&&(0,I.jsxs)(H,{backLink:k,centeredH:!0,gap:"1rem",padding:"1rem",children:[(0,I.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",g.data.name]}),(0,I.jsxs)("div",{className:Pt.right,children:[(0,I.jsx)(O.rU,{target:"_blank",to:"/events/".concat(j,"/print_tickets"),className:"button",children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),b&&(0,I.jsx)("button",{className:"button",onClick:function(){return c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)(Se,{eventId:j,open:a,close:function(){return c(!1)},setTicet:d})]}),(0,I.jsxs)("table",{className:Pt.table,children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:"10.5em"},children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{style:{width:"2.6em"},title:"\u0414\u0430\u0442\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f",children:(0,I.jsx)("span",{className:"icon",children:"note_add"})}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsx)("th",{style:{width:"1.4em"},title:"\u0411\u0438\u043b\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d",children:(0,I.jsx)("span",{className:"icon",children:"login"})}),w&&(0,I.jsx)("th",{style:{width:"1.4em"},title:"\u0412\u043e\u0448\u0451\u043b \u0432 \u0438\u0433\u0440\u0443",children:(0,I.jsx)("span",{className:"icon",children:"stadia_controller"})}),(0,I.jsx)("th",{style:{width:"3.2em"},children:"\u0411\u0438\u043b\u0435\u0442"}),_&&(0,I.jsx)("th",{style:{width:"2.3em"},children:"\u0420\u0435\u0434"})]})}),(0,I.jsx)("tbody",{children:null===(n=y.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personLink?(0,I.jsx)("a",{href:e.personLink,children:e.personName}):e.personName}),(0,I.jsx)("td",{children:je(e.createdDate,!0,!1)}),(0,I.jsx)("td",{style:{color:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?"red":""},children:e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:Pt.center,children:e.scanned?"\u2713":"\u2716"}),w&&(0,I.jsx)("td",{className:Pt.center,children:e.authOnPltf?"\u2713":"\u2716"}),(0,I.jsx)("td",{className:Pt.center,children:(0,I.jsx)("button",{className:"button button_small",onClick:function(){return d(e)},children:"\u0411\u0438\u043b\u0435\u0442"})}),_&&(0,I.jsx)("td",{className:Pt.center,children:(0,I.jsx)("button",{className:"button button_small",onClick:function(){return p(e)},children:"\u0420\u0435\u0434"})})]},e.id)}))})]}),(0,I.jsx)(Ge,{ticket:l,event:g.data,close:function(){return d(null)}}),(0,I.jsx)(qt,{ticket:x,eventId:j,close:function(){return p(null)},setTicket:d})]})]})}var Vt={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function Bt(){var e;X("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");var t=(0,c.useQuery)("users",(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g("/api/users");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));return(0,I.jsxs)(H,{centeredPage:!0,gap:8,children:[t.isLoading&&(0,I.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A(t),null===(e=t.data)||void 0===e?void 0:e.map((function(e){var n;return(0,I.jsxs)("div",{className:Vt.user,children:[(0,I.jsx)("input",{type:"checkbox",className:Vt.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:Vt.title,htmlFor:"user".concat(e.id),children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:e.login}),(0,I.jsx)("div",{style:{color:"blue"},children:e.id}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:e.name}),null!=e.bossId&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{style:{color:"#990099"},children:null===(n=t.data.find((function(t){return t.id==e.bossId})))||void 0===n?void 0:n.login})]})]}),(0,I.jsxs)("div",{children:[e.deleted&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,I.jsx)("div",{children:"|"})]}),(0,I.jsx)("span",{children:e.roles.join(", ")}),(0,I.jsx)("div",{className:Vt.toggle})]})]}),(0,I.jsxs)("div",{className:Vt.userInfo,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Operations"}),(0,I.jsx)("div",{className:Vt.operations,children:e.operations.map((function(e,t){return(0,I.jsx)("div",{children:Ht(e)},t)}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Access"}),(0,I.jsx)("div",{className:Vt.operations,children:e.access.map((function(e,t){return(0,I.jsx)("div",{children:e},t)}))})]})]})]},e.id)}))]})}function Ht(e){var t={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(var n in t)if(e.startsWith(n))return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{style:{color:t[n]},children:n}),(0,I.jsx)("span",{children:e.slice(n.length)})]});return(0,I.jsx)("span",{children:e})}function Jt(){var e,t=w();function n(e,n,r){var i;return(0,I.jsx)(s.AW,{path:n,element:null!==(i=t.data)&&void 0!==i&&i.auth?null==e||k(t,e)?r:(0,I.jsx)(Y,{}):(0,I.jsx)(s.Fg,{to:"/auth"})})}return(0,I.jsxs)("div",{className:"root",children:[(0,I.jsx)(C,{}),(0,I.jsx)(R,{}),t.isLoading&&(0,I.jsx)(N.Z,{}),A(t),t.isSuccess&&(0,I.jsxs)(s.Z5,{children:[(0,I.jsx)(s.AW,{path:"/auth",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,I.jsx)(s.Fg,{to:"/"}):(0,I.jsx)(ne,{})}),(0,I.jsx)(s.AW,{path:"/scanner/:eventId",element:(0,I.jsx)(Dt,{})}),n(null,"/",(0,I.jsx)(se,{})),n(null,"/profile",(0,I.jsx)(Ct,{})),n("page_events","/events",(0,I.jsx)(dt,{})),n("page_events","/events/:eventId",(0,I.jsx)(at,{})),n("page_events","/events/:eventId/tickets",(0,I.jsx)(Wt,{})),n("page_events","/events/:eventId/print_tickets",(0,I.jsx)(Zt,{})),n("page_staff","/staff",(0,I.jsx)(Ut,{})),n("page_debug","/d",(0,I.jsx)(ae,{})),n("page_debug","/d/log",(0,I.jsx)(mt,{})),n("page_debug_users","/d/users",(0,I.jsx)(Bt,{})),n("page_debug_events","/d/events",(0,I.jsx)(ut,{})),n("page_fonts","/fonts",(0,I.jsx)(vt,{})),n("page_managers","/managers",(0,I.jsx)(_t,{})),n(null,"*",(0,I.jsx)(J,{}))]})]})}}}]);
//# sourceMappingURL=562.69dab50f.chunk.js.map