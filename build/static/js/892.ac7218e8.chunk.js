"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[892],{2123:function(e,n,t){t.r(n),t.d(n,{default:function(){return tn}});var r=t(7689),s=t(4165),i=t(5861),c=t(1933),a=t(3144),u=t(5671),o=t(136),l=t(516),d=function(e){(0,o.Z)(t,e);var n=(0,l.Z)(t);function t(){return(0,u.Z)(this,t),n.apply(this,arguments)}return(0,a.Z)(t)}((0,t(8737).Z)(Error));function h(){return(0,c.useQuery)("user",v)}function v(){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,401!=n.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",name:"",operations:[]});case 8:if(n.ok){e.next=10;break}throw new d(t.msg);case 10:return(r=t).auth=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,n){var t,r;return!(null===(t=e.data)||void 0===t||!t.auth||null===(r=e.data)||void 0===r||!r.operations.includes(n))}function p(e){var n,t,r=h();return!(null===(n=r.data)||void 0===n||!n.auth||null===(t=r.data)||void 0===t||!t.operations.includes(e))}var j=t(5086),m=t(2791);function y(){var e=(0,r.TH)().pathname;return(0,m.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var _={root:"styles_root__4DGhY"},b=t(184);function g(){var e=(0,r.s0)();return(0,b.jsx)("div",{className:_.root,children:(0,b.jsx)("button",{onClick:function(){return e(-1)},children:"\u041d\u0430\u0437\u0430\u0434"})})}function k(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.filter((function(e){return!!e})).join(" ")}var A=t(1087),Z={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7"},N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";function w(e,n){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:void 0===n?null:JSON.stringify(n)})}function S(e){return C.apply(this,arguments)}function C(){return(C=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/auth",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return(i=r).auth=!0,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return I.apply(this,arguments)}function I(){return(I=(0,i.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/logout");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function Q(e){var n=e.color,t=e.zIndex;return(0,b.jsx)("div",{className:D.root,children:(0,b.jsxs)("div",{className:D.spinner,style:{"--color":n,zIndex:t},children:[(0,b.jsx)("div",{}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{})]})})}function M(){var e,n=(0,r.TH)(),t=(0,r.s0)(),s=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:E,onSuccess:function(){e.invalidateQueries("user")}})}(),i=h();return(0,b.jsxs)("div",{className:Z.root,children:[(0,b.jsxs)("span",{className:Z.block,children:[(0,b.jsx)(A.rU,{to:"/",className:Z.home,children:(0,b.jsx)("img",{src:N,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),"/"!=n.pathname&&(0,b.jsx)("button",{onClick:function(){return t(-1)},children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,b.jsxs)("span",{className:Z.block,children:[(0,b.jsx)("span",{children:null===(e=i.data)||void 0===e?void 0:e.name}),(0,b.jsx)("button",{onClick:function(){return s.mutate()},disabled:"idle"!=s.status,children:"\u0412\u044b\u0439\u0442\u0438"})]}),"idle"!=s.status&&(0,b.jsx)(Q,{})]})}var F={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function R(e){var n=e.children,t=e.className,r=e.centered,s=void 0!==r&&r,i=e.centeredPage,c=void 0!==i&&i,a=e.height100,u=void 0!==a&&a,o=e.gap,l=void 0===o?0:o,d=e.header,h=void 0===d?(0,b.jsx)(M,{}):d;return(0,b.jsxs)("div",{className:F.root,style:{maxHeight:u?"100dvh":""},children:[h||(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:k(F.body,t,s&&F.body_centered,c&&F.body_centeredPage),style:{gap:l,maxHeight:u?"100%":""},children:n})]})}function T(){return(0,b.jsx)(R,{centered:!0,header:(0,b.jsx)(g,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function L(){return(0,b.jsx)(R,{centered:!0,header:(0,b.jsx)(g,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var U=t(9439),P={form:"styles_form__n7Rcu"},O=t(3433);function z(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,m.useEffect)((function(){var t=document.title,r="object"!=typeof e?[e]:e;return document.title=[n].concat((0,O.Z)(r)).filter((function(e){return!!e})).join(" | "),function(){document.title=t}}),[e,n])}var B={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function V(e){var n=e.className,t=e.style,r=e.onSubmit,s=e.children;return(0,b.jsx)("form",{className:k(B.form,n),style:t,onSubmit:function(e){e.preventDefault(),r()},children:s})}function Y(e){var n=e.label,t=e.className,r=e.style,s=e.children;return(0,b.jsxs)("label",{className:k(B.field,t),style:r,children:[(0,b.jsx)("span",{children:n}),s]})}function K(){z("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,m.useState)(""),n=(0,U.Z)(e,2),t=n[0],r=n[1],s=(0,m.useRef)(null),i=(0,m.useRef)(null),a=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:S,onSuccess:function(e){n.setQueryData("user",(function(){return e}))},onError:function(n){null===e||void 0===e||e(n instanceof d?n.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(r);return(0,b.jsxs)(R,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,b.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),t&&(0,b.jsx)("h3",{children:t}),a.isLoading&&(0,b.jsx)(Q,{}),(0,b.jsxs)(V,{className:P.form,onSubmit:function(){var e,n,t=(null===(e=s.current)||void 0===e?void 0:e.value)||"",r=(null===(n=i.current)||void 0===n?void 0:n.value)||"";a.mutate({login:t,password:r})},children:[(0,b.jsx)(Y,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,b.jsx)("input",{ref:s,type:"text",name:"login",required:!0})}),(0,b.jsx)(Y,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,b.jsx)("input",{ref:i,type:"password",name:"password",required:!0})}),(0,b.jsx)("button",{type:"submit",disabled:"loading"==a.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,b.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function q(){var e=h();return(0,b.jsx)(R,{centered:!0,gap:"1em",children:x(e,"page_events")&&(0,b.jsx)(A.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"})})}var J={scanner:"styles_scanner__+xzXT",scannerRect:"styles_scannerRect__zwl3N",scannerVideo:"styles_scannerVideo__ZCceC",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO",alreadyScanned:"styles_alreadyScanned__OI-PM",alreadyScanned_visible:"styles_alreadyScanned_visible__keU3C"},W={root:"styles_root__QdJnV"},G=t(1096);function H(e){var n=e.active,t=void 0===n||n,r=e.className,s=e.onScan,i=e.onCameraError,c=(0,m.useState)(),a=(0,U.Z)(c,2),u=a[0],o=a[1],l=(0,m.useRef)(null);return(0,m.useEffect)((function(){if(l.current){var e=new G.Z(l.current,(function(e){return s(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return o((function(n){return null===n||void 0===n||n.stop(),null===n||void 0===n||n.destroy(),e})),e.start().catch((function(){return i()})),function(){e.stop(),e.destroy()}}}),[l,s]),(0,m.useEffect)((function(){u&&(t?u.start().catch((function(){return i()})):u.pause(!1))}),[t,u]),(0,b.jsx)("video",{className:k(W.root,r),ref:l})}function X(e,n){return"".concat(e).padStart(n,"0")}function $(e,n,t,r){var s="".concat(e);return"1"==s.at(-1)&&"1"!=s.at(-2)?n:["2","3","4"].includes(s.at(-1)||"")&&"1"!=s.at(-2)?t:r}function ee(e){return e?"".concat(X(e.getDate(),2),".").concat(X(e.getMonth()+1,2),".").concat(e.getFullYear()):""}function ne(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(X(e.getHours(),2),":").concat(X(e.getMinutes(),2));return n?t+":".concat(X(e.getSeconds(),2)):t}function te(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",t=new Date,r=e.getTime()-t.getTime(),s=Math.floor(Math.abs(r)/1e3),i=Math.floor(s/31104e3);s-=60*i*60*24*30*12;var c=Math.floor(s/2592e3);s-=60*c*60*24*30;var a=Math.floor(s/86400);s-=60*a*60*24;var u=Math.floor(s/3600)%24;s-=60*u*60;var o=Math.floor(s/60)%60,l=(s-=60*o)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=i?[i,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=c?[c,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=a?[a,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==n?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=u?[u,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=o?[o,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),h=(0,U.Z)(d,2),v=h[0],f=h[1];if("string"==typeof v)return v;var x="".concat($.apply(void 0,[v].concat((0,O.Z)(f))));return Math.abs(v)>1&&(x=Math.abs(v)+" "+x),r>0?x="\u0427\u0435\u0440\u0435\u0437 "+x:x+=" \u043d\u0430\u0437\u0430\u0434",x}var re={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function se(e){var n=e.event,t=e.onInputBtn;return(0,b.jsxs)("div",{className:re.root,children:[(0,b.jsx)("div",{className:re.top,children:(0,b.jsx)("button",{onClick:t,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,b.jsxs)("div",{className:re.bottom,children:[(0,b.jsx)("span",{children:n.name}),(0,b.jsx)("span",{children:"|"}),(0,b.jsx)("span",{children:ee(n.date)})]})]})}function ie(){return ce.apply(this,arguments)}function ce(){return(ce=(0,i.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,n.ok){e.next=8;break}throw new d(t.msg);case 8:return r=t,e.abrupt("return",r.map(de));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return ue.apply(this,arguments)}(e)}))}function ue(){return(ue=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return le.apply(this,arguments)}(e)}))}function le(){return(le=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/scanner_event/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}return e.abrupt("return",NaN);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){var n=e;return n.date=new Date(e.date),n}function he(e){return ve.apply(this,arguments)}function ve(){return(ve=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/event",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(n){return function(e,n){return xe.apply(this,arguments)}(e,n)},onSuccess:function(e){var r;t.setQueryData(["event","".concat(e.id)],(function(){return e})),"success"==(null===(r=t.getQueryState("events"))||void 0===r?void 0:r.status)&&t.setQueryData("events",(function(n){return n?[].concat((0,O.Z)(n.filter((function(n){return n.id!=e.id}))),[e]):[e]})),null===n||void 0===n||n()}});return r}function xe(){return(xe=(0,i.Z)((0,s.Z)().mark((function e(n,t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/event/"+n,t);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new d(i.msg);case 8:return e.abrupt("return",de(i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return je.apply(this,arguments)}(e)},onSuccess:function(){var r;t.removeQueries(["event","".concat(e)],{exact:!0}),"success"==(null===(r=t.getQueryState("events"))||void 0===r?void 0:r.status)&&t.setQueryData("events",(function(n){return n?n.filter((function(n){return n.id!=e})):[]})),null===n||void 0===n||n()}});return r}function je(){return(je=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/event/"+n,{method:"DELETE"});case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var me={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function ye(e){var n=e.children,t=e.open,r=void 0!==t&&t,s=e.close,i=e.title,c=void 0===i?"":i;return(0,b.jsx)("div",{className:k(me.root,r&&me.open),children:(0,b.jsxs)("div",{className:me.popup,children:[(c||s)&&(0,b.jsxs)("div",{className:me.header,children:[(0,b.jsx)("h3",{children:c}),s&&(0,b.jsx)("button",{className:me.close,onClick:s,children:"\u2716"})]}),(0,b.jsx)("div",{className:me.body,children:n})]})})}function _e(e){return(0,c.useQuery)(["tickets",e],(function(){return function(e){return be.apply(this,arguments)}(e)}))}function be(){return(be=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",r.map(ge));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e){var n=e;return e.scannedDate&&(n.scannedDate=new Date(e.scannedDate)),e.createdDate&&(n.createdDate=new Date(e.createdDate)),n}function ke(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/ticket",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",ge(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r,i,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/check_ticket",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return c=r,(i=r).ticket&&(c.ticket=ge(i.ticket)),i.event&&(c.event=de(i.event)),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){var n=(0,m.useState)((function(){var n=new Audio(e);return n.preload="auto",n})),t=(0,U.Z)(n,1)[0];return[function(){t.currentTime=0,t.play()}]}var Se=t.p+"static/media/beep.38f199e084efe5461ffd.mp3",Ce=t.p+"static/media/beepError.7eccfa35a3dd6b6ea311.mp3";function Ee(e,n){return"".concat(X(e,3),"-").concat(n.getFullYear().toString().at(-1)).concat(X(n.getMonth()+1,2)).concat(X(n.getDate(),2),"-")}function Ie(){z("\u0421\u043a\u0430\u043d\u0435\u0440");var e,n=(0,r.UO)(),t=(0,m.useState)(null),s=(0,U.Z)(t,2),i=s[0],a=s[1],u=(0,m.useState)(null),o=(0,U.Z)(u,2),l=o[0],h=o[1],v=(0,m.useState)(null),f=(0,U.Z)(v,2),x=f[0],p=f[1],j=(0,m.useState)(null),y=(0,U.Z)(j,2),_=y[0],g=y[1],A=(0,m.useState)(!0),Z=(0,U.Z)(A,2),N=Z[0],w=Z[1],S=(0,m.useState)(!1),C=(0,U.Z)(S,2),E=C[0],I=C[1],D=(0,m.useState)(!1),M=(0,U.Z)(D,2),F=M[0],T=M[1],L=(0,m.useState)(!1),P=(0,U.Z)(L,2),O=P[0],B=P[1],V=(0,m.useRef)(null),Y=oe(n.eventId),K=we(Se),q=(0,U.Z)(K,1)[0],W=we(Ce),G=(0,U.Z)(W,1)[0],X=(0,m.useCallback)((function(e){return a(e)}),[]),$=(0,m.useCallback)((function(){I(!0),V.current&&Y.data&&"number"!=typeof Y.data&&(V.current.value=Ee(Y.data.id,Y.data.date))}),[V,Y.data]),re=(0,m.useCallback)((function(){return I(!1)}),[]),ie=function(e,n){var t=(0,c.useMutation)({mutationFn:Ze,onSuccess:function(n){null===e||void 0===e||e(n)},onError:function(e){null===n||void 0===n||n(e instanceof d?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),t.reset()}});return t}((function(e){g(e),e.success||G()}),(function(e){g(null),p(e)}));return(0,m.useEffect)((function(){if(i&&Y.data&&"idle"==ie.status&&"number"!=typeof Y.data){if(q(),l==i)return a(null),void T(!0);T(!1),h(i),p(null),g(null),ie.mutate({code:i,eventId:Y.data.id})}}),[i,Y.data,ie.status]),(0,m.useEffect)((function(){if(ie.isSuccess){var e=setTimeout((function(){a(null),ie.reset()}),1e3);return function(){return clearTimeout(e)}}}),[ie.isSuccess]),(0,m.useEffect)((function(){if(F){var e=setTimeout((function(){return T(!1)}),500);return function(){return clearTimeout(e)}}}),[F]),(0,b.jsxs)(b.Fragment,{children:[Y.isLoading&&(0,b.jsx)(Q,{}),Y.error&&(0,b.jsx)(R,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof Y.data&&(0,b.jsxs)(R,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,b.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,b.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof Y.data&&Y.data&&(0,b.jsxs)(R,{height100:!0,header:(0,b.jsx)(se,{event:Y.data,onInputBtn:$}),children:[(0,b.jsx)("div",{className:k(J.scanner,!ie.isIdle&&J.scanner_scanned),children:(0,b.jsx)("div",{className:J.scannerRect,children:(0,b.jsx)(H,{onScan:X,onCameraError:function(){return B(!0)},className:J.scannerVideo})})}),(0,b.jsxs)("div",{className:J.scanResult,children:[(0,b.jsx)("div",{className:k(J.alreadyScanned,F&&J.alreadyScanned_visible),children:"\u0422\u043e\u0442 \u0436\u0435 \u0431\u0438\u043b\u0435\u0442"}),l&&(0,b.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",l]}),x&&(0,b.jsx)("div",{children:x}),(null===_||void 0===_?void 0:_.success)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:k(J.success,J.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,b.jsxs)("div",{className:J.result_desc,children:[(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",_.ticket.type]}),(0,b.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",_.ticket.promocode]})]})]}),"notExist"==(null===_||void 0===_?void 0:_.errorCode)&&(0,b.jsx)("div",{className:k(J.error,J.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===_||void 0===_?void 0:_.errorCode)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:k(J.error,J.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,b.jsxs)("div",{className:J.result_desc,children:[(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",_.event.name]}),(0,b.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",ee(_.event.date)," (",te(_.event.date,"day"),")"]})]}),(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]})]})]}),"scanned"==(null===_||void 0===_?void 0:_.errorCode)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:k(J.error,J.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,b.jsxs)("div",{className:J.result_desc,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,b.jsxs)("span",{children:[ne(_.ticket.scannedDate,!0)," "]}),(0,b.jsxs)("span",{className:k((e=_.ticket.scannedDate,((new Date).getTime()-e.getTime())/1e3>30&&J.error)),children:["(",te(_.ticket.scannedDate),")"]})]}),(0,b.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",_.ticket.personName]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",_.ticket.type]}),(0,b.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",_.ticket.promocode]})]})]})]}),(0,b.jsxs)(ye,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:E,close:re,children:[(0,b.jsx)("input",{type:"text",ref:V}),(0,b.jsx)("button",{disabled:"idle"!=ie.status,onClick:function(){var e;V.current&&a(null===(e=V.current)||void 0===e?void 0:e.value),re()},children:"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c"})]}),(0,b.jsxs)(ye,{open:O,children:[(0,b.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,b.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,b.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]}),(0,b.jsxs)(ye,{title:"\u0421\u043a\u0430\u043d\u0435\u0440 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",open:N,close:function(){return w(!1)},children:[(0,b.jsx)("h2",{children:Y.data.name}),(0,b.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u0430 \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443 \u043d\u0430 QR \u043a\u043e\u0434 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u043b\u0441\u044f \u0432 \u043c\u0438\u0433\u0430\u044e\u0449\u0443\u044e \u0440\u0430\u043c\u043a\u0443."}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0437\u0432\u0443\u043a"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u043b\u044b\u0448\u0430\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u043b \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438."]})]})]})]})}var De={space_between:"styles_space_between__AD+M6"};function Qe(e){var n=e.open,t=e.close,r=(0,m.useRef)(null),s=(0,m.useRef)(null),i=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:he,onSuccess:function(t){var r;n.setQueryData(["event","".concat(t.id)],(function(){return t})),"success"==(null===(r=n.getQueryState("events"))||void 0===r?void 0:r.status)&&n.setQueryData("events",(function(e){return e?[].concat((0,O.Z)(e),[t]):[t]})),null===e||void 0===e||e()}})}(t);return(0,m.useEffect)((function(){!n&&r.current&&s.current&&(r.current.value="",s.current.value="")}),[n,r.current,s.current]),(0,b.jsxs)(ye,{open:n,close:t,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[i.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),(0,b.jsxs)(V,{onSubmit:function(){var e,n,t=null===(e=r.current)||void 0===e?void 0:e.value,c=null===(n=s.current)||void 0===n?void 0:n.value;t&&c&&i.mutate({date:c,name:t})},children:[(0,b.jsx)(Y,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,b.jsx)("input",{ref:r,type:"text",required:!0})}),(0,b.jsx)(Y,{label:"\u0414\u0430\u0442\u0430",children:(0,b.jsx)("input",{ref:s,type:"datetime-local",required:!0})}),(0,b.jsx)("button",{type:"submit",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),i.isLoading&&(0,b.jsx)(Q,{})]})}function Me(){var e,n;z("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var t=(0,m.useState)(!1),r=(0,U.Z)(t,2),s=r[0],i=r[1],a=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",ie,{onSuccess:function(n){n.forEach((function(n){return e.setQueryData(["event","".concat(n.id)],n)}))}})}();return(0,b.jsxs)(R,{centeredPage:!0,gap:"1rem",children:[(0,b.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),a.isLoading&&(0,b.jsx)(Q,{}),a.isError&&(0,b.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),null===(e=a.data)||void 0===e||null===(n=e.sort((function(e,n){return e.date<n.date?1:-1})))||void 0===n?void 0:n.map((function(e){return(0,b.jsxs)(A.rU,{to:"/events/".concat(e.id),className:k("button button_large",De.space_between),children:[(0,b.jsx)("span",{children:e.name}),(0,b.jsx)("span",{children:ee(e.date)})]},e.id)})),p("add_event")&&(0,b.jsxs)("div",{className:De.space_between,children:[(0,b.jsx)("span",{}),(0,b.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,b.jsx)(Qe,{open:s,close:function(){return i(!1)}})]})}function Fe(){return z("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"),(0,b.jsx)(R,{centered:!0,children:"\u0422\u0443\u0442 \u0431\u0443\u0434\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"})}var Re={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89"};function Te(e){return(0,c.useQuery)(["ticket_types",e],(function(){return function(e){return Le.apply(this,arguments)}(e)}))}function Le(){return(Le=(0,i.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_types/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e,n){var t=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(n){return function(e,n){return Pe.apply(this,arguments)}(e,n)},onSuccess:function(r,s){s.some((function(e){return"delete"==e.action||"update"==e.action}))?t.invalidateQueries(["tickets","".concat(e)],{exact:!0}):t.setQueryData(["ticket_types","".concat(e)],(function(){return r})),null===n||void 0===n||n(r)}});return r}function Pe(){return(Pe=(0,i.Z)((0,s.Z)().mark((function e(n,t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("/api/ticket_types/"+n,t);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new d(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){var n,t,r,s=e.open,i=e.eventId,a=e.close,u=e.setTicet,o=(0,m.useRef)(null),l=(0,m.useRef)(null),d=(0,m.useRef)(null),h=(0,m.useRef)(null),v=(0,m.useRef)(null),f=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:ke,onSuccess:function(t){var r;"success"==(null===(r=n.getQueryState(["tickets","".concat(t.eventId)]))||void 0===r?void 0:r.status)&&n.setQueryData(["tickets","".concat(t.eventId)],(function(e){return e?[].concat((0,O.Z)(e),[t]):[t]})),null===e||void 0===e||e(t)}})}((function(e){u(e),null===a||void 0===a||a()})),x=Te(i);return(0,m.useEffect)((function(){!s&&l.current&&d.current&&h.current&&(l.current.value="",d.current.value="",h.current.value="")}),[s,l.current,d.current,h.current]),(0,b.jsxs)(ye,{open:s,close:a,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[f.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),x.isLoading&&(0,b.jsx)(Q,{}),(0,b.jsxs)(V,{onSubmit:function(){var e,n,t,r,s,c=null===(e=o.current)||void 0===e?void 0:e.value,a=null===(n=l.current)||void 0===n?void 0:n.value,u=(null===(t=d.current)||void 0===t?void 0:t.value)||"",x=(null===(r=h.current)||void 0===r?void 0:r.value)||"",p=(null===(s=v.current)||void 0===s?void 0:s.value)||"";c&&a&&f.mutate({eventId:parseInt("".concat(i),10),typeId:parseInt(c,10),personName:a,personLink:u,promocode:x,code:p})},children:[(0,b.jsxs)(Y,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,b.jsx)("select",{ref:o,disabled:0==(null===(n=x.data)||void 0===n?void 0:n.length),required:!0,children:null===(t=x.data)||void 0===t?void 0:t.map((function(e){return(0,b.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(r=x.data)||void 0===r?void 0:r.length)&&(0,b.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,b.jsx)(Y,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,b.jsx)("input",{ref:l,type:"text",required:!0})}),(0,b.jsx)(Y,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,b.jsx)("input",{ref:d,type:"text"})}),(0,b.jsx)(Y,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,b.jsx)("input",{ref:h,type:"text"})}),(0,b.jsx)("button",{type:"submit",disabled:!x.data||0==x.data.length,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),f.isLoading&&(0,b.jsx)(Q,{})]})}var ze={root:"styles_root__Lo44K",visible:"styles_visible__icoL+",center:"styles_center__w1Z-q"},Be=t(741),Ve=t(5498),Ye=t.n(Ve);function Ke(e){var n=e.event,t=e.ticket,r=e.setTicket,s=(0,m.useState)(null),i=(0,U.Z)(s,2),c=i[0],a=i[1],u=(0,m.useState)(""),o=(0,U.Z)(u,2),l=o[0],d=o[1],h=(0,m.useRef)(null);return(0,m.useEffect)((function(){t&&(a(null),d(""),Be.toDataURL(t.code,{errorCorrectionLevel:"H",scale:8},(function(e,n){return d(n)})))}),[t]),(0,m.useEffect)((function(){if(l&&h.current){var e=setTimeout((function(){l&&h.current&&Ye()(h.current).then((function(e){return a(e)}))}),10);return function(){return clearTimeout(e)}}}),[l,h]),(0,b.jsxs)(ye,{open:!!t,close:function(){return r(null)},title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,b.jsxs)("div",{ref:h,className:k(ze.root,!c&&ze.visible),children:[(0,b.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442"}),(0,b.jsx)("div",{className:ze.center,style:{marginTop:"1rem"},children:(0,b.jsx)("img",{src:l,alt:null===t||void 0===t?void 0:t.code})}),(0,b.jsx)("div",{className:ze.center,style:{marginBottom:"1rem"},children:null===t||void 0===t?void 0:t.code}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",null===n||void 0===n?void 0:n.name]}),(0,b.jsxs)("div",{children:["\u0414\u0430\u0442\u0430: ",ee(null===n||void 0===n?void 0:n.date)]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",null===t||void 0===t?void 0:t.type]}),(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",null===t||void 0===t?void 0:t.personName]})]})]}),c&&(0,b.jsx)("div",{ref:function(e){e&&(e.innerHTML="",e.appendChild(c))}}),c&&(0,b.jsx)("div",{className:ze.center,children:"\u042d\u0442\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430, \u043c\u043e\u0436\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})}function qe(e){var n,t,r=e.eventId,s=e.open,i=e.close,c=(0,m.useState)(0),a=(0,U.Z)(c,2),u=(a[0],a[1]),o=(0,m.useState)(new Map),l=(0,U.Z)(o,2),d=l[0],h=l[1],v=(0,m.useState)([]),f=(0,U.Z)(v,2),x=f[0],p=f[1],j=Te(r),y=Ue(r,i);return(0,m.useEffect)((function(){h(new Map),p([]),u(0)}),[s]),(0,b.jsxs)(ye,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0438\u0434\u043e\u0432 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",children:[y.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),j.isLoading&&(0,b.jsx)(Q,{}),y.isLoading&&(0,b.jsx)(Q,{}),(0,b.jsxs)(V,{onSubmit:function(){(d.size>0||x.length>0)&&y.mutate([].concat((0,O.Z)(x.filter((function(e){return"add"==e.action}))),(0,O.Z)(Array.from(d.values()))))},children:[null===(n=j.data)||void 0===n||null===(t=n.filter((function(e){var n;return"delete"!=(null===(n=d.get(e.id))||void 0===n?void 0:n.action)})))||void 0===t?void 0:t.map((function(e){var n;return(0,b.jsxs)(Y,{children:[(0,b.jsx)("input",{type:"text",required:!0,value:(null===(n=d.get(e.id))||void 0===n?void 0:n.name)||e.name,onChange:function(n){d.set(e.id,{id:e.id,name:n.target.value,action:"update"}),u((function(e){return e+1}))}}),(0,b.jsx)("button",{type:"button",onClick:function(){d.set(e.id,{id:e.id,name:"",action:"delete"}),u((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},e.id)})),x.filter((function(e){return"add"==e.action})).map((function(e,n){return(0,b.jsxs)(Y,{children:[(0,b.jsx)("input",{type:"text",required:!0,onChange:function(e){x[n].name=e.target.value,u((function(e){return e+1}))}}),(0,b.jsx)("button",{type:"button",onClick:function(){x[n].action="delete",u((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},"new"+n)})),(0,b.jsx)("button",{onClick:function(){x.push({name:"",action:"add"}),u((function(e){return e+1}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,b.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Je(e){var n,t,r=e.eventId,s=e.open,i=e.close,c=(0,m.useRef)(null),a=(0,m.useRef)(null),u=fe(r,i),o=ae(r);return(0,b.jsxs)(ye,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[u.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),o.isLoading&&(0,b.jsx)(Q,{}),u.isLoading&&(0,b.jsx)(Q,{}),(0,b.jsxs)(V,{onSubmit:function(){var e,n,t=null===(e=c.current)||void 0===e?void 0:e.value,r=null===(n=a.current)||void 0===n?void 0:n.value;t&&r&&u.mutate({date:r,name:t})},children:[(0,b.jsx)(Y,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,b.jsx)("input",{ref:c,type:"text",required:!0,defaultValue:null===(n=o.data)||void 0===n?void 0:n.name})}),(0,b.jsx)(Y,{label:"\u0414\u0430\u0442\u0430",children:(0,b.jsx)("input",{ref:a,type:"datetime-local",required:!0,defaultValue:null===(t=o.data)||void 0===t?void 0:t.date.toISOString().slice(0,-5)})}),(0,b.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function We(e){var n=e.eventId,t=e.open,s=e.close,i=(0,r.s0)(),c=pe(n,(function(){null===s||void 0===s||s(),i("/events")}));return(0,b.jsxs)(ye,{open:t,close:s,title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[c.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),c.isLoading&&(0,b.jsx)(Q,{}),(0,b.jsxs)(V,{onSubmit:function(){c.mutate()},children:[(0,b.jsx)("h1",{children:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"}),(0,b.jsx)("button",{type:"submit",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Ge(){var e,n,t=(0,m.useState)(!1),s=(0,U.Z)(t,2),i=s[0],c=s[1],a=(0,m.useState)(!1),u=(0,U.Z)(a,2),o=u[0],l=u[1],d=(0,m.useState)(!1),h=(0,U.Z)(d,2),v=h[0],f=h[1],x=(0,m.useState)(!1),j=(0,U.Z)(x,2),y=j[0],_=j[1],g=(0,m.useState)(null),k=(0,U.Z)(g,2),Z=k[0],N=k[1],w=(0,r.UO)().eventId,S=ae(w),C=Te(w),E=p("add_ticket"),I=p("change_ticket_types"),D=p("change_event"),M=p("delete_event");return z((null===(e=S.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,b.jsxs)(b.Fragment,{children:[S.isLoading&&(0,b.jsx)(R,{children:(0,b.jsx)(Q,{})}),S.isError&&(0,b.jsx)(R,{centered:!0,children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),S.data&&(0,b.jsxs)(R,{centeredPage:!0,gap:"1rem",children:[(0,b.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",S.data.name]}),(0,b.jsxs)("div",{className:Re.card,children:[(0,b.jsxs)("div",{className:Re.card__header,children:[(0,b.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),D&&(0,b.jsx)("button",{className:"button",onClick:function(){return f(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,b.jsx)(Je,{eventId:w,open:v,close:function(){return f(!1)}})]}),(0,b.jsxs)("div",{className:Re.card__body,children:[(0,b.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",S.data.name]}),(0,b.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",ee(S.data.date)]})]})]}),(0,b.jsxs)("div",{className:Re.card,children:[(0,b.jsxs)("div",{className:Re.card__header,children:[(0,b.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),I&&(0,b.jsx)("button",{className:"button",onClick:function(){return _(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,b.jsx)(qe,{eventId:w,open:y,close:function(){return _(!1)}})]}),(0,b.jsxs)("div",{className:Re.card__body,children:[C.isLoading&&(0,b.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),C.isError&&(0,b.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),null===(n=C.data)||void 0===n?void 0:n.map((function(e){return(0,b.jsx)("div",{children:e.name},e.id)}))]})]}),(0,b.jsx)(A.rU,{to:"/scanner/".concat(w),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),E&&(0,b.jsx)("button",{className:"button",onClick:function(){return c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,b.jsx)(Oe,{eventId:w,open:i,close:function(){return c(!1)},setTicet:N}),(0,b.jsx)(Ke,{ticket:Z,event:S.data,setTicket:N}),(0,b.jsx)(A.rU,{to:"/events/".concat(w,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,b.jsx)("div",{className:Re.gap}),(0,b.jsx)("div",{className:Re.right,children:M&&(0,b.jsx)("button",{className:"button",onClick:function(){return l(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,b.jsx)(We,{eventId:w,open:o,close:function(){return l(!1)}})]})]})}var He={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX"};function Xe(){var e,n,t=(0,m.useState)(!1),s=(0,U.Z)(t,2),i=s[0],c=s[1],a=(0,m.useState)(null),u=(0,U.Z)(a,2),o=u[0],l=u[1],d=(0,r.UO)().eventId,h=ae(d),v=_e(d),f=p("add_ticket");return z([null===(e=h.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,b.jsxs)(b.Fragment,{children:[(h.isLoading||v.isLoading)&&(0,b.jsx)(R,{children:(0,b.jsx)(Q,{})}),(h.isError||v.isError)&&(0,b.jsx)(R,{centered:!0,children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),h.data&&v.isSuccess&&(0,b.jsxs)(R,{centeredPage:!0,gap:"1rem",children:[(0,b.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",h.data.name]}),(0,b.jsxs)("div",{className:He.right,children:[(0,b.jsx)(A.rU,{target:"_blank",to:"/events/".concat(d,"/print_tickets"),className:"button",children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),f&&(0,b.jsx)("button",{className:"button",onClick:function(){return c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,b.jsx)(Oe,{eventId:d,open:i,close:function(){return c(!1)},setTicet:l})]}),(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{width:"11em"},children:"\u041a\u043e\u0434"}),(0,b.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,b.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,b.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,b.jsxs)("th",{children:[(0,b.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,b.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]}),(0,b.jsx)("th",{children:"\u0411\u0438\u043b\u0435\u0442"})]})}),(0,b.jsx)("tbody",{children:null===(n=v.data)||void 0===n?void 0:n.map((function(e){return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:e.code}),(0,b.jsx)("td",{children:e.personName}),(0,b.jsx)("td",{style:{color:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?"red":""},children:e.type}),(0,b.jsx)("td",{children:e.promocode}),(0,b.jsx)("td",{className:He.center,children:e.scanned?"\u2713":"\u2716"}),(0,b.jsx)("td",{className:He.center,children:(0,b.jsx)("button",{onClick:function(){return l(e)},children:"\u0411\u0438\u043b\u0435\u0442"})})]},e.id)}))})]}),(0,b.jsx)(Ke,{ticket:o,event:h.data,setTicket:l})]})]})}var $e=t(1413),en={root:"styles_root__QCWgG",table:"styles_table__Klrj7",center:"styles_center__pcMYz",mark:"styles_mark__4aU1o"};function nn(){var e,n=(0,r.UO)().eventId,t=ae(n),s=_e(n);z([null===(e=t.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]);var i=(0,m.useMemo)((function(){if(!s.data||!t.data)return[!1,""];var e=Ee(t.data.id,t.data.date);return[s.data.every((function(n){return n.code.startsWith(e)})),e]}),[s.data,t.data]),c=(0,U.Z)(i,2),a=c[0],u=c[1];return(0,m.useEffect)((function(){if(t.isSuccess&&s.isSuccess){var e=setTimeout((function(){return window.print()}),1e3);return function(){return clearTimeout(e)}}}),[t.isSuccess,s.isSuccess]),(0,b.jsxs)(b.Fragment,{children:[(t.isLoading||s.isLoading)&&(0,b.jsx)(Q,{}),(t.isError||s.isError)&&(0,b.jsx)("h1",{children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),t.isSuccess&&s.isSuccess&&(0,b.jsx)("div",{className:en.root,children:(0,b.jsxs)("table",{className:en.table,children:[(0,b.jsxs)("thead",{children:[(0,b.jsx)("tr",{children:(0,b.jsxs)("th",{colSpan:5,children:[(0,b.jsx)("span",{children:t.data.name}),a&&(0,b.jsx)("span",{style:{marginLeft:"1rem"},children:"|"}),a&&(0,b.jsxs)("span",{style:{marginLeft:"1rem"},children:["\u0412\u0441\u0435 \u043a\u043e\u0434\u044b \u0434\u043e\u0436\u043d\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 ",u]})]})}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"\u041a\u043e\u0434"}),(0,b.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,b.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,b.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,b.jsxs)("th",{children:[(0,b.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,b.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]})]})]}),(0,b.jsx)("tbody",{children:s.data.map((function(e){return a?(0,$e.Z)((0,$e.Z)({},e),{},{code:e.code.slice(u.length),sortV:e.code.slice(e.code.lastIndexOf("-"))}):(0,$e.Z)((0,$e.Z)({},e),{},{sortV:e.code})})).sort((function(e,n){return e.sortV>n.sortV?1:-1})).map((function(e){return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:e.code}),(0,b.jsx)("td",{children:e.personName}),(0,b.jsx)("td",{children:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?e.type.slice(8):e.type}),(0,b.jsx)("td",{children:e.promocode}),(0,b.jsx)("td",{className:en.center,children:(0,b.jsx)("span",{className:en.mark,children:e.scanned&&"\u2713"})})]},e.id)}))})]})})]})}function tn(){var e,n=h();function t(e,t,s){var i;return(0,b.jsx)(r.AW,{path:t,element:null!==(i=n.data)&&void 0!==i&&i.auth?null==e||x(n,e)?s:(0,b.jsx)(L,{}):(0,b.jsx)(r.Fg,{to:"/auth"})})}return(0,b.jsxs)("div",{className:"root",children:[(0,b.jsx)(y,{}),n.isLoading&&(0,b.jsx)(j.Z,{}),n.isError&&"\u041e\u0448\u0438\u0431\u043a\u0430",n.isSuccess&&(0,b.jsxs)(r.Z5,{children:[(0,b.jsx)(r.AW,{path:"/auth",element:null!==(e=n.data)&&void 0!==e&&e.auth?(0,b.jsx)(r.Fg,{to:"/"}):(0,b.jsx)(K,{})}),(0,b.jsx)(r.AW,{path:"/scanner/:eventId",element:(0,b.jsx)(Ie,{})}),t(null,"/",(0,b.jsx)(q,{})),t("page_events","/events",(0,b.jsx)(Me,{})),t("page_events","/events/:eventId",(0,b.jsx)(Ge,{})),t("page_events","/events/:eventId/tickets",(0,b.jsx)(Xe,{})),t("page_events","/events/:eventId/print_tickets",(0,b.jsx)(nn,{})),t("page_staff","/staff",(0,b.jsx)(Fe,{})),t(null,"*",(0,b.jsx)(T,{}))]})]})}}}]);
//# sourceMappingURL=892.ac7218e8.chunk.js.map