"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[422],{422:function(e,n,t){t.r(n),t.d(n,{default:function(){return Pe}});var r=t(7689),s=t(4165),a=t(5861),c=t(1933),i=t(3144),o=t(5671),u=t(136),l=t(516),d=function(e){(0,u.Z)(t,e);var n=(0,l.Z)(t);function t(){return(0,o.Z)(this,t),n.apply(this,arguments)}return(0,i.Z)(t)}((0,t(8737).Z)(Error));function h(){return(0,c.useQuery)("user",v)}function v(){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,401!=n.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",name:"",operations:[]});case 8:if(n.ok){e.next=10;break}throw new d(t.msg);case 10:return(r=t).auth=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,n){var t,r;return!(null===(t=e.data)||void 0===t||!t.auth||null===(r=e.data)||void 0===r||!r.operations.includes(n))}function p(e){var n,t,r=h();return!(null===(n=r.data)||void 0===n||!n.auth||null===(t=r.data)||void 0===t||!t.operations.includes(e))}var j=t(5086),m=t(2791);function _(){var e=(0,r.TH)().pathname;return(0,m.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var y={root:"styles_root__4DGhY"},b=t(184);function g(){var e=(0,r.s0)();return(0,b.jsx)("div",{className:y.root,children:(0,b.jsx)("button",{onClick:function(){return e(-1)},children:"\u041d\u0430\u0437\u0430\u0434"})})}function A(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.filter((function(e){return!!e})).join(" ")}var k=t(1087),N={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7"},w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";function Z(e,n){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:void 0===n?null:JSON.stringify(n)})}function S(e){return D.apply(this,arguments)}function D(){return(D=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z("/api/auth",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return(a=r).auth=!0,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return E.apply(this,arguments)}function E(){return(E=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z("/api/logout");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function F(e){var n=e.color,t=e.zIndex;return(0,b.jsx)("div",{className:M.root,children:(0,b.jsxs)("div",{className:M.spinner,style:{"--color":n,zIndex:t},children:[(0,b.jsx)("div",{}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{}),(0,b.jsx)("div",{})]})})}function I(){var e,n=(0,r.TH)(),t=(0,r.s0)(),s=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:C,onSuccess:function(){e.invalidateQueries("user")}})}(),a=h();return(0,b.jsxs)("div",{className:N.root,children:[(0,b.jsxs)("span",{className:N.block,children:[(0,b.jsx)(k.rU,{to:"/",className:N.home,children:(0,b.jsx)("img",{src:w,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),"/"!=n.pathname&&(0,b.jsx)("button",{onClick:function(){return t(-1)},children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,b.jsxs)("span",{className:N.block,children:[(0,b.jsx)("span",{children:null===(e=a.data)||void 0===e?void 0:e.name}),(0,b.jsx)("button",{onClick:function(){return s.mutate()},disabled:"idle"!=s.status,children:"\u0412\u044b\u0439\u0442\u0438"})]}),"idle"!=s.status&&(0,b.jsx)(F,{})]})}var U={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function Q(e){var n=e.children,t=e.className,r=e.centered,s=void 0!==r&&r,a=e.centeredPage,c=void 0!==a&&a,i=e.height100,o=void 0!==i&&i,u=e.gap,l=void 0===u?0:u,d=e.header,h=void 0===d?(0,b.jsx)(I,{}):d;return(0,b.jsxs)("div",{className:U.root,style:{maxHeight:o?"100dvh":""},children:[h||(0,b.jsx)("div",{}),(0,b.jsx)("div",{className:A(U.body,t,s&&U.body_centered,c&&U.body_centeredPage),style:{gap:l,maxHeight:o?"100%":""},children:n})]})}function P(){return(0,b.jsx)(Q,{centered:!0,header:(0,b.jsx)(g,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function R(){return(0,b.jsx)(Q,{centered:!0,header:(0,b.jsx)(g,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var T=t(9439),B={form:"styles_form__n7Rcu"},O=t(3433);function L(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,m.useEffect)((function(){var t=document.title,r="object"!=typeof e?[e]:e;return document.title=[n].concat((0,O.Z)(r)).filter((function(e){return!!e})).join(" | "),function(){document.title=t}}),[e,n])}var Y={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function z(e){var n=e.className,t=e.style,r=e.onSubmit,s=e.children;return(0,b.jsx)("form",{className:A(Y.form,n),style:t,onSubmit:function(e){e.preventDefault(),r()},children:s})}function J(e){var n=e.label,t=e.className,r=e.style,s=e.children;return(0,b.jsxs)("label",{className:A(Y.field,t),style:r,children:[(0,b.jsx)("span",{children:n}),s]})}function K(){L("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,m.useState)(""),n=(0,T.Z)(e,2),t=n[0],r=n[1],s=(0,m.useRef)(null),a=(0,m.useRef)(null),i=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:S,onSuccess:function(e){n.setQueryData("user",(function(){return e}))},onError:function(n){null===e||void 0===e||e(n instanceof d?n.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(r);return(0,b.jsxs)(Q,{header:null,centered:!0,gap:"2em",children:[(0,b.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),t&&(0,b.jsx)("h3",{children:t}),i.isLoading&&(0,b.jsx)(F,{}),(0,b.jsxs)(z,{className:B.form,onSubmit:function(){var e,n,t=(null===(e=s.current)||void 0===e?void 0:e.value)||"",r=(null===(n=a.current)||void 0===n?void 0:n.value)||"";i.mutate({login:t,password:r})},children:[(0,b.jsx)(J,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,b.jsx)("input",{ref:s,type:"text",name:"login",required:!0})}),(0,b.jsx)(J,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,b.jsx)("input",{ref:a,type:"password",name:"password",required:!0})}),(0,b.jsx)("button",{type:"submit",disabled:"loading"==i.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,b.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function X(){var e=h();return(0,b.jsx)(Q,{centered:!0,gap:"1em",children:x(e,"page_events")&&(0,b.jsx)(k.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"})})}var G={scanner:"styles_scanner__+xzXT",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO"},H={root:"styles_root__QdJnV"},W=t(3835);function V(e){var n=e.active,t=void 0===n||n,r=e.onScan,s=(0,m.useState)(),a=(0,T.Z)(s,2),c=a[0],i=a[1],o=(0,m.useRef)(null);return(0,m.useEffect)((function(){if(o.current){var e=new W.Z(o.current,(function(e){return r(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return i((function(n){return null===n||void 0===n||n.stop(),null===n||void 0===n||n.destroy(),e})),e.start(),function(){e.stop(),e.destroy()}}}),[o,r]),(0,m.useEffect)((function(){c&&(t?c.start():c.pause(!1))}),[t,c]),(0,b.jsx)("video",{className:H.root,ref:o})}function q(e,n){return"".concat(e).padStart(n,"0")}function $(e,n,t,r){var s="".concat(e);return"1"==s.at(-1)&&"1"!=s.at(-2)?n:["2","3","4"].includes(s.at(-1)||"")&&"1"!=s.at(-2)?t:r}function ee(e){return e?"".concat(q(e.getDate(),2),".").concat(q(e.getMonth()+1,2),".").concat(e.getFullYear()):""}function ne(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(q(e.getHours(),2),":").concat(q(e.getMinutes(),2));return n?t+":".concat(q(e.getSeconds(),2)):t}function te(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",t=new Date,r=e.getTime()-t.getTime(),s=Math.floor(Math.abs(r)/1e3),a=Math.floor(s/31104e3);s-=60*a*60*24*30*12;var c=Math.floor(s/2592e3);s-=60*c*60*24*30;var i=Math.floor(s/86400);s-=60*i*60*24;var o=Math.floor(s/3600)%24;s-=60*o*60;var u=Math.floor(s/60)%60,l=(s-=60*u)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=a?[a,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=c?[c,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=i?[i,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==n?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=o?[o,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=u?[u,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==n?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),h=(0,T.Z)(d,2),v=h[0],f=h[1];if("string"==typeof v)return v;var x="".concat($.apply(void 0,[v].concat((0,O.Z)(f))));return Math.abs(v)>1&&(x=Math.abs(v)+" "+x),r>0?x="\u0427\u0435\u0440\u0435\u0437 "+x:x+=" \u043d\u0430\u0437\u0430\u0434",x}var re={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function se(e){var n=e.event,t=e.onInputBtn;return(0,b.jsxs)("div",{className:re.root,children:[(0,b.jsx)("div",{className:re.top,children:(0,b.jsx)("button",{onClick:t,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,b.jsxs)("div",{className:re.bottom,children:[(0,b.jsx)("span",{children:n.name}),(0,b.jsx)("span",{children:"|"}),(0,b.jsx)("span",{children:ee(n.date)})]})]})}function ae(){return ce.apply(this,arguments)}function ce(){return(ce=(0,a.Z)((0,s.Z)().mark((function e(){var n,t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events");case 2:return n=e.sent,e.next=5,n.json();case 5:if(t=e.sent,n.ok){e.next=8;break}throw new d(t.msg);case 8:return r=t,e.abrupt("return",r.map(de));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return oe.apply(this,arguments)}(e)}))}function oe(){return(oe=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return le.apply(this,arguments)}(e)}))}function le(){return(le=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/scanner_event/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}return e.abrupt("return",NaN);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){var n=e;return n.date=new Date(e.date),n}function he(e){return ve.apply(this,arguments)}function ve(){return(ve=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z("/api/event",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",de(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function xe(e){var n=e.children,t=e.open,r=void 0!==t&&t,s=e.close,a=e.title,c=void 0===a?"":a;return(0,b.jsx)("div",{className:A(fe.root,r&&fe.open),children:(0,b.jsxs)("div",{className:fe.popup,children:[(0,b.jsxs)("div",{className:fe.header,children:[(0,b.jsx)("h3",{children:c}),(0,b.jsx)("button",{className:fe.close,onClick:s,children:"\u2716"})]}),(0,b.jsx)("div",{className:fe.body,children:n})]})})}function pe(e){return(0,c.useQuery)(["tickets",e],(function(){return function(e){return je.apply(this,arguments)}(e)}))}function je(){return(je=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",r.map(me));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){var n=e;return e.scannedDate&&(n.scannedDate=new Date(e.scannedDate)),e.createdDate&&(n.createdDate=new Date(e.createdDate)),n}function _e(e){return ye.apply(this,arguments)}function ye(){return(ye=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r,a,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z("/api/check_ticket",n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return c=r,(a=r).ticket&&(c.ticket=me(a.ticket)),a.event&&(c.event=de(a.event)),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){L("\u0421\u043a\u0430\u043d\u0435\u0440");var e,n=(0,r.UO)(),t=(0,m.useState)(null),s=(0,T.Z)(t,2),a=s[0],i=s[1],o=(0,m.useState)(null),u=(0,T.Z)(o,2),l=u[0],h=u[1],v=(0,m.useState)(null),f=(0,T.Z)(v,2),x=f[0],p=f[1],j=(0,m.useState)(null),_=(0,T.Z)(j,2),y=_[0],g=_[1],k=(0,m.useState)(!1),N=(0,T.Z)(k,2),w=N[0],Z=N[1],S=(0,m.useRef)(null),D=ue(n.eventId),C=(0,m.useCallback)((function(e){return i(e)}),[]),E=(0,m.useCallback)((function(){Z(!0),S.current&&D.data&&"number"!=typeof D.data&&(S.current.value="".concat(q(D.data.id,3),"-").concat(D.data.date.getFullYear().toString().at(-1)).concat(q(D.data.date.getMonth()+1,2)).concat(q(D.data.date.getDate(),2),"-"))}),[S,D.data]),M=(0,m.useCallback)((function(){return Z(!1)}),[]),I=function(e,n){var t=(0,c.useMutation)({mutationFn:_e,onSuccess:function(n){null===e||void 0===e||e(n)},onError:function(e){null===n||void 0===n||n(e instanceof d?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),t.reset()}});return t}(g,(function(e){g(null),p(e)}));return(0,m.useEffect)((function(){a&&D.data&&"idle"==I.status&&"number"!=typeof D.data&&(h(a),p(null),i(null),g(null),I.mutate({code:a,eventId:D.data.id}))}),[a,D.data,I]),(0,m.useEffect)((function(){if(I.isSuccess){var e=setTimeout((function(){i(null),I.reset()}),1e3);return function(){return clearTimeout(e)}}}),[I]),(0,b.jsxs)(b.Fragment,{children:[D.isLoading&&(0,b.jsx)(F,{}),D.error&&(0,b.jsx)(Q,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof D.data&&(0,b.jsxs)(Q,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,b.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,b.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof D.data&&D.data&&(0,b.jsxs)(Q,{height100:!0,header:(0,b.jsx)(se,{event:D.data,onInputBtn:E}),children:[(0,b.jsx)("div",{className:A(G.scanner,!I.isIdle&&G.scanner_scanned),children:(0,b.jsx)(V,{onScan:C})}),(0,b.jsxs)("div",{className:G.scanResult,children:[l&&(0,b.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",l]}),x&&(0,b.jsx)("div",{children:x}),(null===y||void 0===y?void 0:y.success)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:A(G.success,G.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,b.jsxs)("div",{className:G.result_desc,children:[(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",y.ticket.personName]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",y.ticket.type]}),(0,b.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",y.ticket.promocode]})]})]}),"notExist"==(null===y||void 0===y?void 0:y.errorCode)&&(0,b.jsx)("div",{className:A(G.error,G.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===y||void 0===y?void 0:y.errorCode)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:A(G.error,G.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,b.jsxs)("div",{className:G.result_desc,children:[(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",y.event.name]}),(0,b.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",ee(y.event.date)," (",te(y.event.date,"day"),")"]})]}),(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",y.ticket.personName]})]})]}),"scanned"==(null===y||void 0===y?void 0:y.errorCode)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:A(G.error,G.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,b.jsxs)("div",{className:G.result_desc,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,b.jsxs)("span",{children:[ne(y.ticket.scannedDate,!0)," "]}),(0,b.jsxs)("span",{className:A((e=y.ticket.scannedDate,((new Date).getTime()-e.getTime())/1e3>30&&G.error)),children:["(",te(y.ticket.scannedDate),")"]})]}),(0,b.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",y.ticket.personName]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",y.ticket.type]}),(0,b.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",y.ticket.promocode]})]})]})]}),(0,b.jsxs)(xe,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:w,close:M,children:[(0,b.jsx)("input",{type:"text",ref:S}),(0,b.jsx)("button",{disabled:"idle"!=I.status,onClick:function(){var e;S.current&&i(null===(e=S.current)||void 0===e?void 0:e.value),M()},children:"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})]})]})}var ge={space_between:"styles_space_between__AD+M6"};function Ae(e){var n=e.open,t=e.close,r=(0,m.useRef)(null),s=(0,m.useRef)(null),a=function(e){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:he,onSuccess:function(t){var r;n.setQueryData(["event",t.id],(function(){return t})),"success"==(null===(r=n.getQueryState("events"))||void 0===r?void 0:r.status)&&n.setQueryData("events",(function(e){return e?[].concat((0,O.Z)(e),[t]):[t]})),null===e||void 0===e||e()}})}(t);return(0,b.jsxs)(xe,{open:n,close:t,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[a.isError&&(0,b.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),(0,b.jsxs)(z,{onSubmit:function(){var e,n,t=null===(e=r.current)||void 0===e?void 0:e.value,c=null===(n=s.current)||void 0===n?void 0:n.value;t&&c&&a.mutate({date:c,name:t})},children:[(0,b.jsx)(J,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,b.jsx)("input",{ref:r,type:"text",required:!0})}),(0,b.jsx)(J,{label:"\u0414\u0430\u0442\u0430",children:(0,b.jsx)("input",{ref:s,type:"datetime-local",required:!0})}),(0,b.jsx)("button",{type:"submit",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),a.isLoading&&(0,b.jsx)(F,{})]})}function ke(){var e;L("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var n=(0,m.useState)(!1),t=(0,T.Z)(n,2),r=t[0],s=t[1],a=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",ae,{onSuccess:function(n){n.forEach((function(n){return e.setQueryData(["event","".concat(n.id)],n)}))}})}();return(0,b.jsxs)(Q,{centeredPage:!0,gap:"1rem",children:[(0,b.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),a.isLoading&&(0,b.jsx)(F,{}),a.isError&&(0,b.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),null===(e=a.data)||void 0===e?void 0:e.map((function(e){return(0,b.jsxs)(k.rU,{to:"/events/".concat(e.id),className:A("button button_large",ge.space_between),children:[(0,b.jsx)("span",{children:e.name}),(0,b.jsx)("span",{children:ee(e.date)})]},e.id)})),p("add_event")&&(0,b.jsxs)("div",{className:ge.space_between,children:[(0,b.jsx)("span",{}),(0,b.jsx)("button",{className:"button",onClick:function(){return s(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,b.jsx)(Ae,{open:r,close:function(){return s(!1)}})]})}function Ne(){return L("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"),(0,b.jsx)(Q,{centered:!0,children:"\u0422\u0443\u0442 \u0431\u0443\u0434\u0435\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"})}var we={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89"};function Ze(e){return(0,c.useQuery)(["ticket_types",e],(function(){return function(e){return Se.apply(this,arguments)}(e)}))}function Se(){return(Se=(0,a.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_types/"+n);case 2:return t=e.sent,e.next=5,t.json();case 5:if(r=e.sent,t.ok){e.next=8;break}throw new d(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(){var e,n,t=(0,r.UO)().eventId,s=ie(t),a=Ze(t);return L((null===(e=s.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,b.jsxs)(b.Fragment,{children:[s.isLoading&&(0,b.jsx)(Q,{children:(0,b.jsx)(F,{})}),s.isError&&(0,b.jsx)(Q,{centered:!0,children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),s.data&&(0,b.jsxs)(Q,{centeredPage:!0,gap:"1rem",children:[(0,b.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",s.data.name]}),(0,b.jsxs)("div",{className:we.card,children:[(0,b.jsxs)("div",{className:we.card__header,children:[(0,b.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]}),(0,b.jsxs)("div",{className:we.card__body,children:[(0,b.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",s.data.name]}),(0,b.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",ee(s.data.date)]})]})]}),(0,b.jsxs)("div",{className:we.card,children:[(0,b.jsxs)("div",{className:we.card__header,children:[(0,b.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]}),(0,b.jsxs)("div",{className:we.card__body,children:[a.isLoading&&(0,b.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),a.isError&&(0,b.jsx)("div",{children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),null===(n=a.data)||void 0===n?void 0:n.map((function(e){return(0,b.jsx)("div",{children:e.name},e.id)}))]})]}),(0,b.jsx)(k.rU,{to:"/scanner/".concat(t),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,b.jsx)(k.rU,{to:"/events/".concat(t,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,b.jsx)("div",{className:we.gap}),(0,b.jsx)("div",{className:we.right,children:(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})]})]})}var Ce={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX"},Ee={root:"styles_root__L6Gyd",visible:"styles_visible__nfYo0",center:"styles_center__LDcBX"},Me=t(741),Fe=t(5498),Ie=t.n(Fe);function Ue(e){var n=e.event,t=e.ticket,r=(0,m.useState)(null),s=(0,T.Z)(r,2),a=s[0],c=s[1],i=(0,m.useState)(""),o=(0,T.Z)(i,2),u=o[0],l=o[1],d=(0,m.useRef)(null);return(0,m.useEffect)((function(){t&&(c(null),Me.toDataURL(t.code,{errorCorrectionLevel:"H",scale:8},(function(e,n){return l(n)})))}),[t]),(0,m.useEffect)((function(){if(u&&d.current){var e=setTimeout((function(){u&&d.current&&Ie()(d.current).then((function(e){return c(e)}))}),10);return function(){return clearTimeout(e)}}}),[u,d]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{ref:d,className:A(Ee.root,!a&&Ee.visible),children:[(0,b.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442"}),(0,b.jsx)("div",{className:Ee.center,style:{marginTop:"1rem"},children:(0,b.jsx)("img",{src:u,alt:null===t||void 0===t?void 0:t.code})}),(0,b.jsx)("div",{className:Ee.center,style:{marginBottom:"1rem"},children:null===t||void 0===t?void 0:t.code}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",null===n||void 0===n?void 0:n.name]}),(0,b.jsxs)("div",{children:["\u0414\u0430\u0442\u0430: ",ee(null===n||void 0===n?void 0:n.date)]}),(0,b.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",null===t||void 0===t?void 0:t.type]}),(0,b.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",null===t||void 0===t?void 0:t.personName]})]})]}),a&&(0,b.jsx)("div",{ref:function(e){e&&(e.innerHTML="",e.appendChild(a))}})]})}function Qe(){var e,n,t=(0,m.useState)(null),s=(0,T.Z)(t,2),a=s[0],c=s[1],i=(0,r.UO)().eventId,o=ie(i),u=pe(i);return L([null===(e=o.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,b.jsxs)(b.Fragment,{children:[(o.isLoading||u.isLoading)&&(0,b.jsx)(Q,{children:(0,b.jsx)(F,{})}),(o.isError||u.isError)&&(0,b.jsx)(Q,{centered:!0,children:"\u041e\u0448\u0438\u0431\u043a\u0430"}),o.data&&u.isSuccess&&(0,b.jsxs)(Q,{centeredPage:!0,gap:"1rem",children:[(0,b.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",o.data.name]}),(0,b.jsxs)("div",{className:Ce.right,children:[(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),(0,b.jsx)("button",{className:"button",onClick:function(){return alert("\u041f\u043e\u043a\u0430 \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442")},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{width:"11em"},children:"\u041a\u043e\u0434"}),(0,b.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,b.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,b.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,b.jsxs)("th",{children:[(0,b.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,b.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]}),(0,b.jsx)("th",{children:"\u0411\u0438\u043b\u0435\u0442"})]})}),(0,b.jsx)("tbody",{children:null===(n=u.data)||void 0===n?void 0:n.map((function(e){return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:e.code}),(0,b.jsx)("td",{children:e.personName}),(0,b.jsx)("td",{children:e.type}),(0,b.jsx)("td",{children:e.promocode}),(0,b.jsx)("td",{className:Ce.center,children:e.scanned?"\u2713":"\u2716"}),(0,b.jsx)("td",{className:Ce.center,children:(0,b.jsx)("button",{onClick:function(){return c(e)},children:"\u0411\u0438\u043b\u0435\u0442"})})]},e.id)}))})]}),(0,b.jsx)(xe,{open:!!a,close:function(){return c(null)},title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:(0,b.jsx)(Ue,{ticket:a,event:o.data})})]})]})}function Pe(){var e,n=h();function t(e,t,s){var a;return(0,b.jsx)(r.AW,{path:t,element:null!==(a=n.data)&&void 0!==a&&a.auth?null==e||x(n,e)?s:(0,b.jsx)(R,{}):(0,b.jsx)(r.Fg,{to:"/auth"})})}return(0,b.jsxs)("div",{className:"root",children:[(0,b.jsx)(_,{}),n.isLoading&&(0,b.jsx)(j.Z,{}),n.isError&&"\u041e\u0448\u0438\u0431\u043a\u0430",n.isSuccess&&(0,b.jsxs)(r.Z5,{children:[(0,b.jsx)(r.AW,{path:"/auth",element:null!==(e=n.data)&&void 0!==e&&e.auth?(0,b.jsx)(r.Fg,{to:"/"}):(0,b.jsx)(K,{})}),(0,b.jsx)(r.AW,{path:"/scanner/:eventId",element:(0,b.jsx)(be,{})}),t(null,"/",(0,b.jsx)(X,{})),t("page_events","/events",(0,b.jsx)(ke,{})),t("page_events","/events/:eventId",(0,b.jsx)(De,{})),t("page_events","/events/:eventId/tickets",(0,b.jsx)(Qe,{})),t("page_staff","/staff",(0,b.jsx)(Ne,{})),t(null,"*",(0,b.jsx)(P,{}))]})]})}}}]);
//# sourceMappingURL=422.9b49a967.chunk.js.map