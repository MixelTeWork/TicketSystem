"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[758],{5835:function(e,t,n){n.r(t),n.d(t,{default:function(){return Jt}});var r=n(7689),s=n(4165),i=n(1413),a=n(5861),c=n(1933),u=n(3144),o=n(5671),l=n(136),d=n(516),f=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,u.Z)(n)}((0,n(8737).Z)(Error));function h(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:void 0===t?null:JSON.stringify(t)})}function v(){return(0,c.useQuery)("user",x)}function x(){return p.apply(this,arguments)}function p(){return(p=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,401!=t.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",role:"",name:"",operations:[]});case 8:if(t.ok){e.next=10;break}throw new f(n.msg);case 10:return(r=n).auth=!0,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return m.apply(this,arguments)}function m(){return(m=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/users");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new f(n.msg);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/user/change_password",t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return y.apply(this,arguments)}function y(){return(y=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/user/change_name",t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){var n,r;return!(null===(n=e.data)||void 0===n||!n.auth||null===(r=e.data)||void 0===r||!r.operations.includes(t))}function Z(e){var t,n,r=v();return!(null===(t=r.data)||void 0===t||!t.auth||null===(n=r.data)||void 0===n||!n.operations.includes(e))}var w=n(5086),N=n(2791);function S(){var e=(0,r.TH)().pathname;return(0,N.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var A={root:"styles_root__4DGhY"},C=n(184);function I(){var e=(0,r.s0)();return(0,C.jsx)("div",{className:A.root,children:(0,C.jsx)("button",{onClick:function(){return e(-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}function Q(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return!!e})).join(" ")}var L=n(9439),D=n(1087),F={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",menu:"styles_menu__WWgPh",menuVisible:"styles_menuVisible__mMGZn"},E="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";function M(e){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/auth",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return(i=r).auth=!0,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/logout");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function O(e){var t=e.color,n=e.zIndex;return(0,C.jsx)("div",{className:P.root,children:(0,C.jsxs)("div",{className:P.spinner,style:{"--color":t,zIndex:n},children:[(0,C.jsx)("div",{}),(0,C.jsx)("div",{}),(0,C.jsx)("div",{}),(0,C.jsx)("div",{})]})})}function z(e){var t,n=e.backLink,s=(0,N.useState)(!1),i=(0,L.Z)(s,2),a=i[0],u=i[1],o=(0,r.TH)(),l=(0,r.s0)(),d=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:U,onSuccess:function(){e.invalidateQueries("user")}})}(),f=v();return(0,C.jsxs)("div",{className:F.root,children:[(0,C.jsxs)("span",{className:F.block,children:[(0,C.jsx)(D.rU,{to:"/",className:F.home,children:(0,C.jsx)("img",{src:E,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),n&&(0,C.jsx)(D.rU,{to:n,children:(0,C.jsx)("button",{className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})}),"/"!=o.pathname&&!n&&(0,C.jsx)("button",{onClick:function(){return l(n||-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,C.jsxs)("span",{className:F.block,children:[(0,C.jsx)("button",{onClick:function(){return u((function(e){return!e}))},className:"button button_light",children:(0,C.jsx)("span",{children:null===(t=f.data)||void 0===t?void 0:t.name})}),(0,C.jsxs)("div",{className:Q(F.menu,a&&F.menuVisible),children:[(0,C.jsx)("button",{onClick:function(){return l("/profile")},className:"button button_light",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,C.jsx)("button",{onClick:function(){return d.mutate()},disabled:"idle"!=d.status,className:"button button_light",children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"idle"!=d.status&&(0,C.jsx)(O,{})]})}var q={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function B(e){var t=e.children,n=e.className,r=e.backLink,s=e.centered,i=void 0!==s&&s,a=e.centeredPage,c=void 0!==a&&a,u=e.height100,o=void 0!==u&&u,l=e.gap,d=void 0===l?0:l,f=e.header;return void 0===f&&(f=(0,C.jsx)(z,{backLink:r})),(0,C.jsxs)("div",{className:q.root,style:{maxHeight:o?"100dvh":""},children:[f||(0,C.jsx)("div",{}),(0,C.jsx)("div",{className:Q(q.body,n,i&&q.body_centered,c&&q.body_centeredPage),style:{gap:d,maxHeight:o?"100%":""},children:t})]})}function V(){return(0,C.jsx)(B,{centered:!0,header:(0,C.jsx)(I,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function W(){return(0,C.jsx)(B,{centered:!0,header:(0,C.jsx)(I,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var Y={form:"styles_form__n7Rcu"},J=n(3433);function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,N.useEffect)((function(){var n=document.title,r="object"!=typeof e?[e]:e;return document.title=[t].concat((0,J.Z)(r)).filter((function(e){return!!e})).join(" | "),function(){document.title=n}}),[e,t])}var K={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function H(e){var t=e.className,n=e.style,r=e.onSubmit,s=e.children;return(0,C.jsx)("form",{className:Q(K.form,t),style:n,onSubmit:function(e){e.preventDefault(),r()},children:s})}function X(e){var t=e.label,n=e.className,r=e.style,s=e.children;return(0,C.jsxs)("label",{className:Q(K.field,n),style:r,children:[(0,C.jsx)("span",{children:t}),s]})}function $(){G("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,N.useState)(""),t=(0,L.Z)(e,2),n=t[0],r=t[1],s=(0,N.useRef)(null),i=(0,N.useRef)(null),a=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:M,onSuccess:function(e){t.setQueryData("user",(function(){return e}))},onError:function(t){null===e||void 0===e||e(t instanceof f?t.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(r);return(0,C.jsxs)(B,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,C.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),n&&(0,C.jsx)("h3",{children:n}),a.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{className:Y.form,onSubmit:function(){var e,t,n=(null===(e=s.current)||void 0===e?void 0:e.value)||"",r=(null===(t=i.current)||void 0===t?void 0:t.value)||"";a.mutate({login:n,password:r})},children:[(0,C.jsx)(X,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,C.jsx)("input",{ref:s,type:"text",name:"login",required:!0})}),(0,C.jsx)(X,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,C.jsx)("input",{ref:i,type:"password",name:"password",required:!0})}),(0,C.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==a.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,C.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function ee(){var e=v();return(0,C.jsxs)(B,{centered:!0,gap:"1em",children:[k(e,"page_events")&&(0,C.jsx)(D.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),k(e,"page_staff")&&(0,C.jsx)(D.rU,{to:"/staff",className:"button button_large",children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),k(e,"page_debug")&&(0,C.jsx)(D.rU,{to:"/debug",className:"button button_large",children:"</>"})]})}var te={scanner:"styles_scanner__+xzXT",scannerRect:"styles_scannerRect__zwl3N",scannerVideo:"styles_scannerVideo__ZCceC",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO",alreadyScanned:"styles_alreadyScanned__OI-PM",alreadyScanned_visible:"styles_alreadyScanned_visible__keU3C"},ne={root:"styles_root__QdJnV"},re=n(1096);function se(e){var t=e.active,n=void 0===t||t,r=e.className,s=e.onScan,i=e.onCameraError,a=(0,N.useState)(),c=(0,L.Z)(a,2),u=c[0],o=c[1],l=(0,N.useRef)(null);return(0,N.useEffect)((function(){if(l.current){var e=new re.Z(l.current,(function(e){return s(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return o((function(t){return null===t||void 0===t||t.stop(),null===t||void 0===t||t.destroy(),e})),e.start().catch((function(){return i()})),function(){e.stop(),e.destroy()}}}),[l,s]),(0,N.useEffect)((function(){u&&(n?u.start().catch((function(){return i()})):u.pause(!1))}),[n,u]),(0,C.jsx)("video",{className:Q(ne.root,r),ref:l})}function ie(e,t){return"".concat(e).padStart(t,"0")}function ae(e,t,n,r){var s="".concat(e);return"1"==s.at(-1)&&"1"!=s.at(-2)?t:["2","3","4"].includes(s.at(-1)||"")&&"1"!=s.at(-2)?n:r}function ce(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"".concat(e.getFullYear(),".").concat(ie(e.getMonth()+1,2),".").concat(ie(e.getDate(),2)):"".concat(ie(e.getDate(),2),".").concat(ie(e.getMonth()+1,2),".").concat(e.getFullYear()):""}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="".concat(ie(e.getHours(),2),":").concat(ie(e.getMinutes(),2));return t?n+":".concat(ie(e.getSeconds(),2)):n}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ce(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+ue(e,t)}function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",n=new Date,r=e.getTime()-n.getTime(),s=Math.floor(Math.abs(r)/1e3),i=Math.floor(s/31104e3);s-=60*i*60*24*30*12;var a=Math.floor(s/2592e3);s-=60*a*60*24*30;var c=Math.floor(s/86400);s-=60*c*60*24;var u=Math.floor(s/3600)%24;s-=60*u*60;var o=Math.floor(s/60)%60,l=(s-=60*o)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=i?[i,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=a?[a,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=c?[c,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==t?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=u?[u,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=o?[o,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),f=(0,L.Z)(d,2),h=f[0],v=f[1];if("string"==typeof h)return h;var x="".concat(ae.apply(void 0,[h].concat((0,J.Z)(v))));return Math.abs(h)>1&&(x=Math.abs(h)+" "+x),r>0?x="\u0427\u0435\u0440\u0435\u0437 "+x:x+=" \u043d\u0430\u0437\u0430\u0434",x}var de={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function fe(e){var t=e.event,n=e.onInputBtn;return(0,C.jsxs)("div",{className:de.root,children:[(0,C.jsx)("div",{className:de.top,children:(0,C.jsx)("button",{onClick:n,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,C.jsxs)("div",{className:de.bottom,children:[(0,C.jsx)("span",{children:t.name}),(0,C.jsx)("span",{children:"|"}),(0,C.jsx)("span",{children:ce(t.date)})]})]})}function he(e){return fetch(e,{method:"DELETE"})}function ve(){return xe.apply(this,arguments)}function xe(){return(xe=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new f(n.msg);case 8:return r=n,e.abrupt("return",r.map(ge));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return je.apply(this,arguments)}(e)}))}function je(){return(je=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",ge(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return be.apply(this,arguments)}(e)}),{retry:3})}function be(){return(be=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/scanner_event/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}return e.abrupt("return",NaN);case 8:return e.abrupt("return",ge(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e){var t=e;return t.date=new Date(e.date),t}function _e(e){return ye.apply(this,arguments)}function ye(){return(ye=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/event",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",ge(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return Ze.apply(this,arguments)}(e,t)},onSuccess:function(e){var r;n.setQueryData(["event","".concat(e.id)],(function(){return e})),"success"==(null===(r=n.getQueryState("events"))||void 0===r?void 0:r.status)&&n.setQueryData("events",(function(t){return t?[].concat((0,J.Z)(t.filter((function(t){return t.id!=e.id}))),[e]):[e]})),null===t||void 0===t||t()}});return r}function Ze(){return(Ze=(0,a.Z)((0,s.Z)().mark((function e(t,n){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/event/"+t,n);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new f(i.msg);case 8:return e.abrupt("return",ge(i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return Ne.apply(this,arguments)}(e)},onSuccess:function(){var r;n.removeQueries(["event","".concat(e)],{exact:!0}),"success"==(null===(r=n.getQueryState("events"))||void 0===r?void 0:r.status)&&n.setQueryData("events",(function(t){return t?t.filter((function(t){return t.id!=e})):[]})),null===t||void 0===t||t()}});return r}function Ne(){return(Ne=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he("/api/event/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function Ae(e){var t=e.children,n=e.open,r=void 0!==n&&n,s=e.close,i=e.title,a=void 0===i?"":i;return(0,C.jsx)("div",{className:Q(Se.root,r&&Se.open),children:(0,C.jsxs)("div",{className:Se.popup,children:[(a||s)&&(0,C.jsxs)("div",{className:Se.header,children:[(0,C.jsx)("h3",{children:a}),s&&(0,C.jsx)("button",{className:Se.close,onClick:s,children:"\u2716"})]}),(0,C.jsx)("div",{className:Se.body,children:t})]})})}function Ce(e){return(0,c.useQuery)(["tickets",e],(function(){return function(e){return Ie.apply(this,arguments)}(e)}))}function Ie(){return(Ie=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r.map(Qe));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qe(e){var t=e;return e.scannedDate&&(t.scannedDate=new Date(e.scannedDate)),e.createdDate&&(t.createdDate=new Date(e.createdDate)),t}function Le(e){return De.apply(this,arguments)}function De(){return(De=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/ticket",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",Qe(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/ticket/"+t.ticketId,t.data);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",Qe(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Te,onSuccess:function(r){var s;"success"==(null===(s=n.getQueryState(["tickets","".concat(e)]))||void 0===s?void 0:s.status)&&n.setQueryData(["tickets","".concat(e)],(function(e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!=r})))||[]})),null===t||void 0===t||t()}})}function Te(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he("/api/ticket/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/check_ticket",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return a=r,(i=r).ticket&&(a.ticket=Qe(i.ticket)),i.event&&(a.event=ge(i.event)),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){var t=(0,N.useState)((function(){var t=new Audio(e);return t.preload="auto",t})),n=(0,L.Z)(t,1)[0];return[function(){n.currentTime=0,n.play()}]}var ze=n.p+"static/media/beep.38f199e084efe5461ffd.mp3",qe=n.p+"static/media/beepError.7eccfa35a3dd6b6ea311.mp3";function Be(e,t){return"".concat(ie(e,3),"-").concat(t.getFullYear().toString().at(-1)).concat(ie(t.getMonth()+1,2)).concat(ie(t.getDate(),2),"-")}function Ve(){G("\u0421\u043a\u0430\u043d\u0435\u0440");var e,t=(0,r.UO)(),n=(0,N.useState)(null),s=(0,L.Z)(n,2),i=s[0],a=s[1],u=(0,N.useState)(null),o=(0,L.Z)(u,2),l=o[0],d=o[1],h=(0,N.useState)(null),v=(0,L.Z)(h,2),x=v[0],p=v[1],j=(0,N.useState)(null),m=(0,L.Z)(j,2),b=m[0],g=m[1],_=(0,N.useState)(!0),y=(0,L.Z)(_,2),k=y[0],Z=y[1],w=(0,N.useState)(!1),S=(0,L.Z)(w,2),A=S[0],I=S[1],D=(0,N.useState)(!1),F=(0,L.Z)(D,2),E=F[0],M=F[1],T=(0,N.useState)(!1),U=(0,L.Z)(T,2),R=U[0],P=U[1],z=(0,N.useRef)(null),q=me(t.eventId),V=Oe(ze),W=(0,L.Z)(V,1)[0],Y=Oe(qe),J=(0,L.Z)(Y,1)[0],K=(0,N.useCallback)((function(e){return a(e)}),[]),H=(0,N.useCallback)((function(){I(!0),z.current&&q.data&&"number"!=typeof q.data&&(setTimeout((function(){z.current&&z.current.focus()}),50),z.current.value=Be(q.data.id,q.data.date))}),[z,q.data]),X=(0,N.useCallback)((function(){return I(!1)}),[]),$=function(e,t){var n=(0,c.useMutation)({mutationFn:Re,onSuccess:function(t){null===e||void 0===e||e(t)},onError:function(e){null===t||void 0===t||t(e instanceof f?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),n.reset()}});return n}((function(e){g(e),e.success||J()}),(function(e){g(null),p(e)}));return(0,N.useEffect)((function(){if(i&&q.data&&"idle"==$.status&&"number"!=typeof q.data){if(W(),l==i&&!x)return a(null),void M(!0);a(null),M(!1),d(i),p(null),g(null),$.mutate({code:i,eventId:q.data.id})}}),[i,q.data,$.status]),(0,N.useEffect)((function(){if($.isSuccess){var e=setTimeout((function(){a(null),$.reset()}),1e3);return function(){return clearTimeout(e)}}}),[$.isSuccess]),(0,N.useEffect)((function(){if(E){var e=setTimeout((function(){return M(!1)}),500);return function(){return clearTimeout(e)}}}),[E]),(0,C.jsxs)(C.Fragment,{children:[q.isLoading&&(0,C.jsx)(O,{}),q.error&&(0,C.jsx)(B,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof q.data&&(0,C.jsxs)(B,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,C.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,C.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof q.data&&q.data&&(0,C.jsxs)(B,{height100:!0,header:(0,C.jsx)(fe,{event:q.data,onInputBtn:H}),children:[(0,C.jsx)("div",{className:Q(te.scanner,!$.isIdle&&te.scanner_scanned),children:(0,C.jsx)("div",{className:te.scannerRect,children:(0,C.jsx)(se,{onScan:K,onCameraError:function(){return P(!0)},className:te.scannerVideo})})}),(0,C.jsxs)("div",{className:te.scanResult,children:[(0,C.jsx)("div",{className:Q(te.alreadyScanned,E&&te.alreadyScanned_visible),children:"\u0422\u043e\u0442 \u0436\u0435 \u0431\u0438\u043b\u0435\u0442"}),l&&(0,C.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",l]}),x&&(0,C.jsx)("div",{children:x}),(null===b||void 0===b?void 0:b.success)&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:Q(te.success,te.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,C.jsxs)("div",{className:te.result_desc,children:[(0,C.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",b.ticket.personName]}),(0,C.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",b.ticket.type]}),(0,C.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",b.ticket.promocode]})]})]}),"notExist"==(null===b||void 0===b?void 0:b.errorCode)&&(0,C.jsx)("div",{className:Q(te.error,te.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===b||void 0===b?void 0:b.errorCode)&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:Q(te.error,te.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,C.jsxs)("div",{className:te.result_desc,children:[(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",b.event.name]}),(0,C.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",ce(b.event.date)," (",le(b.event.date,"day"),")"]})]}),(0,C.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",b.ticket.personName]})]})]}),"scanned"==(null===b||void 0===b?void 0:b.errorCode)&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:Q(te.error,te.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,C.jsxs)("div",{className:te.result_desc,children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,C.jsxs)("span",{children:[ue(b.ticket.scannedDate,!0)," "]}),(0,C.jsxs)("span",{className:Q((e=b.ticket.scannedDate,((new Date).getTime()-e.getTime())/1e3>30&&te.error)),children:["(",le(b.ticket.scannedDate),")"]})]}),(0,C.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",b.ticket.personName]}),(0,C.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",b.ticket.type]}),(0,C.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",b.ticket.promocode]})]})]})]}),(0,C.jsxs)(Ae,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:A,close:X,children:[(0,C.jsx)("input",{type:"text",ref:z}),(0,C.jsx)("button",{disabled:"idle"!=$.status,onClick:function(){var e;z.current&&a(null===(e=z.current)||void 0===e?void 0:e.value),X()},children:"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c"})]}),(0,C.jsxs)(Ae,{open:R,children:[(0,C.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,C.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,C.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]}),(0,C.jsxs)(Ae,{title:"\u0421\u043a\u0430\u043d\u0435\u0440 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",open:k,close:function(){return Z(!1)},children:[(0,C.jsx)("h2",{children:q.data.name}),(0,C.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u0430 \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443 \u043d\u0430 QR \u043a\u043e\u0434 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u043b\u0441\u044f \u0432 \u043c\u0438\u0433\u0430\u044e\u0449\u0443\u044e \u0440\u0430\u043c\u043a\u0443."}),(0,C.jsxs)("p",{children:[(0,C.jsx)("strong",{children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0437\u0432\u0443\u043a"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u043b\u044b\u0448\u0430\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u043b \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438."]})]})]})]})}var We={space_between:"styles_space_between__AD+M6"};function Ye(e,t){return e.isError?(t||Je)(e.error instanceof f?e.error.message:"\u041e\u0448\u0438\u0431\u043a\u0430"):null}function Je(e){return(0,C.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function Ge(e){var t=e.open,n=e.close,r=(0,N.useRef)(null),s=(0,N.useRef)(null),i=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:_e,onSuccess:function(n){var r;t.setQueryData(["event","".concat(n.id)],(function(){return n})),"success"==(null===(r=t.getQueryState("events"))||void 0===r?void 0:r.status)&&t.setQueryData("events",(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e()}})}(n);return(0,N.useEffect)((function(){!t&&r.current&&s.current&&(r.current.value="",s.current.value="")}),[t,r,s]),(0,N.useEffect)((function(){t||i.reset()}),[t]),(0,C.jsxs)(Ae,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Ye(i),(0,C.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=r.current)||void 0===e?void 0:e.value,a=null===(t=s.current)||void 0===t?void 0:t.value;n&&a&&i.mutate({date:a,name:n})},children:[(0,C.jsx)(X,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,C.jsx)("input",{ref:r,type:"text",required:!0})}),(0,C.jsx)(X,{label:"\u0414\u0430\u0442\u0430",children:(0,C.jsx)("input",{ref:s,type:"datetime-local",required:!0})}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),i.isLoading&&(0,C.jsx)(O,{})]})}function Ke(){var e,t;G("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var n=(0,N.useState)(!1),r=(0,L.Z)(n,2),s=r[0],i=r[1],a=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",ve,{onSuccess:function(t){t.forEach((function(t){return e.setQueryData(["event","".concat(t.id)],t)}))}})}();return(0,C.jsxs)(B,{backLink:"/",centeredPage:!0,gap:"1rem",children:[(0,C.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),a.isLoading&&(0,C.jsx)(O,{}),Ye(a),null===(e=a.data)||void 0===e||null===(t=e.sort((function(e,t){return e.date<t.date?1:-1})))||void 0===t?void 0:t.map((function(e){return(0,C.jsxs)(D.rU,{to:"/events/".concat(e.id),className:Q("button button_large",We.space_between),children:[(0,C.jsx)("span",{children:e.name}),(0,C.jsx)("span",{children:ce(e.date)})]},e.id)})),Z("add_event")&&(0,C.jsxs)("div",{className:We.space_between,children:[(0,C.jsx)("span",{}),(0,C.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,C.jsx)(Ge,{open:s,close:function(){return i(!1)}})]})}function He(){return(0,c.useQuery)("staff",Xe)}function Xe(){return $e.apply(this,arguments)}function $e(){return($e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/staff");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new f(n.msg);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e){return(0,c.useQuery)(["staff","".concat(e)],(function(){return function(e){return tt.apply(this,arguments)}(e)}))}function tt(){return(tt=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/event/staff/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return rt.apply(this,arguments)}(e,t)},onSuccess:function(r){var s;"success"==(null===(s=n.getQueryState(["staff","".concat(e)]))||void 0===s?void 0:s.status)&&n.setQueryData(["staff","".concat(e)],r),null===t||void 0===t||t()}});return r}function rt(){return(rt=(0,a.Z)((0,s.Z)().mark((function e(t,n){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/event/staff/"+t,n);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new f(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return(it=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/staff",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:if(!r.exist){e.next=10;break}throw new f(r.msg);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return ct.apply(this,arguments)}(e)},onSuccess:function(){var r;"success"==(null===(r=n.getQueryState("staff"))||void 0===r?void 0:r.status)&&n.setQueryData("staff",(function(t){return t?t.filter((function(t){return t.id!=e})):[]})),null===t||void 0===t||t()}});return r}function ct(){return(ct=(0,a.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he("/api/staff/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=f,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(){return function(e){return ot.apply(this,arguments)}(e)},onSuccess:function(r){var s;"success"==(null===(s=n.getQueryState("staff"))||void 0===s?void 0:s.status)&&n.setQueryData("staff",(function(t){return t?t.map((function(t){return t.id!=e?t:r})):[]})),null===t||void 0===t||t(r)}});return r}function ot(){return(ot=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/staff/reset_password/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var lt={user:"styles_user__JQBf0",title:"styles_title__OlEMb",space_between:"styles_space_between__Z0Ibu",toggle:"styles_toggle__wBqj6",toggleInp:"styles_toggleInp__Tox8V",userInfo:"styles_userInfo__Pveb6"};function dt(e){var t=e.open,n=e.close,r=(0,N.useState)(null),s=(0,L.Z)(r,2),i=s[0],a=s[1],u=(0,N.useRef)(null),o=(0,N.useRef)(null),l=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:st,onSuccess:function(n){var r;"success"==(null===(r=t.getQueryState("staff"))||void 0===r?void 0:r.status)&&t.setQueryData("staff",(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e(n)}})}((function(e){a(e),null===n||void 0===n||n()}));return(0,N.useEffect)((function(){!t&&u.current&&o.current&&(l.reset(),u.current.value="",o.current.value="")}),[t,u,o]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(Ae,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[Ye(l),(0,C.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=u.current)||void 0===e?void 0:e.value,r=null===(t=o.current)||void 0===t?void 0:t.value;n&&r&&l.mutate({name:n,login:r})},children:[(0,C.jsx)(X,{label:"\u0418\u043c\u044f",children:(0,C.jsx)("input",{ref:u,type:"text",required:!0})}),(0,C.jsx)(X,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,C.jsx)("input",{ref:o,placeholder:"\u0410\u043d\u0433\u043b. \u0431\u0443\u043a\u0432\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 _",type:"text",required:!0,onInput:function(e){o.current&&(o.current.value=o.current.value.replaceAll(/[^a-z_\d]/g,""))}})}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),l.isLoading&&(0,C.jsx)(O,{})]}),(0,C.jsxs)(Ae,{open:!!i,close:function(){return a(null)},title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[(0,C.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",null===i||void 0===i?void 0:i.login]}),(0,C.jsxs)("div",{children:["\u041f\u0430\u0440\u043e\u043b\u044c: ",null===i||void 0===i?void 0:i.password]}),(0,C.jsx)("h4",{style:{marginTop:8},children:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e"})]})]})}function ft(e){var t=e.title,n=e.mutationFn,r=e.mutatateParams,s=e.itemId,i=e.onSuccess,a=e.open,c=e.close,u=n(s,(function(e){null===c||void 0===c||c(),null===i||void 0===i||i(e)}));return(0,N.useEffect)((function(){a||u.reset()}),[a]),(0,C.jsxs)(Ae,{open:a,close:c,title:t,children:[Ye(u),u.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){u.mutate(r)},children:[(0,C.jsx)("h1",{children:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function ht(){var e,t;G("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438");var n=(0,N.useState)(!1),r=(0,L.Z)(n,2),s=r[0],i=r[1],a=(0,N.useState)(-1),c=(0,L.Z)(a,2),u=c[0],o=c[1],l=(0,N.useState)(-1),d=(0,L.Z)(l,2),f=d[0],h=d[1],v=He();return(0,C.jsxs)(B,{centeredPage:!0,gap:8,children:[(0,C.jsx)("h1",{children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),0==(null===(e=v.data)||void 0===e?void 0:e.length)&&(0,C.jsx)("h2",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"}),null===(t=v.data)||void 0===t?void 0:t.map((function(e){return(0,C.jsxs)("div",{className:lt.user,children:[(0,C.jsx)("input",{type:"checkbox",className:lt.toggleInp,id:"user".concat(e.id)}),(0,C.jsxs)("label",{className:lt.title,htmlFor:"user".concat(e.id),children:[(0,C.jsx)("div",{children:e.name}),(0,C.jsxs)("div",{children:[(0,C.jsx)("span",{children:e.role}),(0,C.jsx)("div",{className:lt.toggle})]})]}),(0,C.jsxs)("div",{className:lt.userInfo,children:[(0,C.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",e.login]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("span",{children:"\u041f\u0430\u0440\u043e\u043b\u044c: "}),e.password||(0,C.jsx)("button",{className:"button button_light button_small",onClick:function(){return h(e.id)},children:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})]}),(0,C.jsxs)("div",{className:lt.space_between,children:[(0,C.jsx)("span",{}),(0,C.jsx)("button",{className:"button button_danger button_small",onClick:function(){return o(e.id)},children:"\u0423\u0432\u043e\u043b\u0438\u0442\u044c"})]})]})]},e.id)})),Z("add_staff")&&(0,C.jsxs)("div",{className:lt.space_between,children:[(0,C.jsx)("span",{}),(0,C.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,C.jsx)(dt,{open:s,close:function(){return i(!1)}}),(0,C.jsx)(ft,{itemId:u,title:"\u0423\u0432\u043e\u043b\u044c\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:at,open:u>=0,close:function(){return o(-1)}}),(0,C.jsx)(ft,{itemId:f,title:"\u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:ut,open:f>=0,close:function(){return h(-1)}})]})}var vt={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89",line:"styles_line__4myXW"};function xt(e){return(0,c.useQuery)(["ticket_types",e],(function(){return function(e){return pt.apply(this,arguments)}(e)}))}function pt(){return(pt=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_types/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.ok){e.next=8;break}throw new f(r.msg);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jt(e,t){var n=(0,c.useQueryClient)(),r=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return mt.apply(this,arguments)}(e,t)},onSuccess:function(r,s){s.some((function(e){return"delete"==e.action||"update"==e.action}))?n.invalidateQueries(["tickets","".concat(e)],{exact:!0}):n.setQueryData(["ticket_types","".concat(e)],(function(){return r})),null===t||void 0===t||t(r)}});return r}function mt(){return(mt=(0,a.Z)((0,s.Z)().mark((function e(t,n){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/api/ticket_types/"+t,n);case 2:return r=e.sent,e.next=5,r.json();case 5:if(i=e.sent,r.ok){e.next=8;break}throw new f(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e){var t,n,r,s=e.open,i=e.eventId,a=e.close,u=e.setTicet,o=(0,N.useState)(-1),l=(0,L.Z)(o,2),d=l[0],f=l[1],h=(0,N.useState)(""),v=(0,L.Z)(h,2),x=v[0],p=v[1],j=(0,N.useState)(""),m=(0,L.Z)(j,2),b=m[0],g=m[1],_=(0,N.useState)(""),y=(0,L.Z)(_,2),k=y[0],Z=y[1],w=(0,N.useState)(""),S=(0,L.Z)(w,2),A=S[0],I=S[1],Q=(0,N.useState)(!0),D=(0,L.Z)(Q,2),F=D[0],E=D[1],M=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Le,onSuccess:function(n){var r;"success"==(null===(r=t.getQueryState(["tickets","".concat(n.eventId)]))||void 0===r?void 0:r.status)&&t.setQueryData(["tickets","".concat(n.eventId)],(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e(n)}})}((function(e){u(e),null===a||void 0===a||a()})),T=xt(i);return(0,N.useEffect)((function(){s||(E(!0),f(-1),p(""),g(""),Z(""),I(""),M.reset())}),[s]),(0,C.jsxs)(Ae,{open:s,close:a,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[Ye(M),T.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){d>=0&&x&&M.mutate({eventId:parseInt("".concat(i),10),typeId:d,personName:x,personLink:b,promocode:k,code:F?"":A})},children:[(0,C.jsxs)(X,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,C.jsx)("select",{value:d,onChange:function(e){var t;return f((null===(t=T.data)||void 0===t?void 0:t[e.target.selectedIndex].id)||-1)},disabled:0==(null===(t=T.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=T.data)||void 0===n?void 0:n.map((function(e){return(0,C.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(r=T.data)||void 0===r?void 0:r.length)&&(0,C.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,C.jsx)(X,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,C.jsx)("input",{value:x,onChange:function(e){return p(e.target.value)},type:"text",required:!0})}),(0,C.jsx)(X,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,C.jsx)("input",{value:b,onChange:function(e){return g(e.target.value)},type:"text"})}),(0,C.jsx)(X,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,C.jsx)("input",{value:k,onChange:function(e){return Z(e.target.value)},type:"text"})}),(0,C.jsxs)("label",{children:[(0,C.jsx)("input",{type:"checkbox",checked:F,onChange:function(e){return E(e.target.checked)}}),(0,C.jsx)("span",{style:{color:F?"darkgreen":"darkred"},children:"\u0410\u0432\u0442\u043e-\u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430"})]}),!F&&(0,C.jsxs)(X,{label:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430 (\u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434)",children:[(0,C.jsx)("div",{style:{color:"darkred",fontSize:"0.9rem"},children:"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438!"}),(0,C.jsx)("input",{value:A,onChange:function(e){return I(e.target.value)},type:"text"})]}),(0,C.jsx)("button",{type:"submit",className:"button button_small",disabled:!T.data||0==T.data.length,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),M.isLoading&&(0,C.jsx)(O,{})]})}var gt={root:"styles_root__Lo44K",visible:"styles_visible__icoL+",center:"styles_center__w1Z-q"},_t=n(741),yt=n(5498),kt=n.n(yt);function Zt(e){var t=e.event,n=e.ticket,r=e.setTicket,s=(0,N.useState)(null),i=(0,L.Z)(s,2),a=i[0],c=i[1],u=(0,N.useState)(""),o=(0,L.Z)(u,2),l=o[0],d=o[1],f=(0,N.useRef)(null);return(0,N.useEffect)((function(){n&&(c(null),d(""),_t.toDataURL(n.code,{errorCorrectionLevel:"H",scale:8},(function(e,t){return d(t)})))}),[n]),(0,N.useEffect)((function(){if(l&&f.current){var e=setTimeout((function(){l&&f.current&&kt()(f.current).then((function(e){return c(e)}))}),10);return function(){return clearTimeout(e)}}}),[l,f]),(0,C.jsxs)(Ae,{open:!!n,close:function(){return r(null)},title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,C.jsxs)("div",{ref:f,className:Q(gt.root,!a&&gt.visible),children:[(0,C.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442"}),(0,C.jsx)("div",{className:gt.center,style:{marginTop:"1rem"},children:(0,C.jsx)("img",{src:l,alt:null===n||void 0===n?void 0:n.code})}),(0,C.jsx)("div",{className:gt.center,style:{marginBottom:"1rem"},children:null===n||void 0===n?void 0:n.code}),(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",null===t||void 0===t?void 0:t.name]}),(0,C.jsxs)("div",{children:["\u0414\u0430\u0442\u0430: ",ce(null===t||void 0===t?void 0:t.date)]}),(0,C.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",null===n||void 0===n?void 0:n.type]}),(0,C.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",null===n||void 0===n?void 0:n.personName]})]})]}),a&&(0,C.jsx)("div",{ref:function(e){e&&(e.innerHTML="",e.appendChild(a))}}),a&&(0,C.jsx)("div",{className:gt.center,children:"\u042d\u0442\u043e \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430, \u043c\u043e\u0436\u043d\u043e \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})]})}function wt(e){var t,n,r=e.eventId,s=e.open,i=e.close,a=(0,N.useState)(0),c=(0,L.Z)(a,2)[1],u=(0,N.useState)(new Map),o=(0,L.Z)(u,2),l=o[0],d=o[1],f=(0,N.useState)([]),h=(0,L.Z)(f,2),v=h[0],x=h[1],p=xt(r),j=jt(r,i);return(0,N.useEffect)((function(){d(new Map),x([]),c(0),s||j.reset()}),[s]),(0,C.jsxs)(Ae,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0438\u0434\u043e\u0432 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",children:[Ye(j),p.isLoading&&(0,C.jsx)(O,{}),j.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){(l.size>0||v.length>0)&&j.mutate([].concat((0,J.Z)(v.filter((function(e){return"add"==e.action}))),(0,J.Z)(Array.from(l.values()))))},children:[null===(t=p.data)||void 0===t||null===(n=t.filter((function(e){var t;return"delete"!=(null===(t=l.get(e.id))||void 0===t?void 0:t.action)})))||void 0===n?void 0:n.map((function(e){var t;return(0,C.jsxs)(X,{children:[(0,C.jsx)("input",{type:"text",required:!0,value:(null===(t=l.get(e.id))||void 0===t?void 0:t.name)||e.name,onChange:function(t){l.set(e.id,{id:e.id,name:t.target.value,action:"update"}),c((function(e){return e+1}))}}),(0,C.jsx)("button",{type:"button",className:"button button_small",onClick:function(){l.set(e.id,{id:e.id,name:"",action:"delete"}),c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},e.id)})),v.filter((function(e){return"add"==e.action})).map((function(e,t){return(0,C.jsxs)(X,{children:[(0,C.jsx)("input",{type:"text",required:!0,onChange:function(e){v[t].name=e.target.value,c((function(e){return e+1}))}}),(0,C.jsx)("button",{type:"button",className:"button button_small",onClick:function(){v[t].action="delete",c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},"new"+t)})),(0,C.jsx)("button",{type:"button",className:"button button_small",onClick:function(){v.push({name:"",action:"add"}),c((function(e){return e+1}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Nt(e){var t,n,r=e.eventId,s=e.open,i=e.close,a=(0,N.useRef)(null),c=(0,N.useRef)(null),u=ke(r,i),o=pe(r);return(0,N.useEffect)((function(){s||u.reset()}),[s]),(0,C.jsxs)(Ae,{open:s,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Ye(u),o.isLoading&&(0,C.jsx)(O,{}),u.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=a.current)||void 0===e?void 0:e.value,r=null===(t=c.current)||void 0===t?void 0:t.value;n&&r&&u.mutate({date:r,name:n})},children:[(0,C.jsx)(X,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,C.jsx)("input",{ref:a,type:"text",required:!0,defaultValue:null===(t=o.data)||void 0===t?void 0:t.name})}),(0,C.jsx)(X,{label:"\u0414\u0430\u0442\u0430",children:(0,C.jsx)("input",{ref:c,type:"datetime-local",required:!0,defaultValue:null===(n=o.data)||void 0===n?void 0:n.date.toISOString().slice(0,-5)})}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function St(e){var t,n,r,s=e.eventId,i=e.open,a=e.close,c=et(s),u=He(),o=(0,N.useState)([]),l=(0,L.Z)(o,2),d=l[0],f=l[1],h=(0,N.useState)(-1),v=(0,L.Z)(h,2),x=v[0],p=v[1],j=nt(s,a);return(0,N.useEffect)((function(){c.isSuccess&&f(c.data.map((function(e){return e.id})))}),[c.isSuccess,c.data]),(0,N.useEffect)((function(){i&&c.isSuccess&&f(c.data.map((function(e){return e.id}))),i&&p(-1),i||j.reset()}),[i,c.isSuccess,c.data]),(0,C.jsxs)(Ae,{open:i,close:a,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a\u043b\u0435\u0440\u043a\u043e\u0432",children:[Ye(c),Ye(u),Ye(j),c.isLoading&&(0,C.jsx)(O,{}),u.isLoading&&(0,C.jsx)(O,{}),j.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){j.mutate(d)},children:[d.map((function(e){var t,n=null===(t=u.data)||void 0===t?void 0:t.find((function(t){return t.id==e}));return(0,C.jsxs)(X,{children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("span",{children:null===n||void 0===n?void 0:n.name}),(0,C.jsxs)("span",{style:{marginLeft:"1em",color:"gray"},children:["(",null===n||void 0===n?void 0:n.login,")"]})]}),(0,C.jsx)("button",{type:"button",className:"button button_small",onClick:function(){f((function(t){return t.filter((function(t){return t!=e}))}))},children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"})]},e)})),(0,C.jsxs)("select",{onChange:function(e){return p(parseInt(e.target.value))},children:[(0,C.jsx)("option",{value:"-1",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043b\u0435\u0440\u043a\u0430"}),null===(t=u.data)||void 0===t?void 0:t.filter((function(e){return!d.includes(e.id)})).map((function(e){return(0,C.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),(0,C.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(n=u.data)||void 0===n?void 0:n.filter((function(e){return!d.includes(e.id)})).length),onClick:function(){x>=0&&(f((function(e){return[].concat((0,J.Z)(e),[x])})),p(-1))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"}),(0,C.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(r=u.data)||void 0===r?void 0:r.filter((function(e){return!d.includes(e.id)})).length),onClick:function(){f((function(e){var t;return(null===(t=u.data)||void 0===t?void 0:t.map((function(e){return e.id})))||e}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0441\u0435\u0445"}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function At(e){var t=e.code,n=e.setCode,r=e.title,s=(0,N.useState)(""),i=(0,L.Z)(s,2),a=i[0],c=i[1];return(0,N.useEffect)((function(){t&&(c(""),_t.toDataURL(t,{errorCorrectionLevel:"H",scale:10},(function(e,t){return c(t)})))}),[t]),(0,C.jsx)(Ae,{open:!!t,close:function(){return n("")},title:r,children:(0,C.jsx)("img",{src:a,alt:t,style:{width:"100%"}})})}function Ct(){var e,t,n,s=(0,N.useState)(!1),i=(0,L.Z)(s,2),a=i[0],c=i[1],u=(0,N.useState)(!1),o=(0,L.Z)(u,2),l=o[0],d=o[1],h=(0,N.useState)(!1),v=(0,L.Z)(h,2),x=v[0],p=v[1],j=(0,N.useState)(!1),m=(0,L.Z)(j,2),b=m[0],g=m[1],_=(0,N.useState)(!1),y=(0,L.Z)(_,2),k=y[0],w=y[1],S=(0,N.useState)(null),A=(0,L.Z)(S,2),I=A[0],Q=A[1],F=(0,N.useState)(""),E=(0,L.Z)(F,2),M=E[0],T=E[1],U=(0,r.s0)(),R=(0,r.UO)().eventId,P=pe(R),z=xt(R),q=et(R),V=Z("add_ticket"),W=Z("change_ticket_types"),Y=Z("change_event"),J=Z("get_staff_event"),K=Z("change_staff_event"),H=Z("delete_event");G((null===(e=P.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,N.useEffect)((function(){P.error instanceof f&&P.error.message.includes("not found")&&U("/not_found",{replace:!0})}),[P.error,U]);var X="/events";return(0,C.jsxs)(C.Fragment,{children:[P.isLoading&&(0,C.jsx)(B,{backLink:X,children:(0,C.jsx)(O,{})}),Ye(P,(function(e){return(0,C.jsx)(B,{backLink:X,centered:!0,children:e})})),P.data&&(0,C.jsxs)(B,{backLink:X,centeredPage:!0,gap:"1rem",children:[(0,C.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",P.data.name]}),(0,C.jsxs)("div",{className:vt.card,children:[(0,C.jsxs)("div",{className:vt.card__header,children:[(0,C.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),Y&&(0,C.jsx)("button",{className:"button",onClick:function(){return p(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,C.jsx)(Nt,{eventId:R,open:x,close:function(){return p(!1)}})]}),(0,C.jsxs)("div",{className:vt.card__body,children:[(0,C.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",P.data.name]}),(0,C.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",ce(P.data.date)]})]})]}),(0,C.jsxs)("div",{className:vt.line,children:[(0,C.jsx)(D.rU,{to:"/scanner/".concat(R),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,C.jsx)("button",{className:"button",onClick:function(){return T(new URL("/scanner/".concat(R),window.location.href).href)},children:"Qr \u043a\u043e\u0434 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,C.jsx)(At,{title:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440",code:M,setCode:T})]}),V&&(0,C.jsx)("button",{className:"button",onClick:function(){return c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,C.jsx)(bt,{eventId:R,open:a,close:function(){return c(!1)},setTicet:Q}),(0,C.jsx)(Zt,{ticket:I,event:P.data,setTicket:Q}),(0,C.jsx)(D.rU,{to:"/events/".concat(R,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,C.jsxs)("div",{className:vt.card,children:[(0,C.jsxs)("div",{className:vt.card__header,children:[(0,C.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),W&&(0,C.jsx)("button",{className:"button",onClick:function(){return g(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,C.jsx)(wt,{eventId:R,open:b,close:function(){return g(!1)}})]}),(0,C.jsxs)("div",{className:vt.card__body,children:[z.isLoading&&(0,C.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Ye(z,(function(e){return(0,C.jsx)("div",{children:e})})),null===(t=z.data)||void 0===t?void 0:t.map((function(e){return(0,C.jsx)("div",{children:e.name},e.id)}))]})]}),J&&(0,C.jsxs)("div",{className:vt.card,children:[(0,C.jsxs)("div",{className:vt.card__header,children:[(0,C.jsx)("h2",{children:"\u041a\u043b\u0435\u0440\u043a\u0438"}),K&&(0,C.jsx)("button",{className:"button",onClick:function(){return w(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,C.jsx)(St,{eventId:R,open:k,close:function(){return w(!1)}})]}),(0,C.jsxs)("div",{className:vt.card__body,children:[q.isLoading&&(0,C.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Ye(q,(function(e){return(0,C.jsx)("div",{children:e})})),null===(n=q.data)||void 0===n?void 0:n.map((function(e){return(0,C.jsx)("div",{children:e.name},e.id)}))]})]}),(0,C.jsx)("div",{className:vt.gap}),(0,C.jsx)("div",{className:vt.right,children:H&&(0,C.jsx)("button",{className:"button",onClick:function(){return d(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,C.jsx)(ft,{title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",onSuccess:function(){return U("/events")},mutationFn:we,itemId:R,open:l,close:function(){return d(!1)}})]})]})}var It={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX"};function Qt(e){var t,n,r,s=e.ticket,i=e.eventId,a=e.close,u=e.setTicket,o=(0,N.useState)(!1),l=(0,L.Z)(o,2),d=l[0],f=l[1],h=(0,N.useState)(!0),v=(0,L.Z)(h,2),x=v[0],p=v[1],j=(0,N.useState)(-1),m=(0,L.Z)(j,2),b=m[0],g=m[1],_=(0,N.useState)(""),y=(0,L.Z)(_,2),k=y[0],w=y[1],S=(0,N.useState)(""),A=(0,L.Z)(S,2),I=A[0],Q=A[1],D=(0,N.useState)(""),F=(0,L.Z)(D,2),E=F[0],M=F[1],T=(0,N.useState)(""),U=(0,L.Z)(T,2),R=U[0],P=U[1],z=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Fe,onSuccess:function(n){var r;"success"==(null===(r=t.getQueryState(["tickets","".concat(n.eventId)]))||void 0===r?void 0:r.status)&&t.setQueryData(["tickets","".concat(n.eventId)],(function(e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id==n.id?n:e})))||[]})),null===e||void 0===e||e(n)}})}((function(e){u(e),a()})),q=xt(i),B=Z("delete_ticket"),V=!!s;return(0,N.useEffect)((function(){var e,t;V&&(g((null===(e=q.data)||void 0===e||null===(t=e.find((function(e){return e.name==s.type})))||void 0===t?void 0:t.id)||-1),w(s.personName||""),Q(s.personLink||""),M(s.promocode||""),P(s.code||""));V||(z.reset(),p(!0))}),[V,s,q.data]),(0,C.jsxs)(Ae,{open:V,close:a,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[q.isLoading&&(0,C.jsx)(O,{}),Ye(z),z.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){s&&b>=0&&k&&z.mutate({ticketId:s.id,data:{typeId:b,personName:k,personLink:I,promocode:E,code:x?s.code:R}})},children:[(0,C.jsxs)(X,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,C.jsx)("select",{value:b,onChange:function(e){var t;return g((null===(t=q.data)||void 0===t?void 0:t[e.target.selectedIndex].id)||-1)},disabled:0==(null===(t=q.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=q.data)||void 0===n?void 0:n.map((function(e){return(0,C.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(r=q.data)||void 0===r?void 0:r.length)&&(0,C.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,C.jsx)(X,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,C.jsx)("input",{value:k,onChange:function(e){return w(e.target.value)},type:"text",required:!0})}),(0,C.jsx)(X,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,C.jsx)("input",{value:I,onChange:function(e){return Q(e.target.value)},type:"text"})}),(0,C.jsx)(X,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,C.jsx)("input",{value:E,onChange:function(e){return M(e.target.value)},type:"text"})}),(0,C.jsxs)("label",{children:[(0,C.jsx)("input",{type:"checkbox",checked:!x,onChange:function(e){return p(!e.target.checked)}}),(0,C.jsx)("span",{style:{color:x?"gray":"darkred"},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u0434"})]}),!x&&(0,C.jsxs)(X,{label:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430 (\u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434)",children:[(0,C.jsx)("div",{style:{color:"darkred",fontSize:"0.9rem"},children:"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438!"}),(0,C.jsx)("input",{value:R,onChange:function(e){return P(e.target.value)},type:"text"})]}),(0,C.jsx)("button",{type:"submit",className:"button button_small",disabled:z.isLoading||!q.data||0==q.data.length,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]}),B&&(0,C.jsx)("button",{className:"button button_danger button_small",onClick:function(){return f(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,C.jsx)(ft,{itemId:i,mutatateParams:(null===s||void 0===s?void 0:s.id)||0,title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",onSuccess:a,mutationFn:Me,open:d,close:function(){return f(!1)}})]})}function Lt(){var e,t,n=(0,N.useState)(!1),s=(0,L.Z)(n,2),i=s[0],a=s[1],c=(0,N.useState)(null),u=(0,L.Z)(c,2),o=u[0],l=u[1],d=(0,N.useState)(null),h=(0,L.Z)(d,2),v=h[0],x=h[1],p=(0,r.s0)(),j=(0,r.UO)().eventId,m=pe(j),b=Ce(j),g=Z("add_ticket"),_=Z("change_ticket");G([null===(e=m.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,N.useEffect)((function(){m.error instanceof f&&m.error.message.includes("not found")&&p("/not_found",{replace:!0})}),[m.error,p]);var y="/events/".concat(j);return(0,C.jsxs)(C.Fragment,{children:[(m.isLoading||b.isLoading)&&(0,C.jsx)(B,{backLink:y,children:(0,C.jsx)(O,{})}),Ye(m),Ye(b),m.data&&b.isSuccess&&(0,C.jsxs)(B,{backLink:y,centeredPage:!0,gap:"1rem",children:[(0,C.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",m.data.name]}),(0,C.jsxs)("div",{className:It.right,children:[(0,C.jsx)(D.rU,{target:"_blank",to:"/events/".concat(j,"/print_tickets"),className:"button",children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),g&&(0,C.jsx)("button",{className:"button",onClick:function(){return a(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,C.jsx)(bt,{eventId:j,open:i,close:function(){return a(!1)},setTicet:l})]}),(0,C.jsxs)("table",{children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{style:{width:"11em"},children:"\u041a\u043e\u0434"}),(0,C.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,C.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,C.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,C.jsxs)("th",{children:[(0,C.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,C.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]}),(0,C.jsx)("th",{children:"\u0411\u0438\u043b\u0435\u0442"}),_&&(0,C.jsx)("th",{children:"\u0420\u0435\u0434"})]})}),(0,C.jsx)("tbody",{children:null===(t=b.data)||void 0===t?void 0:t.map((function(e){return(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:e.code}),(0,C.jsx)("td",{children:e.personLink?(0,C.jsx)("a",{href:e.personLink,children:e.personName}):e.personName}),(0,C.jsx)("td",{style:{color:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?"red":""},children:e.type}),(0,C.jsx)("td",{children:e.promocode}),(0,C.jsx)("td",{className:It.center,children:e.scanned?"\u2713":"\u2716"}),(0,C.jsx)("td",{className:It.center,children:(0,C.jsx)("button",{className:"button button_small",onClick:function(){return l(e)},children:"\u0411\u0438\u043b\u0435\u0442"})}),_&&(0,C.jsx)("td",{className:It.center,children:(0,C.jsx)("button",{className:"button button_small",onClick:function(){return x(e)},children:"\u0420\u0435\u0434"})})]},e.id)}))})]}),(0,C.jsx)(Zt,{ticket:o,event:m.data,setTicket:l}),(0,C.jsx)(Qt,{ticket:v,eventId:j,close:function(){return x(null)},setTicket:l})]})]})}var Dt={root:"styles_root__QCWgG",table:"styles_table__Klrj7",center:"styles_center__pcMYz",mark:"styles_mark__4aU1o"};function Ft(){var e,t=(0,r.UO)().eventId,n=pe(t),s=Ce(t);G([null===(e=n.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]);var a=(0,N.useMemo)((function(){if(!s.data||!n.data)return[!1,""];var e=Be(n.data.id,n.data.date);return[s.data.every((function(t){return t.code.startsWith(e)})),e]}),[s.data,n.data]),c=(0,L.Z)(a,2),u=c[0],o=c[1];return(0,N.useEffect)((function(){if(n.isSuccess&&s.isSuccess){var e=setTimeout((function(){return window.print()}),1e3);return function(){return clearTimeout(e)}}}),[n.isSuccess,s.isSuccess]),(0,C.jsxs)(C.Fragment,{children:[(n.isLoading||s.isLoading)&&(0,C.jsx)(O,{}),Ye(n),Ye(s),n.isSuccess&&s.isSuccess&&(0,C.jsx)("div",{className:Dt.root,children:(0,C.jsxs)("table",{className:Dt.table,children:[(0,C.jsxs)("thead",{children:[(0,C.jsx)("tr",{children:(0,C.jsxs)("th",{colSpan:5,children:[(0,C.jsx)("span",{children:n.data.name}),u&&(0,C.jsx)("span",{style:{marginLeft:"1rem"},children:"|"}),u&&(0,C.jsxs)("span",{style:{marginLeft:"1rem"},children:["\u0412\u0441\u0435 \u043a\u043e\u0434\u044b \u0434\u043e\u0436\u043d\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 ",o]})]})}),(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{children:"\u041a\u043e\u0434"}),(0,C.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,C.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,C.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,C.jsxs)("th",{children:[(0,C.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,C.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]})]})]}),(0,C.jsx)("tbody",{children:s.data.map((function(e){return u?(0,i.Z)((0,i.Z)({},e),{},{code:e.code.slice(o.length),sortV:e.code.slice(e.code.lastIndexOf("-"))}):(0,i.Z)((0,i.Z)({},e),{},{sortV:e.code})})).sort((function(e,t){return e.sortV>t.sortV?1:-1})).map((function(e){return(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:e.code}),(0,C.jsx)("td",{children:e.personName}),(0,C.jsx)("td",{children:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?e.type.slice(8):e.type}),(0,C.jsx)("td",{children:e.promocode}),(0,C.jsx)("td",{className:Dt.center,children:(0,C.jsx)("span",{className:Dt.mark,children:e.scanned&&"\u2713"})})]},e.id)}))})]})})]})}function Et(){var e=(0,N.useState)(""),t=(0,L.Z)(e,2),n=t[0],r=t[1],i=(0,N.useState)(""),c=(0,L.Z)(i,2),u=c[0],o=c[1],l=(0,N.useRef)(null),d=(0,N.useRef)(null);return(0,C.jsxs)(B,{centered:!0,gap:"1rem",children:[(0,C.jsx)(D.rU,{to:"/users",className:"button",children:"Users"}),(0,C.jsx)(D.rU,{to:"/log",className:"button",children:"Log"}),(0,C.jsx)("button",{className:"button",onClick:(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_errors");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,r(n),setTimeout((function(){var e,t,n,r;return null===(e=l.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=l.current)||void 0===n||null===(r=n.parentElement)||void 0===r?void 0:r.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log errors"}),(0,C.jsx)("button",{className:"button",onClick:(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_info");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,o(n),setTimeout((function(){var e,t,n,r;return null===(e=d.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=d.current)||void 0===n||null===(r=n.parentElement)||void 0===r?void 0:r.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),o(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log requests"}),(0,C.jsx)(Ae,{title:"logErrors",open:""!=n,close:function(){return r("")},children:(0,C.jsx)("pre",{ref:l,children:n})}),(0,C.jsx)(Ae,{title:"log",open:""!=u,close:function(){return o("")},children:(0,C.jsx)("pre",{ref:d,children:u})})]})}var Mt={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function Tt(){var e;G("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");var t=(0,c.useQuery)("users",j);return(0,C.jsxs)(B,{centeredPage:!0,gap:8,children:[t.isLoading&&(0,C.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Ye(t),null===(e=t.data)||void 0===e?void 0:e.map((function(e){var n;return(0,C.jsxs)("div",{className:Mt.user,children:[(0,C.jsx)("input",{type:"checkbox",className:Mt.toggleInp,id:"user".concat(e.id)}),(0,C.jsxs)("label",{className:Mt.title,htmlFor:"user".concat(e.id),children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:e.login}),(0,C.jsx)("div",{style:{color:"blue"},children:e.id}),(0,C.jsx)("div",{children:"|"}),(0,C.jsx)("div",{children:e.name}),null!=e.bossId&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{children:"|"}),(0,C.jsx)("div",{style:{color:"#990099"},children:null===(n=t.data.find((function(t){return t.id==e.bossId})))||void 0===n?void 0:n.login})]})]}),(0,C.jsxs)("div",{children:[e.deleted&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,C.jsx)("div",{children:"|"})]}),(0,C.jsx)("span",{children:e.role}),(0,C.jsx)("div",{className:Mt.toggle})]})]}),(0,C.jsxs)("div",{className:Mt.userInfo,children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("h4",{children:"Operations"}),(0,C.jsx)("div",{className:Mt.operations,children:e.operations.map((function(e,t){return(0,C.jsx)("div",{children:Ut(e)},t)}))})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h4",{children:"Access"}),(0,C.jsx)("div",{className:Mt.operations,children:e.access.map((function(e,t){return(0,C.jsx)("div",{children:e},t)}))})]})]})]},e.id)}))]})}function Ut(e){var t={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(var n in t)if(e.startsWith(n))return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("span",{style:{color:t[n]},children:n}),(0,C.jsx)("span",{children:e.slice(n.length)})]});return(0,C.jsx)("span",{children:e})}var Rt={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z"};function Pt(e){var t,n=e.open,r=e.close,s=(0,N.useState)(""),i=(0,L.Z)(s,2),a=i[0],u=i[1],o=(0,N.useRef)(null),l=(0,N.useRef)(null),d=(t=r,(0,c.useMutation)({mutationFn:b,onSuccess:t}));return(0,N.useEffect)((function(){!n&&o.current&&l.current&&(d.reset(),u(""),o.current.value="",l.current.value="")}),[n,o,l]),(0,C.jsxs)(Ae,{open:n,close:r,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f",children:[Ye(d),d.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=o.current)||void 0===e?void 0:e.value,r=null===(t=l.current)||void 0===t?void 0:t.value;return!n||n.length<=4?u("\u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n!=r?u("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):void d.mutate({password:n})},children:[(0,C.jsx)(X,{label:"\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c",children:(0,C.jsx)("input",{ref:o,type:"password",required:!0})}),(0,C.jsx)(X,{label:"\u0415\u0449\u0451 \u0440\u0430\u0437",children:(0,C.jsx)("input",{ref:l,type:"password",required:!0})}),""!=a&&(0,C.jsx)("h4",{style:{color:"tomato"},children:a}),(0,C.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Ot(){var e,t,n,r=v(),s=(0,N.useRef)(null),a=(0,N.useState)(!1),u=(0,L.Z)(a,2),o=u[0],l=u[1],d=(0,N.useState)(!1),f=(0,L.Z)(d,2),h=f[0],x=f[1],p=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:_,onSuccess:function(n){var r;"success"==(null===(r=t.getQueryState("user"))||void 0===r?void 0:r.status)&&t.setQueryData("user",(function(e){return(0,i.Z)((0,i.Z)({},e),{},{name:n.name})})),null===e||void 0===e||e()}})}();return(0,C.jsxs)(B,{centered:!0,gap:"1rem",children:[(0,C.jsxs)("div",{className:Rt.root,children:[Ye(p),p.isLoading&&(0,C.jsx)(O,{}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,C.jsx)("div",{children:(0,C.jsx)("input",{type:"text",ref:s,defaultValue:null===(e=r.data)||void 0===e?void 0:e.name,disabled:!o,className:Rt.input})}),(0,C.jsxs)("div",{children:[!o&&(0,C.jsx)("button",{onClick:function(){return l(!0)},className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),o&&(0,C.jsx)("button",{onClick:function(){var e;l(!1),s.current&&(s.current.value=(null===(e=r.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),o&&(0,C.jsx)("button",{onClick:function(){l(!1),s.current&&p.mutate({name:s.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{children:"\u041b\u043e\u0433\u0438\u043d"}),null===(t=r.data)||void 0===t?void 0:t.login]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("h3",{children:"\u0420\u043e\u043b\u044c"}),null===(n=r.data)||void 0===n?void 0:n.role]}),(0,C.jsx)("div",{children:(0,C.jsx)("button",{className:"button",onClick:function(){return x(!0)},children:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})})]}),(0,C.jsx)(Pt,{open:h,close:function(){return x(!1)}})]})}function zt(){return qt.apply(this,arguments)}function qt(){return(qt=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/debug/log");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new f(n.msg);case 8:return e.abrupt("return",n.map(Bt));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(e){var t=e;return t.date=new Date(e.date),t}var Vt={table:"styles_table__QLr-h",changes:"styles_changes__EyS9f"};function Wt(){var e;G("Log");var t=(0,c.useQuery)("log",zt);return(0,C.jsxs)(B,{centeredPage:!0,children:[t.isFetching&&(0,C.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Ye(t),!t.isFetching&&(0,C.jsx)("button",{className:"button button_small",onClick:function(){return t.refetch()},children:"Update"}),(0,C.jsxs)("table",{className:Vt.table,children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{style:{width:"9.5em"},children:"Date"}),(0,C.jsx)("th",{style:{width:"4em"},children:"Action"}),(0,C.jsx)("th",{style:{width:"9.5em"},children:"Table[id]"}),(0,C.jsx)("th",{children:"User[id]"}),(0,C.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,C.jsx)("tbody",{children:null===(e=t.data)||void 0===e?void 0:e.map((function(e){return(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:oe(e.date,!0,!0)}),(0,C.jsx)("td",{children:Yt(e.actionCode)}),(0,C.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,C.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,C.jsxs)("td",{className:Vt.changes,children:[(0,C.jsx)("input",{type:"checkbox",className:Vt.toggleInp,id:"item".concat(e.id)}),(0,C.jsx)("div",{children:e.changes.map((function(e){return(0,C.jsxs)("div",{children:[e[0],': "',e[1],'" ',"->",' "',e[2],'"']})}))}),e.changes.length>0&&(0,C.jsx)("label",{className:"button button_small",htmlFor:"item".concat(e.id),children:e.changes.length})]})]},e.id)}))})]})]})}function Yt(e){return(0,C.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}function Jt(){var e,t=v();function n(e,n,s){var i;return(0,C.jsx)(r.AW,{path:n,element:null!==(i=t.data)&&void 0!==i&&i.auth?null==e||k(t,e)?s:(0,C.jsx)(W,{}):(0,C.jsx)(r.Fg,{to:"/auth"})})}return(0,C.jsxs)("div",{className:"root",children:[(0,C.jsx)(S,{}),t.isLoading&&(0,C.jsx)(w.Z,{}),Ye(t),t.isSuccess&&(0,C.jsxs)(r.Z5,{children:[(0,C.jsx)(r.AW,{path:"/auth",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,C.jsx)(r.Fg,{to:"/"}):(0,C.jsx)($,{})}),(0,C.jsx)(r.AW,{path:"/scanner/:eventId",element:(0,C.jsx)(Ve,{})}),n(null,"/",(0,C.jsx)(ee,{})),n(null,"/profile",(0,C.jsx)(Ot,{})),n("page_events","/events",(0,C.jsx)(Ke,{})),n("page_events","/events/:eventId",(0,C.jsx)(Ct,{})),n("page_events","/events/:eventId/tickets",(0,C.jsx)(Lt,{})),n("page_events","/events/:eventId/print_tickets",(0,C.jsx)(Ft,{})),n("page_staff","/staff",(0,C.jsx)(ht,{})),n("page_debug","/debug",(0,C.jsx)(Et,{})),n("page_debug","/log",(0,C.jsx)(Wt,{})),n("page_users","/users",(0,C.jsx)(Tt,{})),n(null,"*",(0,C.jsx)(V,{}))]})]})}}}]);
//# sourceMappingURL=758.c4d5e1bc.chunk.js.map