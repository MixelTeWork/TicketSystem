"use strict";(self.webpackChunkticket_system=self.webpackChunkticket_system||[]).push([[72],{5488:function(e,t,n){n.r(t),n.d(t,{default:function(){return dn}});var s=n(7689),r=n(4165),i=n(1413),a=n(5861),c=n(1933),o=n(3144),u=n(5671),l=n(136),d=n(516),h=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n)}((0,n(8737).Z)(Error));function f(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:void 0===t?null:JSON.stringify(t)})}function v(){return(0,c.useQuery)("user",p)}function p(){return x.apply(this,arguments)}function x(){return(x=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/user");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,401!=t.status){e.next=8;break}return e.abrupt("return",{auth:!1,id:-1,login:"",role:"",name:"",operations:[]});case 8:if(t.ok){e.next=10;break}throw new h(n.msg);case 10:return(s=n).auth=!0,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/users");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new h(n.msg);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/user/change_password",t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/user/change_name",t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){var n,s;return!(null===(n=e.data)||void 0===n||!n.auth||null===(s=e.data)||void 0===s||!s.operations.includes(t))}function k(e){var t,n,s=v();return!(null===(t=s.data)||void 0===t||!t.auth||null===(n=s.data)||void 0===n||!n.operations.includes(e))}var Z=n(5086),N=n(2791);function S(){var e=(0,s.TH)().pathname;return(0,N.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}var C={root:"styles_root__4DGhY"},I=n(184);function A(){var e=(0,s.s0)();return(0,I.jsx)("div",{className:C.root,children:(0,I.jsx)("button",{onClick:function(){return e(-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}function M(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return!!e})).join(" ")}var Q=n(9439),L=n(1087),E={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",menu:"styles_menu__WWgPh",menuVisible:"styles_menuVisible__mMGZn"},D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAJZQTFRFAAAAAAAB/tJS3TBS/NBR0S1OCgkG1i5Q8sdOOA0YmiI77YwY/9lVAAAD/+FX/JUarmcT85AZAAADnYI0oiM9ghwyAAADwZ8/UBEgSSsKhm8tLwoUFgoJZz0MST0a1a9FXEwgLCENHxYKAAADAAAD47xJryZCbFklu24UPDEVAAADYRUm1X4WfUsPAAADAAADemUqh1APjS8vDgAAADJ0Uk5TAP///////////////z3/////EP///yP///////////////+o5f//////v////1uK////wwoLAAACS0lEQVR4nOWXbXOiMBSFPYDilhhArFZKAWkVbdmK///P7Q0RZHfAMcl+2dkzY0IM5yFvJJfJ5P/SUte4BhaUfQN6CPIDH58fItMhNP5O6gThf6u2ySzZVlsNQuP3Qz/06OerE6TfCysv9EjKhNYfAJ6nQWj9/s8WoEa4+v0g8C/HUJ3Qjt8FCPyw0yBhMSS6b3cMAmo+LkFPx4L+Waz7/jM09N0DfOoA3nsAIFk9KWk1A27+d+DZdpVkvwBn6V6uRQfcqapEJ5bL5umkg62sp8Z4nog0OdhfPxT1ZR8S4SXA68G94pR0sN1V0gBe7Kn7DMyUBKzcqf3aB2zmj8uJhgDMelhsEGA5TlPrUO6IRKaOIwuyQmZjAEu2j3K6ZvM5ay7pWtZQLutHAVwMJXJeg2wnIBVtzXhSs30z2/wk6md8FMDiGkW94Tn2rESeIuYx9jkiliGN44hFdYI6YqMAh3Gk3GIEoIdxjpoANUpmZYg4JyPfgbJxAHUipdskgImBiKnpND0Zih092RGAO2PwJ2DuNIBatGCXihuUANSFkrqwKZCxaxcUALdBzDIkBDiVZcweACQlAdppzOU0lnD2Yv4KqkopuQeQK69ZOnIhMVnoFqW8uge4ybJ+L/WKwwDjl8n0ddbfUIy3NMNN1XhbNz5YzI+2v3G4mh/vxgHGpItnbnEMtbE4tvHMkIYjqi6S8sk/FlEN6xrTXXWpqkuoFxW2saCv6u8TwjfsfP3IWBAqncj6Fpt6mrG9+deF+feN+ReW+TdeJ0P7P6RfA+lYkv8rr7AAAAAASUVORK5CYII=";function R(e){return z.apply(this,arguments)}function z(){return(z=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/auth",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return(i=s).auth=!0,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/logout");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function O(e){var t=e.color,n=e.zIndex;return(0,I.jsx)("div",{className:U.root,children:(0,I.jsxs)("div",{className:U.spinner,style:{"--color":t,zIndex:n},children:[(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{}),(0,I.jsx)("div",{})]})})}function q(e){var t,n=e.backLink,r=(0,N.useState)(!1),i=(0,Q.Z)(r,2),a=i[0],o=i[1],u=(0,s.TH)(),l=(0,s.s0)(),d=function(){var e=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:F,onSuccess:function(){e.invalidateQueries("user")}})}(),h=v();return(0,I.jsxs)("div",{className:E.root,children:[(0,I.jsxs)("span",{className:E.block,children:[(0,I.jsx)(L.rU,{to:"/",className:E.home,children:(0,I.jsx)("img",{src:D,alt:"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})}),n&&(0,I.jsx)(L.rU,{to:n,children:(0,I.jsx)("button",{className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})}),"/"!=u.pathname&&!n&&(0,I.jsx)("button",{onClick:function(){return l(n||-1)},className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})]}),(0,I.jsxs)("span",{className:E.block,children:[(0,I.jsx)("button",{onClick:function(){return o((function(e){return!e}))},className:"button button_light",children:(0,I.jsx)("span",{children:null===(t=h.data)||void 0===t?void 0:t.name})}),(0,I.jsxs)("div",{className:M(E.menu,a&&E.menuVisible),children:[(0,I.jsx)("button",{onClick:function(){return l("/profile")},className:"button button_light",children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,I.jsx)("button",{onClick:function(){return d.mutate()},disabled:"idle"!=d.status,className:"button button_light",children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"idle"!=d.status&&(0,I.jsx)(O,{})]})}var V={root:"styles_root__xvR2N",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function P(e){var t=e.children,n=e.className,s=e.backLink,r=e.centered,i=void 0!==r&&r,a=e.centeredPage,c=void 0!==a&&a,o=e.height100,u=void 0!==o&&o,l=e.gap,d=void 0===l?0:l,h=e.header;return void 0===h&&(h=(0,I.jsx)(q,{backLink:s})),(0,I.jsxs)("div",{className:V.root,style:{maxHeight:u?"100dvh":""},children:[h||(0,I.jsx)("div",{}),(0,I.jsx)("div",{className:M(V.body,n,i&&V.body_centered,c&&V.body_centeredPage),style:{gap:d,maxHeight:u?"100%":""},children:t})]})}function W(){return(0,I.jsx)(P,{centered:!0,header:(0,I.jsx)(A,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function B(){return(0,I.jsx)(P,{centered:!0,header:(0,I.jsx)(A,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}var Y={form:"styles_form__n7Rcu"},J=n(3433);function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430";(0,N.useEffect)((function(){var n=document.title,s="object"!=typeof e?[e]:e;return document.title=[t].concat((0,J.Z)(s)).filter((function(e){return!!e})).join(" | "),function(){document.title=n}}),[e,t])}var G={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function H(e){var t=e.className,n=e.style,s=e.onSubmit,r=e.children;return(0,I.jsx)("form",{className:M(G.form,t),style:n,onSubmit:function(e){e.preventDefault(),s()},children:r})}function K(e){var t=e.label,n=e.className,s=e.style,r=e.children;return(0,I.jsxs)("label",{className:M(G.field,n),style:s,children:[(0,I.jsx)("span",{children:t}),r]})}function $(){X("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");var e=(0,N.useState)(""),t=(0,Q.Z)(e,2),n=t[0],s=t[1],r=(0,N.useRef)(null),i=(0,N.useRef)(null),a=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:R,onSuccess:function(e){t.setQueryData("user",(function(){return e}))},onError:function(t){null===e||void 0===e||e(t instanceof h?t.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}})}(s);return(0,I.jsxs)(P,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,I.jsx)("h1",{children:"\u0411\u0438\u043b\u0435\u0442\u043d\u0430\u044f \u0421\u0438\u0441\u0442\u0435\u043c\u0430"}),n&&(0,I.jsx)("h3",{children:n}),a.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{className:Y.form,onSubmit:function(){var e,t,n=(null===(e=r.current)||void 0===e?void 0:e.value)||"",s=(null===(t=i.current)||void 0===t?void 0:t.value)||"";a.mutate({login:n,password:s})},children:[(0,I.jsx)(K,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:r,type:"text",name:"login",required:!0})}),(0,I.jsx)(K,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:i,type:"password",name:"password",required:!0})}),(0,I.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==a.status,children:"\u0412\u043e\u0439\u0442\u0438"})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e."}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u043e\u043f\u0430\u043b\u0438 \u0441\u044e\u0434\u0430, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."})]})]})}function ee(){var e=v();return(0,I.jsxs)(P,{centered:!0,gap:"1em",children:[_(e,"page_events")&&(0,I.jsx)(L.rU,{to:"/events",className:"button button_large",children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),_(e,"page_staff")&&(0,I.jsx)(L.rU,{to:"/staff",className:"button button_large",children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),_(e,"page_debug")&&(0,I.jsx)(L.rU,{to:"/debug",className:"button button_large",children:"</>"})]})}var te={scanner:"styles_scanner__+xzXT",scannerRect:"styles_scannerRect__zwl3N",scannerVideo:"styles_scannerVideo__ZCceC",scanner_scanned:"styles_scanner_scanned__lX+Yf",scanned_anim:"styles_scanned_anim__UmXGC",scanResult:"styles_scanResult__35K03",big:"styles_big__bcOVH",success:"styles_success__dlqOt",result_desc:"styles_result_desc__oS+OA",error:"styles_error__0ctGO",alreadyScanned:"styles_alreadyScanned__OI-PM",alreadyScanned_visible:"styles_alreadyScanned_visible__keU3C"},ne={root:"styles_root__QdJnV"},se=n(1096);function re(e){var t=e.active,n=void 0===t||t,s=e.className,r=e.onScan,i=e.onCameraError,a=(0,N.useState)(),c=(0,Q.Z)(a,2),o=c[0],u=c[1],l=(0,N.useRef)(null);return(0,N.useEffect)((function(){if(l.current){var e=new se.Z(l.current,(function(e){return r(e.data)}),{highlightScanRegion:!0,maxScansPerSecond:10});return u((function(t){return null===t||void 0===t||t.stop(),null===t||void 0===t||t.destroy(),e})),e.start().catch((function(){return i()})),function(){e.stop(),e.destroy()}}}),[l,r]),(0,N.useEffect)((function(){o&&(n?o.start().catch((function(){return i()})):o.pause(!1))}),[n,o]),(0,I.jsx)("video",{className:M(ne.root,s),ref:l})}function ie(e,t){return"".concat(e).padStart(t,"0")}function ae(e,t,n,s){var r="".concat(e);return"1"==r.at(-1)&&"1"!=r.at(-2)?t:["2","3","4"].includes(r.at(-1)||"")&&"1"!=r.at(-2)?n:s}function ce(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"".concat(e.getFullYear(),".").concat(ie(e.getMonth()+1,2),".").concat(ie(e.getDate(),2)):"".concat(ie(e.getDate(),2),".").concat(ie(e.getMonth()+1,2),".").concat(e.getFullYear()):""}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="".concat(ie(e.getHours(),2),":").concat(ie(e.getMinutes(),2));return t?n+":".concat(ie(e.getSeconds(),2)):n}function ue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ce(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+oe(e,t)}function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"second",n=new Date,s=e.getTime()-n.getTime(),r=Math.floor(Math.abs(s)/1e3),i=Math.floor(r/31104e3);r-=60*i*60*24*30*12;var a=Math.floor(r/2592e3);r-=60*a*60*24*30;var c=Math.floor(r/86400);r-=60*c*60*24;var o=Math.floor(r/3600)%24;r-=60*o*60;var u=Math.floor(r/60)%60,l=(r-=60*u)%60;var d=function(){var e=function(e){return[e,["","",""]]};return 0!=i?[i,["\u0433\u043e\u0434","\u0433\u043e\u0434\u0430","\u043b\u0435\u0442"]]:0!=a?[a,["\u043c\u0435\u0441\u044f\u0446","\u043c\u0435\u0441\u044f\u0446\u0430","\u043c\u0435\u0441\u044f\u0446\u043e\u0432"]]:0!=c?[c,["\u0434\u0435\u043d\u044c","\u0434\u043d\u044f","\u0434\u043d\u0435\u0439"]]:"day"==t?e("\u0421\u0435\u0433\u043e\u0434\u043d\u044f"):0!=o?[o,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043e\u0432"]]:"hour"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=u?[u,["\u043c\u0438\u043d\u0443\u0442\u0430","\u043c\u0438\u043d\u0443\u0442\u044b","\u043c\u0438\u043d\u0443\u0442"]]:"minute"==t?e("\u0421\u0435\u0439\u0447\u0430\u0441"):0!=l?[l,["\u0441\u0435\u043a\u0443\u043d\u0434\u0430","\u0441\u0435\u043a\u0443\u043d\u0434\u044b","\u0441\u0435\u043a\u0443\u043d\u0434"]]:e("\u0422\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e")}(),h=(0,Q.Z)(d,2),f=h[0],v=h[1];if("string"==typeof f)return f;var p="".concat(ae.apply(void 0,[f].concat((0,J.Z)(v))));return Math.abs(f)>1&&(p=Math.abs(f)+" "+p),s>0?p="\u0427\u0435\u0440\u0435\u0437 "+p:p+=" \u043d\u0430\u0437\u0430\u0434",p}var de={root:"styles_root__E-Z+Q",top:"styles_top__r6L7-",bottom:"styles_bottom__GMtUi"};function he(e){var t=e.event,n=e.onInputBtn;return(0,I.jsxs)("div",{className:de.root,children:[(0,I.jsx)("div",{className:de.top,children:(0,I.jsx)("button",{onClick:n,children:"\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434"})}),(0,I.jsxs)("div",{className:de.bottom,children:[(0,I.jsx)("span",{children:t.name}),(0,I.jsx)("span",{children:"|"}),(0,I.jsx)("span",{children:ce(t.date)})]})]})}function fe(e){return fetch(e,{method:"DELETE"})}function ve(){return pe.apply(this,arguments)}function pe(){return(pe=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new h(n.msg);case 8:return s=n,e.abrupt("return",s.map(ye));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return me.apply(this,arguments)}(e)}))}function me(){return(me=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/events/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",ye(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return(0,c.useQuery)(["event","".concat(e)],(function(){return function(e){return ge.apply(this,arguments)}(e)}),{retry:3})}function ge(){return(ge=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/scanner_event/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}return e.abrupt("return",NaN);case 8:return e.abrupt("return",ye(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){var t=e;return t.date=new Date(e.date),t}function be(e){return we.apply(this,arguments)}function we(){return(we=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/event",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",ye(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return ke.apply(this,arguments)}(e,t)},onSuccess:function(e){var s;n.setQueryData(["event","".concat(e.id)],(function(){return e})),"success"==(null===(s=n.getQueryState("events"))||void 0===s?void 0:s.status)&&n.setQueryData("events",(function(t){return t?[].concat((0,J.Z)(t.filter((function(t){return t.id!=e.id}))),[e]):[e]})),null===t||void 0===t||t()}});return s}function ke(){return(ke=(0,a.Z)((0,r.Z)().mark((function e(t,n){var s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/event/"+t,n);case 2:return s=e.sent,e.next=5,s.json();case 5:if(i=e.sent,s.ok){e.next=8;break}throw new h(i.msg);case 8:return e.abrupt("return",ye(i));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){return function(e){return Ne.apply(this,arguments)}(e)},onSuccess:function(){var s;n.removeQueries(["event","".concat(e)],{exact:!0}),"success"==(null===(s=n.getQueryState("events"))||void 0===s?void 0:s.status)&&n.setQueryData("events",(function(t){return t?t.filter((function(t){return t.id!=e})):[]})),null===t||void 0===t||t()}});return s}function Ne(){return(Ne=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe("/api/event/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se={root:"styles_root__O0923",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function Ce(e){var t=e.children,n=e.open,s=void 0!==n&&n,r=e.close,i=e.title,a=void 0===i?"":i;return(0,I.jsx)("div",{className:M(Se.root,s&&Se.open),children:(0,I.jsxs)("div",{className:Se.popup,children:[(a||r)&&(0,I.jsxs)("div",{className:Se.header,children:[(0,I.jsx)("h3",{children:a}),r&&(0,I.jsx)("button",{className:Se.close,onClick:r,children:"\u2716"})]}),(0,I.jsx)("div",{className:Se.body,children:t})]})})}function Ie(e){return(0,c.useQuery)(["tickets",e],(function(){return function(e){return Ae.apply(this,arguments)}(e)}))}function Ae(){return(Ae=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s.map(Me));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e){var t=e;return e.scannedDate&&(t.scannedDate=new Date(e.scannedDate)),e.createdDate&&(t.createdDate=new Date(e.createdDate)),t}function Qe(e){return Le.apply(this,arguments)}function Le(){return(Le=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/ticket",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",Me(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return De.apply(this,arguments)}function De(){return(De=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/ticket/"+t.ticketId,t.data);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",Me(s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e,t){var n=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:ze,onSuccess:function(s){var r;"success"==(null===(r=n.getQueryState(["tickets","".concat(e)]))||void 0===r?void 0:r.status)&&n.setQueryData(["tickets","".concat(e)],(function(e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!=s})))||[]})),null===t||void 0===t||t()}})}function ze(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe("/api/ticket/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){return(0,c.useQuery)(["ticket_stats",e],(function(){return function(e){return Ue.apply(this,arguments)}(e)}))}function Ue(){return(Ue=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/tickets_stats/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return qe.apply(this,arguments)}function qe(){return(qe=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/check_ticket",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return a=s,(i=s).ticket&&(a.ticket=Me(i.ticket)),i.event&&(a.event=ye(i.event)),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){var t=(0,N.useState)((function(){var t=new Audio(e);return t.preload="auto",t})),n=(0,Q.Z)(t,1)[0];return[function(){n.currentTime=0,n.play()}]}var Pe=n.p+"static/media/beep.38f199e084efe5461ffd.mp3",We=n.p+"static/media/beepError.7eccfa35a3dd6b6ea311.mp3";function Be(e,t){return"".concat(ie(e,3),"-").concat(t.getFullYear().toString().at(-1)).concat(ie(t.getMonth()+1,2)).concat(ie(t.getDate(),2),"-")}function Ye(){X("\u0421\u043a\u0430\u043d\u0435\u0440");var e,t=(0,s.UO)(),n=(0,N.useState)(null),r=(0,Q.Z)(n,2),i=r[0],a=r[1],o=(0,N.useState)(null),u=(0,Q.Z)(o,2),l=u[0],d=u[1],f=(0,N.useState)(null),v=(0,Q.Z)(f,2),p=v[0],x=v[1],m=(0,N.useState)(null),j=(0,Q.Z)(m,2),g=j[0],y=j[1],b=(0,N.useState)(!0),w=(0,Q.Z)(b,2),_=w[0],k=w[1],Z=(0,N.useState)(!1),S=(0,Q.Z)(Z,2),C=S[0],A=S[1],L=(0,N.useState)(!1),E=(0,Q.Z)(L,2),D=E[0],R=E[1],z=(0,N.useState)(!1),F=(0,Q.Z)(z,2),T=F[0],U=F[1],q=(0,N.useRef)(null),V=je(t.eventId),W=Ve(Pe),B=(0,Q.Z)(W,1)[0],Y=Ve(We),J=(0,Q.Z)(Y,1)[0],G=(0,N.useCallback)((function(e){return a(e)}),[]),H=(0,N.useCallback)((function(){A(!0),q.current&&V.data&&"number"!=typeof V.data&&(setTimeout((function(){q.current&&q.current.focus()}),50),q.current.value=Be(V.data.id,V.data.date))}),[q,V.data]),K=(0,N.useCallback)((function(){return A(!1)}),[]),$=function(e,t){var n=(0,c.useMutation)({mutationFn:Oe,onSuccess:function(t){null===e||void 0===e||e(t)},onError:function(e){null===t||void 0===t||t(e instanceof h?e.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"),n.reset()}});return n}((function(e){y(e),e.success||J()}),(function(e){y(null),x(e)}));return(0,N.useEffect)((function(){if(i&&V.data&&"idle"==$.status&&"number"!=typeof V.data){if(B(),l==i&&!p)return a(null),void R(!0);a(null),R(!1),d(i),x(null),y(null),$.mutate({code:i,eventId:V.data.id})}}),[i,V.data,$.status]),(0,N.useEffect)((function(){if($.isSuccess){var e=setTimeout((function(){a(null),$.reset()}),1e3);return function(){return clearTimeout(e)}}}),[$.isSuccess]),(0,N.useEffect)((function(){if(D){var e=setTimeout((function(){return R(!1)}),500);return function(){return clearTimeout(e)}}}),[D]),(0,I.jsxs)(I.Fragment,{children:[V.isLoading&&(0,I.jsx)(O,{}),V.error&&(0,I.jsx)(P,{centered:!0,gap:"1em",header:null,children:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430"}),"number"==typeof V.data&&(0,I.jsxs)(P,{centered:!0,centeredPage:!0,gap:"1em",header:null,children:[(0,I.jsx)("div",{children:"\u042d\u0442\u043e \u0441\u043e\u0431\u044b\u0442\u0438\u0435 \u0435\u0449\u0451 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b\u043e\u0441\u044c \u0438\u043b\u0438 \u0443\u0436\u0435 \u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c"}),(0,I.jsx)("div",{children:"\u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043d\u0435 \u0442\u0430\u043a, \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043f\u0440\u0438\u0451\u043c \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),"number"!=typeof V.data&&V.data&&(0,I.jsxs)(P,{height100:!0,header:(0,I.jsx)(he,{event:V.data,onInputBtn:H}),children:[(0,I.jsx)("div",{className:M(te.scanner,!$.isIdle&&te.scanner_scanned),children:(0,I.jsx)("div",{className:te.scannerRect,children:(0,I.jsx)(re,{onScan:G,onCameraError:function(){return U(!0)},className:te.scannerVideo})})}),(0,I.jsxs)("div",{className:te.scanResult,children:[(0,I.jsx)("div",{className:M(te.alreadyScanned,D&&te.alreadyScanned_visible),children:"\u0422\u043e\u0442 \u0436\u0435 \u0431\u0438\u043b\u0435\u0442"}),l&&(0,I.jsxs)("div",{children:["\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430: ",l]}),p&&(0,I.jsx)("div",{children:p}),(null===g||void 0===g?void 0:g.success)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:M(te.success,te.big),children:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d"}),(0,I.jsxs)("div",{className:te.result_desc,children:[(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",g.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",g.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",g.ticket.promocode]})]})]}),"notExist"==(null===g||void 0===g?void 0:g.errorCode)&&(0,I.jsx)("div",{className:M(te.error,te.big),children:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}),"event"==(null===g||void 0===g?void 0:g.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:M(te.error,te.big),children:"\u0414\u0440\u0443\u0433\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),(0,I.jsxs)("div",{className:te.result_desc,children:[(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",g.event.name]}),(0,I.jsxs)("div",{children:["\u0415\u0433\u043e \u0434\u0430\u0442\u0430: ",ce(g.event.date)," (",le(g.event.date,"day"),")"]})]}),(0,I.jsxs)("div",{children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",g.ticket.personName]})]})]}),"scanned"==(null===g||void 0===g?void 0:g.errorCode)&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:M(te.error,te.big),children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439"}),(0,I.jsxs)("div",{className:te.result_desc,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041a\u043e\u0433\u0434\u0430: "}),(0,I.jsxs)("span",{children:[oe(g.ticket.scannedDate,!0)," "]}),(0,I.jsxs)("span",{className:M((e=g.ticket.scannedDate,((new Date).getTime()-e.getTime())/1e3>30&&te.error)),children:["(",le(g.ticket.scannedDate),")"]})]}),(0,I.jsxs)("div",{style:{marginTop:"0.5rem"},children:["\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c: ",g.ticket.personName]}),(0,I.jsxs)("div",{children:["\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430: ",g.ticket.type]}),(0,I.jsxs)("div",{children:["\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434: ",g.ticket.promocode]})]})]})]}),(0,I.jsxs)(Ce,{title:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430",open:C,close:K,children:[(0,I.jsx)("input",{type:"text",ref:q}),(0,I.jsx)("button",{disabled:"idle"!=$.status,onClick:function(){var e;q.current&&a(null===(e=q.current)||void 0===e?void 0:e.value),K()},children:"\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c"})]}),(0,I.jsxs)(Ce,{open:T,children:[(0,I.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,I.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,I.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]}),(0,I.jsxs)(Ce,{title:"\u0421\u043a\u0430\u043d\u0435\u0440 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",open:_,close:function(){return k(!1)},children:[(0,I.jsx)("h2",{children:V.data.name}),(0,I.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u0438\u043b\u0435\u0442\u0430 \u043d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u0430\u043c\u0435\u0440\u0443 \u043d\u0430 QR \u043a\u043e\u0434 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043e\u043d \u043f\u043e\u043c\u0435\u0441\u0442\u0438\u043b\u0441\u044f \u0432 \u043c\u0438\u0433\u0430\u044e\u0449\u0443\u044e \u0440\u0430\u043c\u043a\u0443."}),(0,I.jsxs)("p",{children:[(0,I.jsx)("strong",{children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0437\u0432\u0443\u043a"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u043b\u044b\u0448\u0430\u0442\u044c \u0441\u0438\u0433\u043d\u0430\u043b \u043f\u0440\u0438 \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438."]})]})]})]})}var Je={space_between:"styles_space_between__AD+M6"};function Xe(e,t){return e.isError?(t||Ge)(e.error instanceof h?e.error.message:"\u041e\u0448\u0438\u0431\u043a\u0430"):null}function Ge(e){return(0,I.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function He(e){var t=e.open,n=e.close,s=(0,N.useRef)(null),r=(0,N.useRef)(null),i=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:be,onSuccess:function(n){var s;t.setQueryData(["event","".concat(n.id)],(function(){return n})),"success"==(null===(s=t.getQueryState("events"))||void 0===s?void 0:s.status)&&t.setQueryData("events",(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e()}})}(n);return(0,N.useEffect)((function(){!t&&s.current&&r.current&&(s.current.value="",r.current.value="")}),[t,s,r]),(0,N.useEffect)((function(){t||i.reset()}),[t]),(0,I.jsxs)(Ce,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Xe(i),(0,I.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=s.current)||void 0===e?void 0:e.value,a=null===(t=r.current)||void 0===t?void 0:t.value;n&&a&&i.mutate({date:a,name:n})},children:[(0,I.jsx)(K,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:s,type:"text",required:!0})}),(0,I.jsx)(K,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:r,type:"datetime-local",required:!0})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),i.isLoading&&(0,I.jsx)(O,{})]})}function Ke(){var e,t;X("\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f");var n=(0,N.useState)(!1),s=(0,Q.Z)(n,2),r=s[0],i=s[1],a=function(){var e=(0,c.useQueryClient)();return(0,c.useQuery)("events",ve,{onSuccess:function(t){t.forEach((function(t){return e.setQueryData(["event","".concat(t.id)],t)}))}})}();return(0,I.jsxs)(P,{backLink:"/",centeredPage:!0,gap:"1rem",children:[(0,I.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f"}),a.isLoading&&(0,I.jsx)(O,{}),Xe(a),null===(e=a.data)||void 0===e||null===(t=e.sort((function(e,t){return e.date<t.date?1:-1})))||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)(L.rU,{to:"/events/".concat(e.id),className:M("button button_large",Je.space_between),children:[(0,I.jsx)("span",{children:e.name}),(0,I.jsx)("span",{children:ce(e.date)})]},e.id)})),k("add_event")&&(0,I.jsxs)("div",{className:Je.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(He,{open:r,close:function(){return i(!1)}})]})}function $e(){return(0,c.useQuery)("staff",et)}function et(){return tt.apply(this,arguments)}function tt(){return(tt=(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/staff");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new h(n.msg);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){return(0,c.useQuery)(["staff","".concat(e)],(function(){return function(e){return st.apply(this,arguments)}(e)}))}function st(){return(st=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/event/staff/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return it.apply(this,arguments)}(e,t)},onSuccess:function(s){var r;"success"==(null===(r=n.getQueryState(["staff","".concat(e)]))||void 0===r?void 0:r.status)&&n.setQueryData(["staff","".concat(e)],s),null===t||void 0===t||t()}});return s}function it(){return(it=(0,a.Z)((0,r.Z)().mark((function e(t,n){var s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/event/staff/"+t,n);case 2:return s=e.sent,e.next=5,s.json();case 5:if(i=e.sent,s.ok){e.next=8;break}throw new h(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e){return ct.apply(this,arguments)}function ct(){return(ct=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/staff",t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:if(!s.exist){e.next=10;break}throw new h(s.msg);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ot(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){return function(e){return ut.apply(this,arguments)}(e)},onSuccess:function(){var s;"success"==(null===(s=n.getQueryState("staff"))||void 0===s?void 0:s.status)&&n.setQueryData("staff",(function(t){return t?t.filter((function(t){return t.id!=e})):[]})),null===t||void 0===t||t()}});return s}function ut(){return(ut=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe("/api/staff/"+t);case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=h,e.next=7,n.json();case 7:throw e.t1=e.sent.msg,new e.t0(e.t1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(){return function(e){return dt.apply(this,arguments)}(e)},onSuccess:function(s){var r;"success"==(null===(r=n.getQueryState("staff"))||void 0===r?void 0:r.status)&&n.setQueryData("staff",(function(t){return t?t.map((function(t){return t.id!=e?t:s})):[]})),null===t||void 0===t||t(s)}});return s}function dt(){return(dt=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/staff/reset_password/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ht={user:"styles_user__JQBf0",title:"styles_title__OlEMb",space_between:"styles_space_between__Z0Ibu",toggle:"styles_toggle__wBqj6",toggleInp:"styles_toggleInp__Tox8V",userInfo:"styles_userInfo__Pveb6"};function ft(e){var t=e.open,n=e.close,s=(0,N.useState)(null),r=(0,Q.Z)(s,2),i=r[0],a=r[1],o=(0,N.useRef)(null),u=(0,N.useRef)(null),l=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:at,onSuccess:function(n){var s;"success"==(null===(s=t.getQueryState("staff"))||void 0===s?void 0:s.status)&&t.setQueryData("staff",(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e(n)}})}((function(e){a(e),null===n||void 0===n||n()}));return(0,N.useEffect)((function(){!t&&o.current&&u.current&&(l.reset(),o.current.value="",u.current.value="")}),[t,o,u]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Ce,{open:t,close:n,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[Xe(l),(0,I.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=o.current)||void 0===e?void 0:e.value,s=null===(t=u.current)||void 0===t?void 0:t.value;n&&s&&l.mutate({name:n,login:s})},children:[(0,I.jsx)(K,{label:"\u0418\u043c\u044f",children:(0,I.jsx)("input",{ref:o,type:"text",required:!0})}),(0,I.jsx)(K,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,I.jsx)("input",{ref:u,placeholder:"\u0410\u043d\u0433\u043b. \u0431\u0443\u043a\u0432\u044b, \u0446\u0438\u0444\u0440\u044b \u0438 _",type:"text",required:!0,onInput:function(e){u.current&&(u.current.value=u.current.value.replaceAll(/[^a-z_\d]/g,""))}})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),l.isLoading&&(0,I.jsx)(O,{})]}),(0,I.jsxs)(Ce,{open:!!i,close:function(){return a(null)},title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",null===i||void 0===i?void 0:i.login]}),(0,I.jsxs)("div",{children:["\u041f\u0430\u0440\u043e\u043b\u044c: ",null===i||void 0===i?void 0:i.password]}),(0,I.jsx)("h4",{style:{marginTop:8},children:"\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e"})]})]})}function vt(e){var t=e.title,n=e.mutationFn,s=e.mutatateParams,r=e.itemId,i=e.onSuccess,a=e.open,c=e.close,o=n(r,(function(e){null===c||void 0===c||c(),null===i||void 0===i||i(e)}));return(0,N.useEffect)((function(){a||o.reset()}),[a]),(0,I.jsxs)(Ce,{open:a,close:c,title:t,children:[Xe(o),o.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){o.mutate(s)},children:[(0,I.jsx)("h1",{children:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function pt(){var e,t;X("\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438");var n=(0,N.useState)(!1),s=(0,Q.Z)(n,2),r=s[0],i=s[1],a=(0,N.useState)(-1),c=(0,Q.Z)(a,2),o=c[0],u=c[1],l=(0,N.useState)(-1),d=(0,Q.Z)(l,2),h=d[0],f=d[1],v=$e();return(0,I.jsxs)(P,{centeredPage:!0,gap:8,children:[(0,I.jsx)("h1",{children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"}),0==(null===(e=v.data)||void 0===e?void 0:e.length)&&(0,I.jsx)("h2",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432"}),null===(t=v.data)||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)("div",{className:ht.user,children:[(0,I.jsx)("input",{type:"checkbox",className:ht.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:ht.title,htmlFor:"user".concat(e.id),children:[(0,I.jsx)("div",{children:e.name}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:e.role}),(0,I.jsx)("div",{className:ht.toggle})]})]}),(0,I.jsxs)("div",{className:ht.userInfo,children:[(0,I.jsxs)("div",{children:["\u041b\u043e\u0433\u0438\u043d: ",e.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:"\u041f\u0430\u0440\u043e\u043b\u044c: "}),e.password||(0,I.jsx)("button",{className:"button button_light button_small",onClick:function(){return f(e.id)},children:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})]}),(0,I.jsxs)("div",{className:ht.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return u(e.id)},children:"\u0423\u0432\u043e\u043b\u0438\u0442\u044c"})]})]})]},e.id)})),k("add_staff")&&(0,I.jsxs)("div",{className:ht.space_between,children:[(0,I.jsx)("span",{}),(0,I.jsx)("button",{className:"button",onClick:function(){return i(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]}),(0,I.jsx)(ft,{open:r,close:function(){return i(!1)}}),(0,I.jsx)(vt,{itemId:o,title:"\u0423\u0432\u043e\u043b\u044c\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:ot,open:o>=0,close:function(){return u(-1)}}),(0,I.jsx)(vt,{itemId:h,title:"\u0421\u0431\u0440\u043e\u0441 \u043f\u0430\u0440\u043e\u043b\u044f \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",mutationFn:lt,open:h>=0,close:function(){return f(-1)}})]})}var xt={card:"styles_card__1zOYj",card__header:"styles_card__header__o4cfX",card__body:"styles_card__body__KU56x",gap:"styles_gap__Z5dnR",right:"styles_right__fxm89",line:"styles_line__4myXW"};function mt(e){var t=(0,c.useQueryClient)(),n=(0,c.useQuery)(["ticket_types",e],(function(){return function(e){return jt.apply(this,arguments)}(e)}),{onSuccess:function(e){e.forEach((function(e){return t.setQueryData(["ticket_type","".concat(e.id)],e)}))}});return n}function jt(){return(jt=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_types/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gt(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return yt.apply(this,arguments)}(e,t)},onSuccess:function(s,r){r.some((function(e){return"delete"==e.action||"update"==e.action}))&&n.invalidateQueries(["tickets","".concat(e)],{exact:!0}),n.setQueryData(["ticket_types","".concat(e)],(function(){return s})),s.forEach((function(e){return n.setQueryData(["ticket_type","".concat(e.id)],e)})),null===t||void 0===t||t(s)}});return s}function yt(){return(yt=(0,a.Z)((0,r.Z)().mark((function e(t,n){var s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/ticket_types/"+t,n);case 2:return s=e.sent,e.next=5,s.json();case 5:if(i=e.sent,s.ok){e.next=8;break}throw new h(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e){return(0,c.useQuery)(["ticket_type","".concat(e)],(function(){return function(e){return wt.apply(this,arguments)}(e)}),{enabled:e>=0})}function wt(){return(wt=(0,a.Z)((0,r.Z)().mark((function e(t){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/ticket_type/"+t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(s=e.sent,n.ok){e.next=8;break}throw new h(s.msg);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(e,t){var n=(0,c.useQueryClient)(),s=(0,c.useMutation)({mutationFn:function(t){return function(e,t){return kt.apply(this,arguments)}(e,t)},onSuccess:function(s){var r;n.setQueryData(["ticket_type","".concat(e)],(function(){return s})),"success"==(null===(r=n.getQueryState(["ticket_types","".concat(e)]))||void 0===r?void 0:r.status)&&n.setQueryData(["ticket_types","".concat(e)],(function(e){return e?[].concat((0,J.Z)(e.filter((function(e){return e.id!=s.id}))),[s]):[s]})),null===t||void 0===t||t(s)}});return s}function kt(){return(kt=(0,a.Z)((0,r.Z)().mark((function e(t,n){var s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("/api/ticket_type/"+t,n);case 2:return s=e.sent,e.next=5,s.json();case 5:if(i=e.sent,s.ok){e.next=8;break}throw new h(i.msg);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zt(e){var t,n,s,r=e.open,i=e.eventId,a=e.close,o=e.setTicet,u=(0,N.useState)(-1),l=(0,Q.Z)(u,2),d=l[0],h=l[1],f=(0,N.useState)(""),v=(0,Q.Z)(f,2),p=v[0],x=v[1],m=(0,N.useState)(""),j=(0,Q.Z)(m,2),g=j[0],y=j[1],b=(0,N.useState)(""),w=(0,Q.Z)(b,2),_=w[0],k=w[1],Z=(0,N.useState)(""),S=(0,Q.Z)(Z,2),C=S[0],A=S[1],M=(0,N.useState)(!0),L=(0,Q.Z)(M,2),E=L[0],D=L[1],R=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Qe,onSuccess:function(n){var s;"success"==(null===(s=t.getQueryState(["tickets","".concat(n.eventId)]))||void 0===s?void 0:s.status)&&t.setQueryData(["tickets","".concat(n.eventId)],(function(e){return e?[].concat((0,J.Z)(e),[n]):[n]})),null===e||void 0===e||e(n)}})}((function(e){o(e),null===a||void 0===a||a()})),z=mt(i);return(0,N.useEffect)((function(){var e,t;r||(D(!0),h((null===(e=z.data)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.id)||-1),x(""),y(""),k(""),A(""),R.reset())}),[r,z.data]),(0,I.jsxs)(Ce,{open:r,close:a,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[Xe(R),z.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){d>=0&&p&&R.mutate({eventId:parseInt("".concat(i),10),typeId:d,personName:p,personLink:g,promocode:_,code:E?"":C})},children:[(0,I.jsxs)(K,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("select",{value:d,onChange:function(e){var t,n;return h((null===(t=z.data)||void 0===t||null===(n=t[e.target.selectedIndex])||void 0===n?void 0:n.id)||-1)},disabled:0==(null===(t=z.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=z.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(s=z.data)||void 0===s?void 0:s.length)&&(0,I.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,I.jsx)(K,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,I.jsx)("input",{value:p,onChange:function(e){return x(e.target.value)},type:"text",required:!0})}),(0,I.jsx)(K,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,I.jsx)("input",{value:g,onChange:function(e){return y(e.target.value)},type:"text"})}),(0,I.jsx)(K,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,I.jsx)("input",{value:_,onChange:function(e){return k(e.target.value)},type:"text"})}),(0,I.jsxs)("label",{children:[(0,I.jsx)("input",{type:"checkbox",checked:E,onChange:function(e){return D(e.target.checked)}}),(0,I.jsx)("span",{style:{color:E?"darkgreen":"darkred"},children:"\u0410\u0432\u0442\u043e-\u043a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430"})]}),!E&&(0,I.jsxs)(K,{label:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430 (\u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434)",children:[(0,I.jsx)("div",{style:{color:"darkred",fontSize:"0.9rem"},children:"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438!"}),(0,I.jsx)("input",{value:C,onChange:function(e){return A(e.target.value)},type:"text"})]}),(0,I.jsx)("button",{type:"submit",className:"button button_small",disabled:!z.data||0==z.data.length,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})]}),R.isLoading&&(0,I.jsx)(O,{})]})}var Nt={root:"styles_root__+QOp3",canvas:"styles_canvas__wzjs3",inspector:"styles_inspector__TrPRu",inspector_open:"styles_inspector_open__h5KZj",fields:"styles_fields__fz+aE",colorInput:"styles_colorInput__8Ty5B",panel:"styles_panel__yLWcU",br:"styles_br__7BTyB",footer:"styles_footer__ADD9E"};function St(e,t,n){return Ct.apply(this,arguments)}function Ct(){return(Ct=(0,a.Z)((0,r.Z)().mark((function e(t,n,s){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n=new FileReader;n.addEventListener("loadend",(function(t){e({result:n.result,error:n.error})})),n.readAsDataURL(t)}));case 2:if(!(i=e.sent).error){e.next=6;break}return console.error(i.error),e.abrupt("return",null);case 6:return e.abrupt("return",{data:i.result,name:n,accessEventId:s});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var It=n(741),At=function(){function e(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,u.Z)(this,e),this.viewMode=s,this.editor=null,this.img=null,this.imgQr=new Image,this.imgFile=null,this.data={width:0,height:0,objects:[]},this.canvas=null,this.ctx=null,this.loading=!1,this.ticket=null,this.listenerResize=function(){return t.draw()},this.listenerMouseDown=function(e){var n;null!==(n=t.editor)&&void 0!==n&&n.mouseDown(e.offsetX,e.offsetY,e.button)&&t.draw()},this.listenerMouseMove=function(e){var n;null!==(n=t.editor)&&void 0!==n&&n.mouseMove(e.offsetX,e.offsetY)&&t.draw()},this.listenerMouseUp=function(e){var n;null!==(n=t.editor)&&void 0!==n&&n.mouseUp(e.offsetX,e.offsetY,e.button)&&t.draw()},this.listenerContextMenu=function(e){e.preventDefault()},this.listenerWheel=function(e){var n;null!==(n=t.editor)&&void 0!==n&&n.wheel(e.offsetX,e.offsetY,e.deltaY)&&t.draw()},this.inspectorSet=function(){},this.inspectorInput=function(e,n){var s;null===(s=t.editor)||void 0===s||s.inspectorInput(e,n),t.draw()},n&&!s&&window.addEventListener("resize",this.listenerResize)}return(0,o.Z)(e,[{key:"setData",value:function(e,t){this.img=null,this.imgFile=null,null!=e&&this.loadImage(e),this.data=t||this.createNewData(),this.editor=null,this.reRenderQR(),this.draw()}},{key:"setViewTicket",value:function(e){var t;this.ticket=e,null===(t=this.editor)||void 0===t||t.setViewTicket(e),this.reRenderQR(),this.draw()}},{key:"setNewImage",value:function(e){var t=this;this.imgFile=e;var n=new Image;this.img=n,this.img.addEventListener("load",(function(){URL.revokeObjectURL(s),t.loading=!1,t.editor=null,t.draw()}));var s=URL.createObjectURL(e);this.loading=!0,this.img.src=s}},{key:"setImage",value:function(e){this.imgFile=null,this.img=null,null!=e&&this.loadImage(e)}},{key:"setCanvas",value:function(e){this.removeCanvasListeners(),this.canvas=e,this.ctx=e.getContext("2d"),this.draw(),this.viewMode||(e.addEventListener("mousedown",this.listenerMouseDown),e.addEventListener("mousemove",this.listenerMouseMove),e.addEventListener("mouseup",this.listenerMouseUp),e.addEventListener("wheel",this.listenerWheel),e.addEventListener("contextmenu",this.listenerContextMenu))}},{key:"setInspector",value:function(e){this.inspectorSet=e}},{key:"reset",value:function(){this.editor=null,this.img=null,this.imgQr=new Image,this.imgFile=null,this.data={width:0,height:0,objects:[]},this.loading=!1,this.ticket=null,this.inspectorSet(null),this.draw()}},{key:"getData",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.data,!this.imgFile){e.next=7;break}return e.next=4,St(this.imgFile,t,n);case 4:e.t1=e.sent,e.next=8;break;case 7:e.t1=null;case 8:return e.t2=e.t1,e.abrupt("return",{pattern:e.t0,img:e.t2});case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){window.removeEventListener("resize",this.listenerResize),this.removeCanvasListeners(),this.inspectorSet(null)}},{key:"drawObject",value:function(e){var t;null===(t=this.editor)||void 0===t||t.drawObject(e)}},{key:"resetZoom",value:function(){this.editor&&(this.editor.resetZoom(),this.draw())}},{key:"fitZoom",value:function(){this.editor&&(this.editor.fitToView(),this.draw())}},{key:"removeCanvasListeners",value:function(){this.canvas&&(this.canvas.removeEventListener("mousedown",this.listenerMouseDown),this.canvas.removeEventListener("mousemove",this.listenerMouseMove),this.canvas.removeEventListener("mouseup",this.listenerMouseUp),this.canvas.removeEventListener("wheel",this.listenerWheel),this.canvas.removeEventListener("contextmenu",this.listenerContextMenu))}},{key:"loadImage",value:function(e){var t=this,n=new Image;this.img=n,this.img.addEventListener("load",(function(){t.loading=!1,t.editor=null,t.draw()})),this.loading=!0,this.img.src="/api/img/".concat(e)}},{key:"reRenderQR",value:function(){var t,n,s=this,r=(null===(t=this.data.objects.find((function(e){return"qr"==e.type})))||void 0===t?void 0:t.c)||"#000000";e.renderQRCode((null===(n=this.ticket)||void 0===n?void 0:n.code)||"123-31224-34-07-4321",r,(function(e){s.imgQr=e,s.editor&&(s.editor.setQr(e),s.draw())}))}},{key:"setCursor",value:function(e){this.canvas&&(this.canvas.style.cursor=e)}},{key:"draw",value:function(){if(this.canvas){var e=this.canvas.parentElement;if(e){var t=e.clientWidth,n=e.clientHeight;if(this.viewMode&&this.img&&!this.loading&&(t=this.data.width,n=this.data.height),this.canvas.width=t,this.canvas.style.width="".concat(t,"px"),this.canvas.height=n,this.canvas.style.height="".concat(n,"px"),this.ctx)if(this.ctx.fillStyle="#00000033",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.img&&!this.loading)this.editor||(this.editor=new Mt(this.img,this.data,this.reRenderQR.bind(this),this.setCursor.bind(this),this.inspectorSet,this.imgQr,this.viewMode),this.editor.setCanvasSize({w:t,h:n}),this.editor.fitToView()),this.editor.setCanvasSize({w:t,h:n}),this.ctx.imageSmoothingEnabled=!1,this.ticket&&this.editor.setViewTicket(this.ticket),this.editor.draw(this.ctx);else{this.ctx.fillStyle="black";var s=this.loading?"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430":this.viewMode?"\u042d\u0442\u043e\u0442 \u0442\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u043e\u0432\n\u043d\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443";this.drawTextAtCenter(s,32)}}}}},{key:"drawTextAtCenter",value:function(e,t){if(this.ctx&&this.canvas){var n=this.canvas.width,s=this.canvas.height;this.ctx.textAlign="center",this.ctx.font="".concat(t,"px Arial");for(var r=e.split("\n"),i=-r.length*t*.8/2,a=r.length*t*.8,c=0;c<r.length;c++)this.ctx.fillText(r[c],n/2,s/2+i+a*c)}}},{key:"createNewData",value:function(){return{height:0,width:0,objects:[{type:"qr",x:0,y:0,w:0,h:0,c:"#000000"},{type:"name",x:0,y:0,w:0,h:0,c:"#000000"},{type:"promo",x:0,y:0,w:0,h:0,c:"#000000"}]}}}],[{key:"renderQRCode",value:function(e,t,n){It.toDataURL(e,{errorCorrectionLevel:"H",scale:10,margin:2,color:{light:"#ffffff00",dark:t}},(function(e,t){e&&console.error(e);var s=new Image;s.addEventListener("load",(function(){n(s)})),s.src=t}))}}]),e}(),Mt=function(){function e(t,n,s,r,i,a,c){var o=this;(0,u.Z)(this,e),this.img=t,this.data=n,this.reRenderQR=s,this.setCursor=r,this.setInspector=i,this.imgqr=a,this.viewMode=c,this.transform={x:0,y:0,s:1},this.moving={sx:0,sy:0,vx:0,vy:0,vw:0,vh:0,mode:null},this.drawing={sx:0,sy:0,ex:0,ey:0,active:!1,type:null},this.resizing={dir:[0,0],keepAspect:!1,aspect:1},this.canvasSize={w:0,h:0},this.selected=-1,this.selectionBorder=16,this.ticket=null,this.inspectorInput=function(e,t){if(!(o.selected<0)){var n=o.data.objects[o.selected];if(["x","y","w","h"].includes(e)){var s=e,r=t;n[s]=Math.max(r,0),"qr"==n.type&&("w"==s&&(n.h=n.w),"h"==s&&(n.w=n.h))}else"c"==e&&(n[e]=t,"qr"==n.type&&o.reRenderQR())}},n.width=t.width,n.height=t.height}return(0,o.Z)(e,[{key:"fitToView",value:function(){var e=this.viewMode?0:100;this.transform.s=Math.min((this.canvasSize.w-e)/this.img.width,(this.canvasSize.h-e)/this.img.height),this.transform.x=(this.canvasSize.w-this.img.width*this.transform.s)/2,this.transform.y=(this.canvasSize.h-this.img.height*this.transform.s)/2,this.restrictView()}},{key:"setCanvasSize",value:function(e){this.canvasSize=e}},{key:"setQr",value:function(e){this.imgqr=e}},{key:"setViewTicket",value:function(e){this.ticket=e}},{key:"draw",value:function(e){e.save(),e.translate(this.transform.x,this.transform.y),e.scale(this.transform.s,this.transform.s),e.fillStyle="black",e.fillRect(0,0,this.img.width,this.img.height),e.drawImage(this.img,0,0);for(var t=0;t<this.data.objects.length;t++){var n=this.data.objects[t];if(e.fillStyle=n.c,"qr"==n.type)this.imgqr.complete&&0!=this.imgqr.naturalHeight?e.drawImage.apply(e,[this.imgqr].concat((0,J.Z)(Dt(n)))):e.fillRect.apply(e,(0,J.Z)(Dt(n)));else if("name"==n.type||"promo"==n.type){e.font="".concat(n.h,"px Arial");var s=this.ticket?"name"==n.type?this.ticket.personName||"":this.ticket.promocode||"":"name"==n.type?"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432\u0438\u0447 \u592a\u9633":"\u041d\u0435\u0443\u0442\u043e\u043c\u0438\u043c\u044b\u0439";e.fillText(s,n.x,n.y+.8*n.h,n.w)}else e.fillRect.apply(e,(0,J.Z)(Dt(n)));this.selected==t&&(e.strokeStyle="orange",e.lineWidth=4/this.transform.s,e.strokeRect.apply(e,(0,J.Z)(Dt(n))))}if(this.drawing.active){e.strokeStyle="white",e.lineWidth=4/this.transform.s;var r=this.drawing.ex-this.drawing.sx,i=this.drawing.ey-this.drawing.sy;"qr"==this.drawing.type&&(i=r),e.strokeRect(this.drawing.sx,this.drawing.sy,r,i),e.strokeStyle="black",e.lineWidth=2/this.transform.s,e.strokeRect(this.drawing.sx,this.drawing.sy,r,i)}e.restore()}},{key:"drawObject",value:function(e){this.drawing.type=e}},{key:"resetZoom",value:function(){this.transform.s=1,this.restrictView()}},{key:"mouseDown",value:function(e,t,n){if(this.moving.sx=e,this.moving.sy=t,2==n)return this.moving.vx=this.transform.x,this.moving.vy=this.transform.y,this.moving.mode="view",void this.setCursor("move");if(0==n){if(this.drawing.type){var s=this.pointToWorld(e,t),r=(0,Q.Z)(s,2);return this.drawing.sx=r[0],this.drawing.sy=r[1],void(this.drawing.active=!0)}for(var i=0;i<this.data.objects.length;i++){var a=this.data.objects[i],c=this.pointToWorld(e,t),o=(0,Q.Z)(c,2),u=o[0],l=o[1],d=!1;if(this.selected==i&&(this.resizing.dir=Lt(u,l,a,this.selectionBorder/this.transform.s),d=0!=this.resizing.dir[0]||0!=this.resizing.dir[1],this.resizing.aspect=a.h/a.w,this.resizing.keepAspect="qr"==a.type),Qt(u,l,a)||d)return this.selected=i,this.setInspector(a),this.moving.vx=a.x,this.moving.vy=a.y,this.moving.vw=a.w,this.moving.vh=a.h,this.moving.mode=d?"resize":"obj",this.setCursor(d?Et(this.resizing.dir):"move"),!0}var h=this.selected>=0;return this.selected=-1,this.setInspector(null),h}}},{key:"mouseMove",value:function(e,t){if("view"==this.moving.mode)return this.transform.x=this.moving.vx+(e-this.moving.sx),this.transform.y=this.moving.vy+(t-this.moving.sy),this.restrictView(),!0;if("obj"==this.moving.mode&&this.selected>=0){var n=this.data.objects[this.selected];return n.x=this.moving.vx+(e-this.moving.sx)/this.transform.s,n.y=this.moving.vy+(t-this.moving.sy)/this.transform.s,n.x=Math.round(n.x),n.y=Math.round(n.y),this.setInspector(n),!0}if("resize"==this.moving.mode&&this.selected>=0){var s=this.data.objects[this.selected],r=(e-this.moving.sx)/this.transform.s,i=(t-this.moving.sy)/this.transform.s,a=(0,Q.Z)(this.resizing.dir,2),c=a[0],o=a[1];return this.resizing.keepAspect?(c>0&&(s.w=this.moving.vw+r,s.h=s.w*this.resizing.aspect,o<0&&(s.y=this.moving.vy-(s.h-this.moving.vh)),0==o&&(s.y=this.moving.vy-(s.h-this.moving.vh)/2)),c<0&&(s.x=this.moving.vx+r,s.w=this.moving.vw-r,s.h=s.w*this.resizing.aspect,o<0&&(s.y=this.moving.vy-(s.h-this.moving.vh)),0==o&&(s.y=this.moving.vy-(s.h-this.moving.vh)/2)),0==c&&(o>0&&(s.h=this.moving.vh+i),o<0&&(s.y=this.moving.vy+i,s.h=this.moving.vh-i),s.w=s.h/this.resizing.aspect,s.x=this.moving.vx-(s.w-this.moving.vw)/2)):(c>0&&(s.w=this.moving.vw+r),c<0&&(s.x=this.moving.vx+r,s.w=this.moving.vw-r),o>0&&(s.h=this.moving.vh+i),o<0&&(s.y=this.moving.vy+i,s.h=this.moving.vh-i)),s.w=Math.max(s.w,5),s.h=Math.max(s.h,5),s.x=Math.round(s.x),s.y=Math.round(s.y),s.w=Math.round(s.w),s.h=Math.round(s.h),this.setInspector(s),!0}if(this.drawing.active){var u=this.pointToWorld(e,t),l=(0,Q.Z)(u,2);return this.drawing.ex=l[0],this.drawing.ey=l[1],!0}if(this.selected>=0){var d=this.pointToWorld(e,t),h=(0,Q.Z)(d,2),f=Lt(h[0],h[1],this.data.objects[this.selected],this.selectionBorder/this.transform.s);0!=f[0]||0!=f[1]?this.setCursor(Et(f)):this.setCursor("default")}}},{key:"mouseUp",value:function(e,t,n){var s=this;if(this.moving.mode=null,this.setCursor("default"),this.drawing.active){var r=this.pointToWorld(e,t),i=(0,Q.Z)(r,2);this.drawing.ex=i[0],this.drawing.ey=i[1];var a=this.data.objects.find((function(e){return e.type==s.drawing.type}));return!!a&&(a.x=this.drawing.sx,a.y=this.drawing.sy,a.w=this.drawing.ex-this.drawing.sx,a.h=this.drawing.ey-this.drawing.sy,a.w<0&&(a.x+=a.w,a.w*=-1),a.h<0&&(a.y+=a.h,a.h*=-1),a.x=Math.round(a.x),a.y=Math.round(a.y),a.w=Math.round(a.w),a.h=Math.round(a.h),this.drawing.active=!1,this.drawing.type=null,"qr"==a.type&&(a.h=a.w),!0)}}},{key:"wheel",value:function(e,t,n){var s=(e-this.transform.x)/this.transform.s,r=(t-this.transform.y)/this.transform.s;n>0?this.transform.s/=1.1:this.transform.s*=1.1;return this.transform.s=Math.max(this.transform.s,Math.min((this.canvasSize.w-200)/this.img.width,(this.canvasSize.h-200)/this.img.height)),this.transform.x=e-s*this.transform.s,this.transform.y=t-r*this.transform.s,this.restrictView(),!0}},{key:"restrictView",value:function(){var e=100,t=this.img.width*this.transform.s,n=this.img.height*this.transform.s;t>this.canvasSize.w?this.transform.x=Math.min(Math.max(this.transform.x,-t+this.canvasSize.w-e),e):this.transform.x=Math.min(Math.max(this.transform.x,-t+e),this.canvasSize.w-e),n>this.canvasSize.h?this.transform.y=Math.min(Math.max(this.transform.y,-n+this.canvasSize.h-e),e):this.transform.y=Math.min(Math.max(this.transform.y,-n+e),this.canvasSize.h-e)}},{key:"pointToWorld",value:function(e,t){return[(e-this.transform.x)/this.transform.s,(t-this.transform.y)/this.transform.s]}},{key:"pointToScreen",value:function(e,t){return[e*this.transform.s+this.transform.x,t*this.transform.s+this.transform.y]}}]),e}();function Qt(e,t,n){return e>n.x&&e<n.x+n.w&&t>n.y&&t<n.y+n.h}function Lt(e,t,n,s){var r=[0,0];return Qt(e,t,{x:n.x-s,y:n.y-s,w:n.w+2*s,h:n.h+2*s})?(Math.abs(e-n.x)<=s&&(r[0]=-1),Math.abs(e-(n.x+n.w))<=s&&(r[0]=1),Math.abs(t-n.y)<=s&&(r[1]=-1),Math.abs(t-(n.y+n.h))<=s&&(r[1]=1),r):r}function Et(e){var t=(0,Q.Z)(e,2),n=t[0],s=t[1];return 0==n?0==s?"default":"n-resize":n>0?0==s?"e-resize":s>0?"nw-resize":"ne-resize":n<0?0==s?"e-resize":s>0?"ne-resize":"nw-resize":"default"}function Dt(e){return[e.x,e.y,e.w,e.h]}function Rt(e){var t=e.editor,n=(0,N.useState)(0),s=(0,Q.Z)(n,2)[1],r=(0,N.useState)(null),i=(0,Q.Z)(r,2),a=i[0],c=i[1],o=function(){return s((function(e){return e+1}))};return t.setInspector((function(e){c(e),o()})),(0,I.jsxs)("div",{className:M(Nt.inspector,a&&Nt.inspector_open),children:[(0,I.jsx)("h2",{children:{qr:"QR \u043a\u043e\u0434",name:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",promo:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434","":""}[(null===a||void 0===a?void 0:a.type)||""]}),(0,I.jsxs)("div",{className:Nt.fields,children:[(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"X:"}),(0,I.jsx)("input",{type:"number",value:(null===a||void 0===a?void 0:a.x)||0,onInput:function(e){t.inspectorInput("x",e.target.valueAsNumber),o()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"Y:"}),(0,I.jsx)("input",{type:"number",value:(null===a||void 0===a?void 0:a.y)||0,onInput:function(e){t.inspectorInput("y",e.target.valueAsNumber),o()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"\u0428\u0438\u0440\u0438\u043d\u0430:"}),(0,I.jsx)("input",{type:"number",value:(null===a||void 0===a?void 0:a.w)||0,onInput:function(e){t.inspectorInput("w",e.target.valueAsNumber),o()}})]}),(0,I.jsxs)("label",{children:[(0,I.jsx)("span",{children:"\u0412\u044b\u0441\u043e\u0442\u0430:"}),(0,I.jsx)("input",{type:"number",value:(null===a||void 0===a?void 0:a.h)||0,onInput:function(e){t.inspectorInput("h",e.target.valueAsNumber),o()}})]})]}),(0,I.jsxs)("label",{className:Nt.colorInput,children:[(0,I.jsx)("span",{children:"\u0426\u0432\u0435\u0442:"}),(0,I.jsx)("input",{type:"color",value:(null===a||void 0===a?void 0:a.c)||"#000000",onInput:function(e){t.inspectorInput("c",e.target.value),o()}})]})]})}function zt(e){var t,n=e.typeId,s=e.eventId,i=e.open,c=e.close,o=Ft(),u=_t(n,c),l=bt(n),d=(0,N.useRef)(null),h=(0,N.useState)(!1),f=(0,Q.Z)(h,2),v=f[0],p=f[1],x=(0,N.useState)(!1),m=(0,Q.Z)(x,2),j=m[0],g=m[1],y=null==(null===(t=l.data)||void 0===t?void 0:t.imageId);return(0,N.useEffect)((function(){i||(u.reset(),p(!1),g(!1),o.reset())}),[i,o]),(0,N.useEffect)((function(){var e;i&&l.data&&(o.setData(l.data.imageId,JSON.parse(JSON.stringify(l.data.pattern))),p(!(null!==(e=l.data)&&void 0!==e&&e.imageId)))}),[l.data,i,o]),(0,N.useEffect)((function(){d.current&&o.setCanvas(d.current)}),[d,o]),(0,I.jsxs)(Ce,{open:i,close:c,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u043e\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:[Xe(u),l.isLoading&&(0,I.jsx)(O,{}),u.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)("div",{className:Nt.root,children:[(0,I.jsxs)("div",{className:Nt.canvas,children:[(0,I.jsx)("canvas",{ref:d}),(0,I.jsx)(Rt,{editor:o})]}),(0,I.jsxs)("div",{className:Nt.panel,children:[(0,I.jsx)("span",{children:"\u041d\u0430\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442\u044b:"}),(0,I.jsx)("button",{className:"button",onClick:function(){return o.drawObject("qr")},children:"QR \u043a\u043e\u0434"}),(0,I.jsx)("button",{className:"button",onClick:function(){return o.drawObject("name")},children:"\u0418\u043c\u044f \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f"}),(0,I.jsx)("button",{className:"button",onClick:function(){return o.drawObject("promo")},children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsx)("span",{className:Nt.br}),(0,I.jsx)("button",{className:"button icon",onClick:function(){return o.fitZoom()},children:"fit_screen"}),(0,I.jsx)("button",{className:"button",onClick:function(){return o.resetZoom()},children:"1:1"})]}),(0,I.jsxs)("div",{className:Nt.footer,children:[(0,I.jsx)("div",{children:v?(0,I.jsxs)(I.Fragment,{children:[!y&&(0,I.jsx)("button",{className:"button",onClick:function(){return p(!1)},children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,I.jsx)("label",{children:(0,I.jsx)("input",{type:"file",onChange:function(e){e.target.files&&e.target.files[0]&&(o.setNewImage(e.target.files[0]),p(!1),g(!0))},accept:"image/png, image/jpeg, image/gif"})})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("button",{className:"button",onClick:function(){return p(!0)},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"}),j&&!y&&(0,I.jsx)("button",{className:"button",onClick:function(){var e;g(!1),o.setImage((null===(e=l.data)||void 0===e?void 0:e.imageId)||null)},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438"})]})}),(0,I.jsxs)("div",{children:[(0,I.jsx)("button",{className:"button",onClick:function(){return null===c||void 0===c?void 0:c()},children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getData("ticket_".concat(n),s);case 2:t=e.sent,u.mutate(t);case 4:case"end":return e.stop()}}),e)}))),children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]})]})]})}function Ft(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,N.useRef)(new At(!1,e));return(0,N.useEffect)((function(){return t.current=new At(!0,e),function(){return t.current.destroy()}}),[e]),t.current}function Tt(e){var t=e.ticket,n=Ft(!0),s=bt((null===t||void 0===t?void 0:t.typeId)||-1),r=(0,N.useRef)(null);return(0,N.useEffect)((function(){t||n.reset()}),[t,n]),(0,N.useEffect)((function(){t&&s.data&&(n.setData(s.data.imageId,JSON.parse(JSON.stringify(s.data.pattern))),n.setViewTicket(t))}),[s.data,t,n]),(0,N.useEffect)((function(){r.current&&n.setCanvas(r.current)}),[r,n]),(0,I.jsxs)("div",{style:{minWidth:400,minHeight:300},children:[s.isLoading&&(0,I.jsx)(O,{}),(0,I.jsx)("canvas",{ref:r})]})}function Ut(e){var t=e.ticket,n=e.close;return(0,I.jsx)(Ce,{open:!!t,close:n,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u0438\u043b\u0435\u0442\u0430",children:(0,I.jsx)(Tt,{ticket:t})})}function Ot(e){var t,n,s=e.eventId,r=e.open,i=e.close,a=(0,N.useState)(0),c=(0,Q.Z)(a,2)[1],o=(0,N.useState)(new Map),u=(0,Q.Z)(o,2),l=u[0],d=u[1],h=(0,N.useState)([]),f=(0,Q.Z)(h,2),v=f[0],p=f[1],x=mt(s),m=gt(s,i);return(0,N.useEffect)((function(){d(new Map),p([]),c(0),r||m.reset()}),[r]),(0,I.jsxs)(Ce,{open:r,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0432\u0438\u0434\u043e\u0432 \u0431\u0438\u043b\u0435\u0442\u043e\u0432",children:[Xe(m),x.isLoading&&(0,I.jsx)(O,{}),m.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){(l.size>0||v.length>0)&&m.mutate([].concat((0,J.Z)(v.filter((function(e){return"add"==e.action}))),(0,J.Z)(Array.from(l.values()))))},children:[null===(t=x.data)||void 0===t||null===(n=t.filter((function(e){var t;return"delete"!=(null===(t=l.get(e.id))||void 0===t?void 0:t.action)})))||void 0===n?void 0:n.map((function(e){var t;return(0,I.jsxs)(K,{children:[(0,I.jsx)("input",{type:"text",required:!0,value:(null===(t=l.get(e.id))||void 0===t?void 0:t.name)||e.name,onChange:function(t){l.set(e.id,{id:e.id,name:t.target.value,action:"update"}),c((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){l.set(e.id,{id:e.id,name:"",action:"delete"}),c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},e.id)})),v.filter((function(e){return"add"==e.action})).map((function(e,t){return(0,I.jsxs)(K,{children:[(0,I.jsx)("input",{type:"text",required:!0,onChange:function(e){v[t].name=e.target.value,c((function(e){return e+1}))}}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){v[t].action="delete",c((function(e){return e+1}))},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]},"new"+t)})),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){v.push({name:"",action:"add"}),c((function(e){return e+1}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function qt(e){var t,n,s=e.eventId,r=e.open,i=e.close,a=(0,N.useRef)(null),c=(0,N.useRef)(null),o=_e(s,i),u=xe(s);return(0,N.useEffect)((function(){r||o.reset()}),[r]),(0,I.jsxs)(Ce,{open:r,close:i,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",children:[Xe(o),u.isLoading&&(0,I.jsx)(O,{}),o.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=a.current)||void 0===e?void 0:e.value,s=null===(t=c.current)||void 0===t?void 0:t.value;n&&s&&o.mutate({date:s,name:n})},children:[(0,I.jsx)(K,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,I.jsx)("input",{ref:a,type:"text",required:!0,defaultValue:null===(t=u.data)||void 0===t?void 0:t.name})}),(0,I.jsx)(K,{label:"\u0414\u0430\u0442\u0430",children:(0,I.jsx)("input",{ref:c,type:"datetime-local",required:!0,defaultValue:null===(n=u.data)||void 0===n?void 0:n.date.toISOString().slice(0,-5)})}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Vt(e){var t,n,s,r=e.eventId,i=e.open,a=e.close,c=nt(r),o=$e(),u=(0,N.useState)([]),l=(0,Q.Z)(u,2),d=l[0],h=l[1],f=(0,N.useState)(-1),v=(0,Q.Z)(f,2),p=v[0],x=v[1],m=rt(r,a);return(0,N.useEffect)((function(){c.isSuccess&&h(c.data.map((function(e){return e.id})))}),[c.isSuccess,c.data]),(0,N.useEffect)((function(){i&&c.isSuccess&&h(c.data.map((function(e){return e.id}))),i&&x(-1),i||m.reset()}),[i,c.isSuccess,c.data]),(0,I.jsxs)(Ce,{open:i,close:a,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a\u043b\u0435\u0440\u043a\u043e\u0432",children:[Xe(c),Xe(o),Xe(m),c.isLoading&&(0,I.jsx)(O,{}),o.isLoading&&(0,I.jsx)(O,{}),m.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){m.mutate(d)},children:[d.map((function(e){var t,n=null===(t=o.data)||void 0===t?void 0:t.find((function(t){return t.id==e}));return(0,I.jsxs)(K,{children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{children:null===n||void 0===n?void 0:n.name}),(0,I.jsxs)("span",{style:{marginLeft:"1em",color:"gray"},children:["(",null===n||void 0===n?void 0:n.login,")"]})]}),(0,I.jsx)("button",{type:"button",className:"button button_small",onClick:function(){h((function(t){return t.filter((function(t){return t!=e}))}))},children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"})]},e)})),(0,I.jsxs)("select",{onChange:function(e){return x(parseInt(e.target.value))},children:[(0,I.jsx)("option",{value:"-1",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043b\u0435\u0440\u043a\u0430"}),null===(t=o.data)||void 0===t?void 0:t.filter((function(e){return!d.includes(e.id)})).map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),(0,I.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(n=o.data)||void 0===n?void 0:n.filter((function(e){return!d.includes(e.id)})).length),onClick:function(){p>=0&&(h((function(e){return[].concat((0,J.Z)(e),[p])})),x(-1))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f"}),(0,I.jsx)("button",{type:"button",className:"button button_small",disabled:0==(null===(s=o.data)||void 0===s?void 0:s.filter((function(e){return!d.includes(e.id)})).length),onClick:function(){h((function(e){var t;return(null===(t=o.data)||void 0===t?void 0:t.map((function(e){return e.id})))||e}))},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0441\u0435\u0445"}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function Pt(e){var t=e.code,n=e.setCode,s=e.title,r=(0,N.useState)(""),i=(0,Q.Z)(r,2),a=i[0],c=i[1];return(0,N.useEffect)((function(){t&&(c(""),It.toDataURL(t,{errorCorrectionLevel:"H",scale:10},(function(e,t){return c(t)})))}),[t]),(0,I.jsx)(Ce,{open:!!t,close:function(){return n("")},title:s,children:(0,I.jsx)("img",{src:a,alt:t,style:{width:"100%"}})})}function Wt(){var e,t,n,r=(0,N.useState)(!1),i=(0,Q.Z)(r,2),a=i[0],c=i[1],o=(0,N.useState)(!1),u=(0,Q.Z)(o,2),l=u[0],d=u[1],f=(0,N.useState)(!1),v=(0,Q.Z)(f,2),p=v[0],x=v[1],m=(0,N.useState)(!1),j=(0,Q.Z)(m,2),g=j[0],y=j[1],b=(0,N.useState)(-1),w=(0,Q.Z)(b,2),_=w[0],Z=w[1],S=(0,N.useState)(!1),C=(0,Q.Z)(S,2),A=C[0],M=C[1],E=(0,N.useState)(null),D=(0,Q.Z)(E,2),R=D[0],z=D[1],F=(0,N.useState)(""),T=(0,Q.Z)(F,2),U=T[0],q=T[1],V=(0,s.s0)(),W=(0,s.UO)().eventId,B=xe(W),Y=mt(W),J=nt(W),G=Te(W),H=k("add_ticket"),K=k("change_ticket_types"),$=k("change_event"),ee=k("get_staff_event"),te=k("change_staff_event"),ne=k("delete_event");X((null===(e=B.data)||void 0===e?void 0:e.name)||"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"),(0,N.useEffect)((function(){B.error instanceof h&&B.error.message.includes("not found")&&V("/not_found",{replace:!0})}),[B.error,V]);var se="/events";return(0,I.jsxs)(I.Fragment,{children:[B.isLoading&&(0,I.jsx)(P,{backLink:se,children:(0,I.jsx)(O,{})}),Xe(B,(function(e){return(0,I.jsx)(P,{backLink:se,centered:!0,children:e})})),B.data&&(0,I.jsxs)(P,{backLink:se,centeredPage:!0,gap:"1rem",children:[(0,I.jsxs)("h1",{children:["\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435: ",B.data.name]}),(0,I.jsxs)("div",{className:xt.card,children:[(0,I.jsxs)("div",{className:xt.card__header,children:[(0,I.jsx)("h2",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),$&&(0,I.jsx)("button",{className:"button",onClick:function(){return x(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(qt,{eventId:W,open:p,close:function(){return x(!1)}})]}),(0,I.jsxs)("div",{className:xt.card__body,children:[(0,I.jsxs)("div",{children:["\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: ",B.data.name]}),(0,I.jsxs)("div",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f: ",ce(B.data.date)]})]})]}),(0,I.jsxs)("div",{className:xt.line,children:[(0,I.jsx)(L.rU,{to:"/scanner/".concat(W),className:"button",children:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,I.jsx)("button",{className:"button",onClick:function(){return q(new URL("/scanner/".concat(W),window.location.href).href)},children:"Qr \u043a\u043e\u0434 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440"}),(0,I.jsx)(Pt,{title:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0441\u043a\u0430\u043d\u0435\u0440",code:U,setCode:q})]}),H&&(0,I.jsx)("button",{className:"button",onClick:function(){return c(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,I.jsx)(Zt,{eventId:W,open:a,close:function(){return c(!1)},setTicet:z}),(0,I.jsx)(Ut,{ticket:R,close:function(){return z(null)}}),(0,I.jsx)(L.rU,{to:"/events/".concat(W,"/tickets"),className:"button",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),(0,I.jsxs)("div",{className:xt.card,children:[(0,I.jsxs)("div",{className:xt.card__header,children:[(0,I.jsx)("h2",{children:"\u0412\u0438\u0434\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"}),K&&(0,I.jsx)("button",{className:"button",onClick:function(){return y(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(Ot,{eventId:W,open:g,close:function(){return y(!1)}}),(0,I.jsx)(zt,{typeId:_,eventId:parseInt(W),open:_>=0,close:function(){return Z(-1)}})]}),(0,I.jsxs)("div",{className:xt.card__body,children:[Y.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Xe(Y,(function(e){return(0,I.jsx)("div",{children:e})})),null===(t=Y.data)||void 0===t?void 0:t.map((function(e){var t,n;return(0,I.jsxs)("div",{children:[(0,I.jsx)("button",{className:"button button_small icon",style:{marginRight:"0.5em"},onClick:function(){return Z(e.id)},children:"edit_square"}),(0,I.jsx)("span",{children:e.name}),(0,I.jsx)("span",{children:" -> "}),(0,I.jsx)("span",{children:(null===(t=G.data)||void 0===t||null===(n=t.find((function(t){return t.typeId==e.id})))||void 0===n?void 0:n.count)||"0"})]},e.id)})),G.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Xe(G,(function(e){return(0,I.jsx)("div",{children:e})})),G.data&&(0,I.jsxs)("div",{style:{fontWeight:"bold"},children:[(0,I.jsx)("span",{children:"\u0412\u0441\u0435\u0433\u043e -> "}),(0,I.jsx)("span",{children:G.data.reduce((function(e,t){return e+t.count}),0)})]})]})]}),ee&&(0,I.jsxs)("div",{className:xt.card,children:[(0,I.jsxs)("div",{className:xt.card__header,children:[(0,I.jsx)("h2",{children:"\u041a\u043b\u0435\u0440\u043a\u0438"}),te&&(0,I.jsx)("button",{className:"button",onClick:function(){return M(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),(0,I.jsx)(Vt,{eventId:W,open:A,close:function(){return M(!1)}})]}),(0,I.jsxs)("div",{className:xt.card__body,children:[J.isLoading&&(0,I.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Xe(J,(function(e){return(0,I.jsx)("div",{children:e})})),null===(n=J.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("div",{children:e.name},e.id)}))]})]}),(0,I.jsx)("div",{className:xt.gap}),(0,I.jsx)("div",{className:xt.right,children:ne&&(0,I.jsx)("button",{className:"button",onClick:function(){return d(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})}),(0,I.jsx)(vt,{title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u044f\u0442\u0438\u044f",onSuccess:function(){return V("/events")},mutationFn:Ze,itemId:W,open:l,close:function(){return d(!1)}})]})]})}var Bt={center:"styles_center__9dZ9p",right:"styles_right__Zz+YX"};function Yt(e){var t,n,s,r=e.ticket,i=e.eventId,a=e.close,o=e.setTicket,u=(0,N.useState)(!1),l=(0,Q.Z)(u,2),d=l[0],h=l[1],f=(0,N.useState)(!0),v=(0,Q.Z)(f,2),p=v[0],x=v[1],m=(0,N.useState)(-1),j=(0,Q.Z)(m,2),g=j[0],y=j[1],b=(0,N.useState)(""),w=(0,Q.Z)(b,2),_=w[0],Z=w[1],S=(0,N.useState)(""),C=(0,Q.Z)(S,2),A=C[0],M=C[1],L=(0,N.useState)(""),E=(0,Q.Z)(L,2),D=E[0],R=E[1],z=(0,N.useState)(""),F=(0,Q.Z)(z,2),T=F[0],U=F[1],q=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:Ee,onSuccess:function(n){var s;"success"==(null===(s=t.getQueryState(["tickets","".concat(n.eventId)]))||void 0===s?void 0:s.status)&&t.setQueryData(["tickets","".concat(n.eventId)],(function(e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id==n.id?n:e})))||[]})),null===e||void 0===e||e(n)}})}((function(e){o(e),a()})),V=mt(i),P=k("delete_ticket"),W=!!r;return(0,N.useEffect)((function(){var e,t;W&&(y((null===(e=V.data)||void 0===e||null===(t=e.find((function(e){return e.name==r.type})))||void 0===t?void 0:t.id)||-1),Z(r.personName||""),M(r.personLink||""),R(r.promocode||""),U(r.code||""));W||(q.reset(),x(!0))}),[W,r,V.data]),(0,I.jsxs)(Ce,{open:W,close:a,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",children:[V.isLoading&&(0,I.jsx)(O,{}),Xe(q),q.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){r&&g>=0&&_&&q.mutate({ticketId:r.id,data:{typeId:g,personName:_,personLink:A,promocode:D,code:p?r.code:T}})},children:[(0,I.jsxs)(K,{label:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430",children:[(0,I.jsx)("select",{value:g,onChange:function(e){var t,n;return y((null===(t=V.data)||void 0===t||null===(n=t[e.target.selectedIndex])||void 0===n?void 0:n.id)||-1)},disabled:0==(null===(t=V.data)||void 0===t?void 0:t.length),required:!0,children:null===(n=V.data)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)("option",{value:e.id,children:e.name},e.id)}))}),0==(null===(s=V.data)||void 0===s?void 0:s.length)&&(0,I.jsx)("h4",{children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0442\u0438\u043f\u044b \u0431\u0438\u043b\u0435\u0442\u043e\u0432"})]}),(0,I.jsx)(K,{label:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c",children:(0,I.jsx)("input",{value:_,onChange:function(e){return Z(e.target.value)},type:"text",required:!0})}),(0,I.jsx)(K,{label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f",children:(0,I.jsx)("input",{value:A,onChange:function(e){return M(e.target.value)},type:"text"})}),(0,I.jsx)(K,{label:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434",children:(0,I.jsx)("input",{value:D,onChange:function(e){return R(e.target.value)},type:"text"})}),(0,I.jsxs)("label",{children:[(0,I.jsx)("input",{type:"checkbox",checked:!p,onChange:function(e){return x(!e.target.checked)}}),(0,I.jsx)("span",{style:{color:p?"gray":"darkred"},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u043e\u0434"})]}),!p&&(0,I.jsxs)(K,{label:"\u041a\u043e\u0434 \u0431\u0438\u043b\u0435\u0442\u0430 (\u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u0432\u043e\u0434)",children:[(0,I.jsx)("div",{style:{color:"darkred",fontSize:"0.9rem"},children:"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0431\u0435\u0437 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438!"}),(0,I.jsx)("input",{value:T,onChange:function(e){return U(e.target.value)},type:"text"})]}),(0,I.jsx)("button",{type:"submit",className:"button button_small",disabled:q.isLoading||!V.data||0==V.data.length,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]}),P&&(0,I.jsx)("button",{className:"button button_danger button_small",onClick:function(){return h(!0)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0431\u0438\u043b\u0435\u0442"}),(0,I.jsx)(vt,{itemId:i,mutatateParams:(null===r||void 0===r?void 0:r.id)||0,title:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0431\u0438\u043b\u0435\u0442\u0430",onSuccess:a,mutationFn:Re,open:d,close:function(){return h(!1)}})]})}function Jt(){var e,t,n=(0,N.useState)(!1),r=(0,Q.Z)(n,2),i=r[0],a=r[1],c=(0,N.useState)(null),o=(0,Q.Z)(c,2),u=o[0],l=o[1],d=(0,N.useState)(null),f=(0,Q.Z)(d,2),v=f[0],p=f[1],x=(0,s.s0)(),m=(0,s.UO)().eventId,j=xe(m),g=Ie(m),y=k("add_ticket"),b=k("change_ticket");X([null===(e=j.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]),(0,N.useEffect)((function(){j.error instanceof h&&j.error.message.includes("not found")&&x("/not_found",{replace:!0})}),[j.error,x]);var w="/events/".concat(m);return(0,I.jsxs)(I.Fragment,{children:[(j.isLoading||g.isLoading)&&(0,I.jsx)(P,{backLink:w,children:(0,I.jsx)(O,{})}),Xe(j),Xe(g),j.data&&g.isSuccess&&(0,I.jsxs)(P,{backLink:w,centeredPage:!0,gap:"1rem",children:[(0,I.jsxs)("h1",{children:["\u0411\u0438\u043b\u0435\u0442\u044b: ",j.data.name]}),(0,I.jsxs)("div",{className:Bt.right,children:[(0,I.jsx)(L.rU,{target:"_blank",to:"/events/".concat(m,"/print_tickets"),className:"button",children:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c"}),y&&(0,I.jsx)("button",{className:"button",onClick:function(){return a(!0)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,I.jsx)(Zt,{eventId:m,open:i,close:function(){return a(!1)},setTicet:l})]}),(0,I.jsxs)("table",{children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:"11em"},children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsxs)("th",{children:[(0,I.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,I.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]}),(0,I.jsx)("th",{children:"\u0411\u0438\u043b\u0435\u0442"}),b&&(0,I.jsx)("th",{children:"\u0420\u0435\u0434"})]})}),(0,I.jsx)("tbody",{children:null===(t=g.data)||void 0===t?void 0:t.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personLink?(0,I.jsx)("a",{href:e.personLink,children:e.personName}):e.personName}),(0,I.jsx)("td",{style:{color:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?"red":""},children:e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:Bt.center,children:e.scanned?"\u2713":"\u2716"}),(0,I.jsx)("td",{className:Bt.center,children:(0,I.jsx)("button",{className:"button button_small",onClick:function(){return l(e)},children:"\u0411\u0438\u043b\u0435\u0442"})}),b&&(0,I.jsx)("td",{className:Bt.center,children:(0,I.jsx)("button",{className:"button button_small",onClick:function(){return p(e)},children:"\u0420\u0435\u0434"})})]},e.id)}))})]}),(0,I.jsx)(Ut,{ticket:u,close:function(){return l(null)}}),(0,I.jsx)(Yt,{ticket:v,eventId:m,close:function(){return p(null)},setTicket:l})]})]})}var Xt={root:"styles_root__QCWgG",table:"styles_table__Klrj7",center:"styles_center__pcMYz",mark:"styles_mark__4aU1o"};function Gt(){var e,t=(0,s.UO)().eventId,n=xe(t),r=Ie(t);X([null===(e=n.data)||void 0===e?void 0:e.name,"\u0411\u0438\u043b\u0435\u0442\u044b"]);var a=(0,N.useMemo)((function(){if(!r.data||!n.data)return[!1,""];var e=Be(n.data.id,n.data.date);return[r.data.every((function(t){return t.code.startsWith(e)})),e]}),[r.data,n.data]),c=(0,Q.Z)(a,2),o=c[0],u=c[1];return(0,N.useEffect)((function(){if(n.isSuccess&&r.isSuccess){var e=setTimeout((function(){return window.print()}),1e3);return function(){return clearTimeout(e)}}}),[n.isSuccess,r.isSuccess]),(0,I.jsxs)(I.Fragment,{children:[(n.isLoading||r.isLoading)&&(0,I.jsx)(O,{}),Xe(n),Xe(r),n.isSuccess&&r.isSuccess&&(0,I.jsx)("div",{className:Xt.root,children:(0,I.jsxs)("table",{className:Xt.table,children:[(0,I.jsxs)("thead",{children:[(0,I.jsx)("tr",{children:(0,I.jsxs)("th",{colSpan:5,children:[(0,I.jsx)("span",{children:n.data.name}),o&&(0,I.jsx)("span",{style:{marginLeft:"1rem"},children:"|"}),o&&(0,I.jsxs)("span",{style:{marginLeft:"1rem"},children:["\u0412\u0441\u0435 \u043a\u043e\u0434\u044b \u0434\u043e\u0436\u043d\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u0442\u044c\u0441\u044f \u0441 ",u]})]})}),(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{children:"\u041a\u043e\u0434"}),(0,I.jsx)("th",{children:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c"}),(0,I.jsx)("th",{children:"\u0422\u0438\u043f \u0431\u0438\u043b\u0435\u0442\u0430"}),(0,I.jsx)("th",{children:"\u041f\u0440\u043e\u043c\u043e\u043a\u043e\u0434"}),(0,I.jsxs)("th",{children:[(0,I.jsx)("div",{children:"\u0418\u0441\u043f\u043e\u043b\u044c"}),(0,I.jsx)("div",{children:"\u0437\u043e\u0432\u0430\u043d"})]})]})]}),(0,I.jsx)("tbody",{children:r.data.map((function(e){return o?(0,i.Z)((0,i.Z)({},e),{},{code:e.code.slice(u.length),sortV:e.code.slice(e.code.lastIndexOf("-"))}):(0,i.Z)((0,i.Z)({},e),{},{sortV:e.code})})).sort((function(e,t){return e.sortV>t.sortV?1:-1})).map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:e.code}),(0,I.jsx)("td",{children:e.personName}),(0,I.jsx)("td",{children:e.type.startsWith("<\u0423\u0434\u0430\u043b\u0451\u043d>")?e.type.slice(8):e.type}),(0,I.jsx)("td",{children:e.promocode}),(0,I.jsx)("td",{className:Xt.center,children:(0,I.jsx)("span",{className:Xt.mark,children:e.scanned&&"\u2713"})})]},e.id)}))})]})})]})}function Ht(){var e=(0,N.useState)(""),t=(0,Q.Z)(e,2),n=t[0],s=t[1],i=(0,N.useState)(""),c=(0,Q.Z)(i,2),o=c[0],u=c[1],l=(0,N.useRef)(null),d=(0,N.useRef)(null);return(0,I.jsxs)(P,{centered:!0,gap:"1rem",children:[(0,I.jsx)(L.rU,{to:"/users",className:"button",children:"Users"}),(0,I.jsx)(L.rU,{to:"/log",className:"button",children:"Log"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_errors");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,s(n),setTimeout((function(){var e,t,n,s;return null===(e=l.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=l.current)||void 0===n||null===(s=n.parentElement)||void 0===s?void 0:s.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),s(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log errors"}),(0,I.jsx)("button",{className:"button",onClick:(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("Loading"),e.prev=1,e.next=4,fetch("/api/debug/log_info");case 4:return t=e.sent,e.next=7,t.text();case 7:n=e.sent,u(n),setTimeout((function(){var e,t,n,s;return null===(e=d.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.scrollTo(0,null===(n=d.current)||void 0===n||null===(s=n.parentElement)||void 0===s?void 0:s.scrollHeight)}),150),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),u(JSON.stringify(e.t0));case 15:case"end":return e.stop()}}),e,null,[[1,12]])}))),children:"Log requests"}),(0,I.jsx)(Ce,{title:"logErrors",open:""!=n,close:function(){return s("")},children:(0,I.jsx)("pre",{ref:l,children:n})}),(0,I.jsx)(Ce,{title:"log",open:""!=o,close:function(){return u("")},children:(0,I.jsx)("pre",{ref:d,children:o})})]})}var Kt={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function $t(){var e;X("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");var t=(0,c.useQuery)("users",m);return(0,I.jsxs)(P,{centeredPage:!0,gap:8,children:[t.isLoading&&(0,I.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Xe(t),null===(e=t.data)||void 0===e?void 0:e.map((function(e){var n;return(0,I.jsxs)("div",{className:Kt.user,children:[(0,I.jsx)("input",{type:"checkbox",className:Kt.toggleInp,id:"user".concat(e.id)}),(0,I.jsxs)("label",{className:Kt.title,htmlFor:"user".concat(e.id),children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{children:e.login}),(0,I.jsx)("div",{style:{color:"blue"},children:e.id}),(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{children:e.name}),null!=e.bossId&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{children:"|"}),(0,I.jsx)("div",{style:{color:"#990099"},children:null===(n=t.data.find((function(t){return t.id==e.bossId})))||void 0===n?void 0:n.login})]})]}),(0,I.jsxs)("div",{children:[e.deleted&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,I.jsx)("div",{children:"|"})]}),(0,I.jsx)("span",{children:e.role}),(0,I.jsx)("div",{className:Kt.toggle})]})]}),(0,I.jsxs)("div",{className:Kt.userInfo,children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Operations"}),(0,I.jsx)("div",{className:Kt.operations,children:e.operations.map((function(e,t){return(0,I.jsx)("div",{children:en(e)},t)}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Access"}),(0,I.jsx)("div",{className:Kt.operations,children:e.access.map((function(e,t){return(0,I.jsx)("div",{children:e},t)}))})]})]})]},e.id)}))]})}function en(e){var t={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(var n in t)if(e.startsWith(n))return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("span",{style:{color:t[n]},children:n}),(0,I.jsx)("span",{children:e.slice(n.length)})]});return(0,I.jsx)("span",{children:e})}var tn={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z"};function nn(e){var t,n=e.open,s=e.close,r=(0,N.useState)(""),i=(0,Q.Z)(r,2),a=i[0],o=i[1],u=(0,N.useRef)(null),l=(0,N.useRef)(null),d=(t=s,(0,c.useMutation)({mutationFn:g,onSuccess:t}));return(0,N.useEffect)((function(){!n&&u.current&&l.current&&(d.reset(),o(""),u.current.value="",l.current.value="")}),[n,u,l]),(0,I.jsxs)(Ce,{open:n,close:s,title:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f",children:[Xe(d),d.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)(H,{onSubmit:function(){var e,t,n=null===(e=u.current)||void 0===e?void 0:e.value,s=null===(t=l.current)||void 0===t?void 0:t.value;return!n||n.length<=4?o("\u041a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n!=s?o("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):void d.mutate({password:n})},children:[(0,I.jsx)(K,{label:"\u041d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c",children:(0,I.jsx)("input",{ref:u,type:"password",required:!0})}),(0,I.jsx)(K,{label:"\u0415\u0449\u0451 \u0440\u0430\u0437",children:(0,I.jsx)("input",{ref:l,type:"password",required:!0})}),""!=a&&(0,I.jsx)("h4",{style:{color:"tomato"},children:a}),(0,I.jsx)("button",{type:"submit",className:"button button_small",children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}function sn(){var e,t,n,s=v(),r=(0,N.useRef)(null),a=(0,N.useState)(!1),o=(0,Q.Z)(a,2),u=o[0],l=o[1],d=(0,N.useState)(!1),h=(0,Q.Z)(d,2),f=h[0],p=h[1],x=function(e){var t=(0,c.useQueryClient)();return(0,c.useMutation)({mutationFn:b,onSuccess:function(n){var s;"success"==(null===(s=t.getQueryState("user"))||void 0===s?void 0:s.status)&&t.setQueryData("user",(function(e){return(0,i.Z)((0,i.Z)({},e),{},{name:n.name})})),null===e||void 0===e||e()}})}();return(0,I.jsxs)(P,{centered:!0,gap:"1rem",children:[(0,I.jsxs)("div",{className:tn.root,children:[Xe(x),x.isLoading&&(0,I.jsx)(O,{}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,I.jsx)("div",{children:(0,I.jsx)("input",{type:"text",ref:r,defaultValue:null===(e=s.data)||void 0===e?void 0:e.name,disabled:!u,className:tn.input})}),(0,I.jsxs)("div",{children:[!u&&(0,I.jsx)("button",{onClick:function(){return l(!0)},className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),u&&(0,I.jsx)("button",{onClick:function(){var e;l(!1),r.current&&(r.current.value=(null===(e=s.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),u&&(0,I.jsx)("button",{onClick:function(){l(!1),r.current&&x.mutate({name:r.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u041b\u043e\u0433\u0438\u043d"}),null===(t=s.data)||void 0===t?void 0:t.login]}),(0,I.jsxs)("div",{children:[(0,I.jsx)("h3",{children:"\u0420\u043e\u043b\u044c"}),null===(n=s.data)||void 0===n?void 0:n.role]}),(0,I.jsx)("div",{children:(0,I.jsx)("button",{className:"button",onClick:function(){return p(!0)},children:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"})})]}),(0,I.jsx)(nn,{open:f,close:function(){return p(!1)}})]})}function rn(){return an.apply(this,arguments)}function an(){return(an=(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/debug/log");case 2:return t=e.sent,e.next=5,t.json();case 5:if(n=e.sent,t.ok){e.next=8;break}throw new h(n.msg);case 8:return e.abrupt("return",n.map(cn));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e){var t=e;return t.date=new Date(e.date),t}var on={table:"styles_table__QLr-h",changes:"styles_changes__EyS9f"};function un(){var e;X("Log");var t=(0,c.useQuery)("log",rn);return(0,I.jsxs)(P,{centeredPage:!0,children:[t.isFetching&&(0,I.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),Xe(t),!t.isFetching&&(0,I.jsx)("button",{className:"button button_small",onClick:function(){return t.refetch()},children:"Update"}),(0,I.jsxs)("table",{className:on.table,children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:"9.5em"},children:"Date"}),(0,I.jsx)("th",{style:{width:"4em"},children:"Action"}),(0,I.jsx)("th",{style:{width:"9.5em"},children:"Table[id]"}),(0,I.jsx)("th",{children:"User[id]"}),(0,I.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,I.jsx)("tbody",{children:null===(e=t.data)||void 0===e?void 0:e.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{children:ue(e.date,!0,!0)}),(0,I.jsx)("td",{children:ln(e.actionCode)}),(0,I.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,I.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,I.jsxs)("td",{className:on.changes,children:[(0,I.jsx)("input",{type:"checkbox",className:on.toggleInp,id:"item".concat(e.id)}),(0,I.jsx)("div",{children:e.changes.map((function(e){return(0,I.jsxs)("div",{children:[e[0],': "',e[1],'" ',"->",' "',e[2],'"']})}))}),e.changes.length>0&&(0,I.jsx)("label",{className:"button button_small",htmlFor:"item".concat(e.id),children:e.changes.length})]})]},e.id)}))})]})]})}function ln(e){return(0,I.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}function dn(){var e,t=v();function n(e,n,r){var i;return(0,I.jsx)(s.AW,{path:n,element:null!==(i=t.data)&&void 0!==i&&i.auth?null==e||_(t,e)?r:(0,I.jsx)(B,{}):(0,I.jsx)(s.Fg,{to:"/auth"})})}return(0,I.jsxs)("div",{className:"root",children:[(0,I.jsx)(S,{}),t.isLoading&&(0,I.jsx)(Z.Z,{}),Xe(t),t.isSuccess&&(0,I.jsxs)(s.Z5,{children:[(0,I.jsx)(s.AW,{path:"/auth",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,I.jsx)(s.Fg,{to:"/"}):(0,I.jsx)($,{})}),(0,I.jsx)(s.AW,{path:"/scanner/:eventId",element:(0,I.jsx)(Ye,{})}),n(null,"/",(0,I.jsx)(ee,{})),n(null,"/profile",(0,I.jsx)(sn,{})),n("page_events","/events",(0,I.jsx)(Ke,{})),n("page_events","/events/:eventId",(0,I.jsx)(Wt,{})),n("page_events","/events/:eventId/tickets",(0,I.jsx)(Jt,{})),n("page_events","/events/:eventId/print_tickets",(0,I.jsx)(Gt,{})),n("page_staff","/staff",(0,I.jsx)(pt,{})),n("page_debug","/debug",(0,I.jsx)(Ht,{})),n("page_debug","/log",(0,I.jsx)(un,{})),n("page_users","/users",(0,I.jsx)($t,{})),n(null,"*",(0,I.jsx)(W,{}))]})]})}}}]);
//# sourceMappingURL=72.66006caf.chunk.js.map